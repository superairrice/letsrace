<footer class="footer">
  <div class="container footer__inner">
    <div class="footer__line" role="contentinfo" aria-label="Footer">
      <span class="footer__copy">© 2026, thethe9. All rights reserved.</span>
      <nav class="footer__links" aria-label="Footer links">
        <a href="{% url 'inquiry' %}" class="js-inquiry-open">문의하기</a>
        <span class="footer__sep" aria-hidden="true">|</span>
        <a href="{% url 'privacy_policy' %}">개인정보 보호</a>
        <span class="footer__sep" aria-hidden="true">|</span>
        <a href="{% url 'terms_of_service' %}">이용약관</a>
      </nav>
    </div>
  </div>
</footer>

<div id="inquiry-modal" class="inquiry-modal" hidden aria-hidden="true">
  <div class="inquiry-modal__backdrop js-inquiry-close"></div>
  <section class="inquiry-modal__panel" role="dialog" aria-modal="true" aria-labelledby="inquiry-modal-title">
    <header class="inquiry-modal__head">
      <h3 id="inquiry-modal-title">문의하기</h3>
      <button type="button" class="inquiry-modal__close js-inquiry-close" aria-label="닫기">닫기</button>
    </header>
    <div class="inquiry-modal__body">
      <p class="inquiry-modal__desc">
        아래 내용을 작성해주시면 빠르게 확인 후 메일로 답변드립니다.
      </p>

      <div id="inquiry-modal-alert" class="inquiry-modal__alert" hidden></div>

      <form id="inquiry-modal-form" action="{% url 'inquiry' %}" method="POST" class="inquiry-modal__form">
        {% csrf_token %}
        <input type="hidden" name="response_format" value="json">
        <input type="text" name="_gotcha" tabindex="-1" autocomplete="off" class="inquiry-modal__honeypot">

        <label class="inquiry-modal__field">
          <span class="inquiry-modal__label">이름(별칭)</span>
          <input type="text" name="name" required class="inquiry-modal__input" placeholder="표시될 이름을 입력하세요">
        </label>

        <label class="inquiry-modal__field">
          <span class="inquiry-modal__label">이메일</span>
          <input type="email" name="email" required class="inquiry-modal__input" placeholder="reply@example.com">
        </label>

        <label class="inquiry-modal__field">
          <span class="inquiry-modal__label">문의 내용</span>
          <textarea name="message" rows="6" required class="inquiry-modal__input inquiry-modal__textarea" placeholder="문의 내용을 구체적으로 작성해 주세요."></textarea>
        </label>

        <button id="inquiry-modal-submit" class="inquiry-modal__submit" type="submit">문의 보내기</button>
      </form>
    </div>
  </section>
</div>

<style>
  .inquiry-modal {
    position: fixed;
    inset: 0;
    z-index: 120000;
    display: grid;
    place-items: center;
    padding: 1.4rem;
  }

  .inquiry-modal[hidden] {
    display: none !important;
  }

  .inquiry-modal__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(5, 10, 18, 0.62);
    backdrop-filter: blur(6px) saturate(115%);
    -webkit-backdrop-filter: blur(6px) saturate(115%);
  }

  .inquiry-modal__panel {
    position: relative;
    width: min(45rem, calc(100vw - 2.4rem));
    border-radius: 1.25rem;
    border: 1px solid rgba(126, 150, 186, 0.26);
    background: linear-gradient(180deg, rgba(26, 34, 53, 0.97), rgba(17, 23, 38, 0.98));
    box-shadow: 0 24px 56px rgba(3, 7, 15, 0.55);
    color: #dbe7fb;
    overflow: hidden;
    font-family: "Pretendard", "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", "Segoe UI", sans-serif;
  }

  .inquiry-modal__head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1.2rem 1.35rem;
    border-bottom: 1px solid rgba(137, 154, 181, 0.2);
    background: rgba(255, 255, 255, 0.03);
  }

  .inquiry-modal__head h3 {
    font-size: 1.65rem;
    font-weight: 800;
    letter-spacing: -0.01em;
    color: #f2f7ff;
    margin: 0;
  }

  .inquiry-modal__close {
    border: 0;
    background: rgba(137, 154, 181, 0.18);
    color: #c9d8ef;
    border-radius: 0.8rem;
    padding: 0.55rem 0.95rem;
    font-size: 1.08rem;
    font-weight: 700;
    cursor: pointer;
  }

  .inquiry-modal__body {
    padding: 1.25rem 1.35rem 1.4rem;
    display: grid;
    gap: 0.9rem;
  }

  .inquiry-modal__desc {
    margin: 0;
    font-size: 1.18rem;
    line-height: 1.45;
    color: #a8bddb;
  }

  .inquiry-modal__alert {
    border-radius: 0.8rem;
    padding: 0.8rem 0.92rem;
    font-size: 1.12rem;
    line-height: 1.45;
    white-space: pre-line;
  }

  .inquiry-modal__alert--ok {
    border: 1px solid rgba(94, 214, 150, 0.48);
    background: rgba(40, 97, 70, 0.28);
    color: #b9f2d3;
  }

  .inquiry-modal__alert--error {
    border: 1px solid rgba(255, 148, 120, 0.5);
    background: rgba(115, 53, 44, 0.28);
    color: #ffd5cb;
  }

  .inquiry-modal__form {
    display: grid;
    gap: 0.82rem;
  }

  .inquiry-modal__honeypot {
    position: absolute;
    left: -9999px;
  }

  .inquiry-modal__field {
    display: grid;
    gap: 0.38rem;
  }

  .inquiry-modal__label {
    font-size: 1.15rem;
    color: #d1def2;
    font-weight: 700;
  }

  .inquiry-modal__input {
    width: 100%;
    border-radius: 0.82rem;
    border: 1px solid rgba(132, 152, 185, 0.42);
    background: rgba(12, 18, 30, 0.72);
    color: #eff4ff;
    padding: 0.9rem 1rem;
    font-size: 1.2rem;
    line-height: 1.3;
    outline: none;
    transition: border-color 140ms ease, box-shadow 140ms ease;
  }

  .inquiry-modal__input::placeholder {
    color: #849ab8;
  }

  .inquiry-modal__input:focus {
    border-color: #6fc2ff;
    box-shadow: 0 0 0 3px rgba(111, 194, 255, 0.2);
  }

  .inquiry-modal__textarea {
    resize: vertical;
    min-height: 10.5rem;
  }

  .inquiry-modal__submit {
    margin-top: 0.24rem;
    border: 0;
    border-radius: 0.86rem;
    padding: 0.92rem 1rem;
    background: linear-gradient(180deg, #48b7ff, #2d93db);
    color: #eef7ff;
    font-size: 1.23rem;
    font-weight: 800;
    letter-spacing: 0.01em;
    cursor: pointer;
  }

  .inquiry-modal__submit[disabled] {
    opacity: 0.7;
    cursor: default;
  }

  html[data-theme="light"] .inquiry-modal__backdrop {
    background: rgba(40, 57, 83, 0.36);
  }

  html[data-theme="light"] .inquiry-modal__panel {
    border-color: rgba(126, 154, 185, 0.35);
    background: linear-gradient(180deg, rgba(249, 252, 255, 0.98), rgba(242, 247, 254, 0.99));
    box-shadow: 0 20px 42px rgba(36, 58, 87, 0.24);
    color: #1d324d;
  }

  html[data-theme="light"] .inquiry-modal__head {
    background: rgba(106, 137, 175, 0.09);
    border-bottom-color: rgba(126, 154, 185, 0.26);
  }

  html[data-theme="light"] .inquiry-modal__head h3 {
    color: #1b3658;
  }

  html[data-theme="light"] .inquiry-modal__close {
    background: rgba(120, 147, 182, 0.16);
    color: #2c4a6c;
  }

  html[data-theme="light"] .inquiry-modal__desc {
    color: #506c8c;
  }

  html[data-theme="light"] .inquiry-modal__label {
    color: #294767;
  }

  html[data-theme="light"] .inquiry-modal__input {
    border-color: rgba(120, 150, 185, 0.42);
    background: rgba(255, 255, 255, 0.93);
    color: #203850;
  }

  html[data-theme="light"] .inquiry-modal__input::placeholder {
    color: #7990ad;
  }

  @media (max-width: 640px) {
    .inquiry-modal {
      padding: 0.8rem;
    }

    .inquiry-modal__panel {
      width: calc(100vw - 1.6rem);
      border-radius: 1rem;
    }

    .inquiry-modal__head {
      padding: 1rem 1.05rem;
    }

    .inquiry-modal__head h3 {
      font-size: 1.45rem;
    }

    .inquiry-modal__body {
      padding: 1.05rem 1.05rem 1.15rem;
      gap: 0.78rem;
    }

    .inquiry-modal__desc,
    .inquiry-modal__label,
    .inquiry-modal__alert,
    .inquiry-modal__input,
    .inquiry-modal__submit {
      font-size: 1.08rem;
    }

    .inquiry-modal__textarea {
      min-height: 9rem;
    }
  }
</style>

<script>
  (function () {
    var modal = document.getElementById("inquiry-modal");
    if (!modal) return;

    var openButtons = document.querySelectorAll(".js-inquiry-open");
    var closeButtons = modal.querySelectorAll(".js-inquiry-close");
    var form = document.getElementById("inquiry-modal-form");
    var alertBox = document.getElementById("inquiry-modal-alert");
    var submitBtn = document.getElementById("inquiry-modal-submit");

    function getCookie(name) {
      var value = "; " + document.cookie;
      var parts = value.split("; " + name + "=");
      if (parts.length === 2) return parts.pop().split(";").shift();
      return "";
    }

    function showAlert(type, message) {
      if (!alertBox) return;
      alertBox.className = "inquiry-modal__alert " + (type === "ok" ? "inquiry-modal__alert--ok" : "inquiry-modal__alert--error");
      alertBox.textContent = message;
      alertBox.hidden = false;
    }

    function clearAlert() {
      if (!alertBox) return;
      alertBox.hidden = true;
      alertBox.className = "inquiry-modal__alert";
      alertBox.textContent = "";
    }

    function openModal() {
      modal.hidden = false;
      modal.setAttribute("aria-hidden", "false");
      document.body.style.overflow = "hidden";
      clearAlert();
      var firstInput = form && form.querySelector("input[name='name']");
      if (firstInput) firstInput.focus();
    }

    function closeModal() {
      modal.hidden = true;
      modal.setAttribute("aria-hidden", "true");
      document.body.style.overflow = "";
    }

    openButtons.forEach(function (btn) {
      btn.addEventListener("click", function (e) {
        e.preventDefault();
        openModal();
      });
    });

    closeButtons.forEach(function (btn) {
      btn.addEventListener("click", function () {
        closeModal();
      });
    });

    document.addEventListener("keydown", function (e) {
      if (e.key === "Escape" && !modal.hidden) {
        closeModal();
      }
    });

    if (form) {
      form.addEventListener("submit", function (e) {
        e.preventDefault();
        clearAlert();
        submitBtn.disabled = true;

        var formData = new FormData(form);
        fetch(form.action, {
          method: "POST",
          headers: {
            "X-Requested-With": "XMLHttpRequest",
            "X-CSRFToken": getCookie("csrftoken")
          },
          body: formData,
          credentials: "same-origin"
        })
          .then(function (res) { return res.json(); })
          .then(function (data) {
            if (data && data.ok) {
              showAlert("ok", "문의가 정상 접수되었습니다. 확인 후 연락드리겠습니다.");
              form.reset();
              window.setTimeout(function () {
                closeModal();
              }, 1100);
              return;
            }
            var msg = (data && data.errors && data.errors.length)
              ? data.errors.join("\n")
              : "문의 전송에 실패했습니다. 잠시 후 다시 시도해주세요.";
            showAlert("error", msg);
          })
          .catch(function () {
            showAlert("error", "네트워크 오류가 발생했습니다. 잠시 후 다시 시도해주세요.");
          })
          .finally(function () {
            submitBtn.disabled = false;
          });
      });
    }
  })();
</script>
