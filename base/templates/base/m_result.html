{% load humanize %}
{% load mathfilters %}

{% load custom_filters %}


<div class="fold-content">
  <table class="tt9light-table" style="width: 100%; border-radius: 10px; border: 0.5px solid gray;">
    <thead style="font-size:1.2rem; background-color: var(--color-light);">
      <tr>
        <th colspan="1" rowspan="2" style="vertical-align:middle">
          <span style="background-color:var(--color-bg); border-radius: 10px; font-size: 1.15rem; color:var(--color-r3); padding: 6px 4px; writing-mode: vertical-lr;">레이팅</span>
        </th>
        <th colspan="3" rowspan="1">
          <a href="{% url 'jt_analysis' '%' r.rdate|mul:1|sub:50000 r.rdate '%' '%' '%' r.horse '1' '99' '1' '99' '0' '0' '0' %}" onclick="window.open(this.href, 'w_jt_analysis', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span style="color:var(--color-r5); font-size:1.2rem;">🐴&nbsp;{{r.horse|slice:"0:6"}}</span>
            
          </a>
        </th>
        
        
        <th rowspan="2" style="vertical-align:middle">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">⚖️
              <span class="tooltip-text" style="font-size:1.1rem; text-align: left;">
                ⚖️&nbsp;마체중 증감<br>🏇[
                <span style="color:var(--color-r3);">{{r.jockey}}</span>
                ]&nbsp;기수&nbsp;[
                <span style="color:var(--color-r3);">특정 기수 상대</span>
                ] 최근 1년 경주성적
              </span>
            </span>
          </a>
        </th>
        <th rowspan="2" style="vertical-align:middle">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' r.handycap  r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">🚛
              <span class="tooltip-text" style="font-size:1.1rem; text-align: left;">
                🚛&nbsp;기수 부담중량<br>🏇[
                <span style="color:var(--color-r3);">{{r.jockey}}</span>
                ]&nbsp;기수&nbsp;[
                <span style="color:var(--color-r3);">{{r.handycap}}</span>
                ]㎏ 최근 1년 경주성적
              </span>
            </span>
          </a>
        </th>

        <th width="5.5%">
            <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">
              🏇<span class="tooltip-text" style="font-size:1.1rem;">🏇&nbsp;[<span style="color:var(--color-r3);"><span style="color:var(--color-r3);">{{r.jockey}}</span></span>]&nbsp;기수 최근 1년 경주성적</span>
            </span>
          </a>
        </th>

        <th width="5.9%">
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' '%' r.host '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">
              🤠<span class="tooltip-text" style="font-size:1.1rem;">🤠&nbsp;[<span style="color:var(--color-r3);">{{r.host}}</span>]&nbsp;마주 최근 1년 경주성적</span>
            </span>
          </a>
        </th>

        
        <th rowspan="1">
          <span class="tooltip" style="font-size:1.0rem;">💧
            <span class="tooltip-text" style="font-size:1.1rem;">💧&nbsp;주로 함수율</span>
          </span>
        </th>
        <th><span style="font-size:1.2rem;">S1F</span></th>
        <th><span style="font-size:1.2rem;">G3F</span></th>
        <th><span style="font-size:1.2rem;">G2F</span></th>
        <th><span style="font-size:1.2rem;">G1F</span></th>
        <th><span style="font-size:1.1rem;">경주기록</span></th>
        <th rowspan="2" style="vertical-align:middle"><span style="font-size:1.2rem;">마<br>번</span></th>
        <th rowspan="2" style="vertical-align:middle"><span style="font-size:1.2rem;">코너 전개</span></th>
        <th rowspan="1" style="vertical-align:middle"><span style="font-size:1.2rem;">순위</span></th>
        <th rowspan="2" style="vertical-align:middle"><span style="font-size:1.2rem;">착<br>차</span></th>

        <th rowspan="1" style="vertical-align:middle">
          <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">🐎
            <span class="tooltip-text" style="font-size:1.1rem;">🐎 출주마 수</span>
          </span>
        </th>
        <!-- <th><span style="font-size:1.2rem;">인기</span></th> -->
        <th><span style="font-size:1.2rem;">단식</span></th>
        
        <th rowspan="2" style="vertical-align:middle">
          <span style="font-size:1.2rem;">복승식</span>
        </th>
        
      </tr>
      <tr>
        <th colspan="3" rowspan="1">
          <span style="font-size:1.2rem; text-transform: capitalize;">Race Info.</span>
          &nbsp;&nbsp;
          <a href="{% url 'write_significant' r.rdate r.horse %}" 
                  onclick="window.open(this.href, 'write_significant', 'top=' + window.screenTop + ', left=' + window.screen.width + ', width=500, height=550, toolbars=no, scrollbars=yes'); return false;">
            {% for hname, r_etc, r_flag in r_memo %}
              {% if hname == r.horse %}
                {% if r_flag %}
                  {% if r_flag != '0'  %}
                  <span class="tooltip" style="font-family: Arial; font-size:1.05rem; color:var(--color-r1); padding: 0px 0px;">📕
                    <span class="tooltip-text" style="text-align: left; font-size: 1.2rem; color:var(--color-bg); background-color: var(--color-light); width:30rem; z-index: 9;">&nbsp;&nbsp;&nbsp;&nbsp;📕&nbsp;&nbsp;{{r_etc}}</span>
                  </span>
                  {% else %}
                  <span class="tooltip" style="font-family: Arial; font-size:1.05rem; color:var(--color-r1); padding: 0px 0px;">📘
                    <span class="tooltip-text" style="text-align: left; font-size: 1.2rem; color:var(--color-bg); background-color: var(--color-light); width:30rem; z-index: 9;">&nbsp;&nbsp;&nbsp;&nbsp;📘&nbsp;&nbsp;{{r_etc}}</span>
                  </span>
                  {% endif %}
                {% else %}
                  <span style="font-family: Arial; font-size:1.05rem; color:var(--color-gray); padding: 0px 0px;">📃</span>
                {% endif %}
              {% endif %}
            {% endfor %}
          </a>
          &nbsp;&nbsp;
          <a href="{% url 'jt_collaboration' r.rcity r.rdate r.rno r.jockey 'jockey' %}" 
                    onclick="window.open(this.href, 'w_jt_collaboration', 'top=' + (window.screen.availHeight / 2 ) + ', left=' + window.screenX + ', width=550, height=300, toolbars=no, scrollbars=yes'); return false;">
                    🎵
          </a>
        </th>
        
        <th>
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">
              🛖<span class="tooltip-text" style="font-size:1.1rem;">🛖&nbsp;[<span style="color:var(--color-r3);">{{r.trainer}}</span>]&nbsp;마방 최근 1년 경주성적</span>
            </span>
          </a>
        </th>
          
        <th>
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">J&T<sup style="font-size: 0.7rem;">%</sup>
              <span class="tooltip-text" style="font-size:1.1rem;">🏇🛖&nbsp;[<span style="color:var(--color-r3);">{{r.jockey}}</span>]&nbsp;&&nbsp;[<span style="color:var(--color-r3);">{{r.trainer}}</span>] 최근 1년 경주성적</span>
            </span>
          </a>
          
        </th>
        <th rowspan="1">
          <span class="tooltip" style="font-size:1.0rem;">🌥️
            <span class="tooltip-text" style="font-size:1.1rem;">🌥️&nbsp;날씨 / 주로빠르기</span>
          </span>
        </th>
        <th><span style="font-size:1.2rem;">트랙</span></th>

        <th colspan="3"><span style="text-transform:lowercase; font-style: italic; font-size:1.15rem; padding:1px 4px; border-radius: 7px;">경주편성강도</span></th>

        <th>
          <span style="text-transform:lowercase; font-style: italic; font-size:1.0rem; padding:1px 4px; border-radius: 7px;">thethe9</span>
        </th>

        <th rowspan="1" style="vertical-align:middle"><span style="font-size:0.8rem;">인기/예상</span></th>

        <th rowspan="1" style="vertical-align:middle">
          <span class="tooltip" style="font-size:1.0rem; color:var(--color-r1);">(암)
            <span class="tooltip-text" style="font-size:1.1rem;">🐎 암말 수</span>
          </span>
        </th>
        <!-- <th><span style="font-size:1.2rem;">예상</span></th> -->
        <th><span style="font-size:1.2rem;">연식</span></th>
        
      </tr>


    </thead>
    <tbody>
      {% for rcity, rdate, rno, rday, rseq, distance, grade, dividing, rname, rcon1, rcon2, weather, rstate, rmoisture, race_speed, r_judge, r2alloc1, rwalloc2, gate, rank, horse, birthplace, h_sex, h_age, handycap, jockey, joc_adv, trainer, host, rating, h_weight, w_change, record, gap, corners, rs1f, r1c, r2c, r3c, r4c, rg3f, rg2f, rg1f, alloc1r, alloc3r, judge, judge_reason, audit_reason, i_s1f, i_g3f, i_g2f, i_g1f, i_record, jockey_w, burden_w, adv_jockey, adv_track, i_convert, r_start, r_corners, r_finish, r_wrapup, r_etc, r_flag, p_rank, p_record, pop_rank, s1f_rank, g3f_rank, g2f_rank, g1f_rank, recent3, recent5, fast_r, slow_r, avg_r, convert_r, i_cycle, gap_b, jockey_old, reason, r_pop, jt_per, jt_cnt, jt_1st, jt_2nd, jt_3rd, h_cnt, h_mare in hr_records %}
      {% if r.horse == horse %}

      <tr align="center" {% if grade|slice:"0:2" == '주행' %} style="background: var(--color-light-gray);" {% endif %}>
        {# rating #}
        <td>
          {% if rating %}
          <span style="font-size:1.1rem; padding:2px 2px; color:var(--color-r3); font-family: Arial; border-radius: 30%; background-color:var(--color-dark-medium);">{{rating}}</span>
          {% endif %}

          {% if request.user.username == 'admin' %}
          <div style="text-align: right; padding-top: 2px;">
            <a href="{% url 'write_significant' rdate horse %}" 
                              onclick="window.open(this.href, 'write_significant', 'top=' + window.screenTop + ', left=' + window.screen.width + ', width=500, height=550, toolbars=no, scrollbars=yes'); return false;">
              {% if r_flag %}
                {% if r_flag != '0'  %}
                <span class="tooltip" style="font-family: Arial; font-size:1.05rem; color:var(--color-r1);">📕
                  <span class="tooltip-text" style="text-align: left; font-size: 1.2rem; color:var(--color-bg); background-color: var(--color-light); width:30rem; z-index: 9;">&nbsp;&nbsp;&nbsp;&nbsp;📕&nbsp;&nbsp;{{r_etc}}</span>
                </span>
                {% else %}
                <span class="tooltip" style="font-family: Arial; font-size:1.05rem; color:var(--color-r1);">📘
                  <span class="tooltip-text" style="text-align: left; font-size: 1.2rem; color:var(--color-bg); background-color: var(--color-light); width:30rem; z-index: 9;">&nbsp;&nbsp;&nbsp;&nbsp;📘&nbsp;&nbsp;{{r_etc}}</span>
                </span>
                {% endif %}
              {% else %}
                <span style="font-family: Arial; font-size:1.05rem; color:var(--color-gray);">📃</span>
              {% endif %}
            </a>
          </div>
          {% endif %}

          <!-- {% if judge == NONE %}
          <span class="tooltip">
            <progress value={{r_pop}} max="99" style="width: 1.5rem"></progress>
            <span class="tooltip-text" style="z-index: 9;">
              <div style="font-size: 1.1rem;">📊&nbsp;인기도&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% if r_pop %}{{r_pop}}{% endif %}</div>
            </span>
          </span>
          {% endif %} -->

        </td>
        
        
        {# 경주정보 #}
        <td align="right" style="font-size: 1.2rem; vertical-align: middle;">
          <a href="{% url 'race_result' rcity rdate rno horse r_condition.rcity r_condition.rdate r_condition.rno %}"
            onclick="window.open(this.href, 'w_result', 'width=900, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
            <div style="text-align: left; color:var(--color-dark); font-style: italic; text-align: left;">
              <span style="font-size: 1.2rem; font-style: italic; font-family: Arial; color: var(--color-bg); text-decoration: underline; font-weight: bold;">'{{rdate|slice:"2:4" }}.{{rdate|slice:"4:6" }}.{{rdate|slice:"6:8"}}</span>
              
            </div>
          
            {# 경주정보 #}
            <div style="font-size: 1.2rem; color:var(--color-gray); padding-top: 1px;">

              {# 출주주기 #}
              {% if r_rank == 99 %}
              <span style="font-size: 1.15rem;">&nbsp;</span>
              <span style="font-size:0.9rem; color:gray;">{% if reason %}{{reason|slice:"0:8"}}{% endif %}</span>
              {% else %}

                {% if rank >= 20 %}
                <span style="font-size: 1.15rem;">&nbsp;</span>
                {% else %}
                  {% if i_cycle <= 16 %}
                  <span style="font-family: Arial; font-size:1.10rem; color:var(--color-light); background-color: var(--color-r1); border-radius:10px; padding:2px 4px;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% elif i_cycle >= 68 %}
                  <span style="font-family: Arial; font-size:1.10rem; color:var(--color-light); background-color: var(--color-r2); border-radius:10px; padding:2px 4px;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% else %}
                  <span style="font-family: Arial; font-size:1.15rem; color:var(--color-gray); background-color: var(--color-light); border-radius:10px; padding:2px 4px;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% endif %}
                {% endif %}
                
                
                {# 성별 #}
                {% if h_sex %}
                {% if h_sex == '암' %}
                <span style="font-size: 1.15rem; color:var(--color-r5); padding: 1px 1px;">{{h_sex}}</span>
                {% elif h_sex == '거' %}
                <span style="font-size: 1.15rem; color:var(--color-r1); padding: 1px 1px;">{{h_sex}}</span>
                {%else%}
                <span style="font-size: 1.15rem; color:var(--color-light-gray); padding: 1px 1px;">{{h_sex}}</span>
                {%endif%}
                {%endif%}
                
                
              {% endif %}

            </div>
          </a>
        </td>

        <td align="right" style="border-left: 0px; vertical-align: middle;">

          <div style="font-size: 1.2rem;">
            <span style="font-size: 1.2rem; font-style: italic; font-family: Arial; color: var(--color-r5); text-decoration: underline; font-weight: 500;">{{rno}}<sup style="font-size: 0.8rem;">R</sup></span>
          </div>

          {# 나이 #}
          {% if h_age %}
          {% if h_age >= 5.9 %}
          <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-r1);">{{h_age}}</span>
          {% elif h_age < 3 %}
          <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-r2);">{{h_age}}</span>
          {%else%}
          <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-gray);">{{h_age}}</span>
          {%endif%}
          {%endif%}

        </td>

        {# 경주거리 / 경주정보 #}
        <td align="right" style="border-left: 0px; vertical-align: middle;">

          {% if distance %}
          {% if distance == r_condition.distance %}
          <div style="font-size: 1.2rem; font-family: Arial; color:var(--color-r1); text-align: center; font-style: italic; font-weight: bold;">{{distance}}</div>
          {% else %}
          <div style="font-size: 1.2rem; font-family: Arial; color:var(--color-bg); text-align: center; font-style: italic; font-weight: normal;">{{distance}}</div>
          {% endif %}
          {% endif %}
          
          {% if grade %}
          {% if '주행' in grade %}
            <div style="font-size: 1.1rem; color:var(--color-light-gray);">주행</div>
          {% else %}
            {% if 'O' in grade %}
            <div class="tooltip" style="font-size: 1.1rem; color:var(--color-light); background-color: var(--color-r1); border-radius: 5px; font-weight: normal;">
              {{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}
              <span class="tooltip-text" style="font-size: 1.1rem; z-index: 9; font-weight: normal;">&nbsp;&nbsp;&nbsp;&nbsp;🏇&nbsp;{{rname}}&nbsp;&nbsp;{{rcon1}}&nbsp;&nbsp;{{rcon2}}</span>
            </div>
            {% else %}
            <div style="font-size: 1.1rem; color:var(--color-gray);">{{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}</div>
            {% endif %}
          {% endif %}
          {% endif %}
        </td>
        
        
        {# 마체중 #}
        <td style="font-size: 1.2rem;">
          {% if h_weight %}
          <div style="text-align:right; font-family: Arial; text-align: left; color:var(--color-gray);">{{h_weight}}</div>
          <div style="text-align:right; font-family: Arial; font-size: 1.1rem;">
            {% if w_change|slice:"0:1" == '-' %}
            <span style="font-family: Arial; font-style: italic; color:var(--color-r1); padding:2px 4px; border-radius: 15px; background-color:var(--color-main-light); ">{{w_change}}</span>
            {% else %}
            <span style="font-family: Arial; font-style: italic; color:var(--color-r5); padding:2px 4px; border-radius: 15px; background-color:var(--color-main-light); ">{{w_change}}</span>
            {% endif %}
          </div>
          
          {% endif %}
        </td>

        {# 부담중량 #}
        <td style="font-size: 1.2rem;">
          <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' handycap %}" onclick="window.open(this.href, 'w_jt_analysis', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <div style="font-size: 1.15rem; text-align:left; font-family: Arial; color:var(--color-gray);">{% if handycap %}{{handycap}}{% endif %}</div>

            {% if handycap|sub:r.handycap == 0 %}
            <div style="font-size: 1.1rem; font-family: Arial; text-align: right;">-&nbsp;&nbsp;</div>
            {% elif handycap|sub:r.handycap > 0 %}
            <div style="font-size: 1.1rem; font-family: Arial; font-style: italic; color:var(--color-r5); padding:1px 1px; border-radius: 15px; background-color:var(--color-main-light);">+{{handycap|sub:r.handycap|floatformat:1}}</div>
            {% else %}
            <div style="font-size: 1.1rem; font-family: Arial; font-style: italic; color:var(--color-r1); padding:1px 1px; border-radius: 15px; background-color:var(--color-main-light);">{{handycap|sub:r.handycap|floatformat:1}}</div>
          {% endif %}
          </a>
        </td>

        {# 기수 / 마방 #}
        <td align="left" style="font-size: 1.2rem">
          {% if jockey %}

            {% if jockey_old %}  {# 기수변경 #}
              {% if r.jockey == jockey %}
              <div style="text-align: left;">
                <span class="blink tooltip" style="color:var(--color-light-gray); padding: 0px 2px; border-bottom:1px solid orange; border-radius: 5px;">{{jockey|slice:"0:3"}}
                  <span class="tooltip-text">🐴&nbsp;기수변경:&nbsp;'{{jockey_old}}'에서<br>🐴&nbsp;변경사유:&nbsp;{{reason}}</span>
                </span>
              </div>
              {%else%}
              <div style="text-align: left;">
                <span class="blink tooltip" style="color:var(--color-r3); font-style: italic;">{{jockey|slice:"0:3"}}<span class="tooltip-text">🐴&nbsp;기수변경:&nbsp;'{{jockey_old}}'에서<br>🐴&nbsp;변경사유:&nbsp;{{reason}}</span></span>
              </div>
              {%endif%}
            {% else %}
              {% if r.jockey == jockey %}
              <div style="text-align: left; color:var(--color-gray); font-size: 1.15rem; padding: 0px 2px; border-bottom:1px solid orange; border-radius: 5px;">{{jockey|slice:"0:3"}}</div>
              {%else%}
              <div style="text-align: left; color:var(--color-r5); font-size: 1.15rem;">{{jockey|slice:"0:3"}}</div>
              {%endif%}
            {%endif%}
          
          {%endif%}

          {% if r.trainer == trainer %}
            <div style="color:var(--color-r1);  text-align: right; font-size: 1.15rem;">
                <span style="color:var(--color-gray); font-size: 1.15rem;">{{trainer}}</span>
            </div>
            {%else%}
            <div style="color:var(--color-r1);  text-align: right; font-size: 1.15rem;">
                <span style="color:var(--color-r1); font-size: 1.15rem;">{{trainer}}</span>
            </div>
          {%endif%}
          
        </td>

        {# J&T % / 마주 #}
        <td style="font-size: 1.2rem">

          {% if r.host == host %}
          <div style="color:var(--color-gray); text-align: left; font-size: 1.15rem;">
              <span style="color:var(--color-gray); text-align: left; font-size: 1.15rem;">{{host|slice:"0:3"}}</span>
          </div>
          {%else%}
          <div style="color:var(--color-r1); text-align: left; font-size: 1.15rem;">
            {% if host %}
              <span style="color:var(--color-r1); text-align: left; font-size: 1.15rem">{{host|slice:"0:3"}}</span>
            {% endif %}
          </div>
          {% endif %}

          {% if judge == NONE %} {# 주행검사 아니면  #}
            {% if jockey_old %}
              {# 기수가 변경되었으면 기존 기수의 기록을 라인 스루 #}

              <div style="font-size: 1.2rem; color:gray; text-align: right;">
                <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jockey trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' %}"
                  onclick="window.open(this.href, 'w_jt_analysis', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
                  <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); z-index:9; text-decoration:line-through;">
                    {% if jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                
                    <span class="tooltip-text" style="font-family: Arial; font-size: 1.2rem; z-index:9;">
                      <div style="font-family: Arial; color:var(--color-light); text-align:center;">👥&nbsp;기수 변경전&nbsp;{{jockey_old}}&nbsp;﹆&nbsp;{{trainer}}</div>
                      <hr>
                      <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1️⃣&nbsp;경주일 기준 1년간 출주 횟수 :
                
                        {% if jt_cnt %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{jt_cnt}}</span>
                        <span style="font-family: Arial; color:var(--color-r3)">{{jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r4)">{{jt_2nd|sub:jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r5)">{{jt_3rd|sub:jt_2nd}}</span>
                        {% else %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                        <span style="font-family: Arial; color:var(--color-r3)">0</span>
                        <span style="font-family: Arial; color:var(--color-r4)">0</span>
                        <span style="font-family: Arial; color:var(--color-r5)">0</span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        2️⃣&nbsp;복승률 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r2);">{{jt_2nd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        3️⃣&nbsp;연승률 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                
                    </span>
                  </span>
                </a>
              </div>

            {% else %}    {# 기수변경 없을 때 #}
              
              {# 기수 조교사 연대 출주 복승 회수 #}
              <div style="font-size: 1.15rem; color:gray; text-align: right;">
                <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jockey trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' %}"
                  onclick="window.open(this.href, 'w_jt_analysis', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
                  <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); z-index:9;">
                    {% if jt_cnt > 0 %}
                      {% if jt_3rd|mul:100|div:jt_cnt >= 50.0 %}
                      <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif jt_3rd|mul:100|div:jt_cnt >= 40.0 %}
                      <span style="font-family: Arial; color: var(--color-r2);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif jt_3rd|mul:100|div:jt_cnt >= 30.0 %}
                      <span style="font-family: Arial; color: var(--color-r3);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif jt_3rd|mul:100|div:jt_cnt >= 20.0 %}
                      <span style="font-family: Arial; color: var(--color-r4);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif jt_3rd|mul:100|div:jt_cnt >= 10.0 %}
                      <span style="font-family: Arial; color: var(--color-r5);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% else %}
                      <span style="font-family: Arial; color: var(--color-light-gray);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% endif %}
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}

                    <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
                      <div style="font-family: Arial; color:var(--color-light); text-align:center;">👥&nbsp; {{jockey}}&nbsp;﹆&nbsp;{{trainer}}</div>
                      <hr>
                      <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1️⃣&nbsp;경주일 기준 최근 1년간 경주성적 : 

                        {% if jt_cnt %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{jt_cnt}}</span>
                        <span style="font-family: Arial; color:var(--color-r3)">{{jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r4)">{{jt_2nd|sub:jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r5)">{{jt_3rd|sub:jt_2nd}}</span>
                        {% else %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                        <span style="font-family: Arial; color:var(--color-r3)">0</span>
                        <span style="font-family: Arial; color:var(--color-r4)">0</span>
                        <span style="font-family: Arial; color:var(--color-r5)">0</span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        2️⃣&nbsp;복승률 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r2);">{{jt_2nd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        3️⃣&nbsp;연승률 : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                
                    </span>
                  </span>
                </a>
              </div>

            {% endif %}
          {% endif %}
          
          
        </td>

        {# 날씨 / 주로 #}
        <td style="font-size: 1.2rem">
          
          {% if rstate == '불량' or rstate == '포화' %}
          <div style="text-align:left; font-family: Arial; font-size: 1.1rem; color:tomato;">{{rstate|slice:"0:1"}}&nbsp;{{rmoisture}}</div>
          {% else %}
          <div style="text-align:left; font-family: Arial; font-size: 1.1rem; color:var(--color-gray)">{% if handycap %}{{rstate|slice:"0:1"}}&nbsp;{{rmoisture}}{% endif %}</div>
          {% endif %}

          {% if weather %}
          <div style="text-align: center; font-family: Arial;">
            <span style="font-size: 1.0rem;">
            {% if weather|slice:"0:1" == '맑' %}☀️
            {% elif weather|slice:"0:1" == '흐' %}☁️
            {% elif weather|slice:"0:1" == '비' %}☔️
            {% elif weather|slice:"0:1" == '눈' %}☃️
            {% else %}﹆
            {% endif %}
            </span>
          
            {% if race_speed == '②' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">2</span>
            {% elif race_speed == '③' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">3</span>
            {% elif race_speed == '④' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r2); padding: 1px 3px; color:var(--color-light);">4</span>
            {% elif race_speed == '⑤' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r3); padding: 1px 3px; color:var(--color-bg);">5</span>
            {% elif race_speed == '⑥' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r3); padding: 1px 3px; color:var(--color-dark-medium);">6</span>
            {% elif race_speed == '⑦' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">7</span>
            {% elif race_speed == '⑧' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">8</span>
            {% elif race_speed == '⑨' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-bg); padding: 1px 3px; color:var(--color-light);">9</span>
            {% else %}
            <span>{% if race_speed %}{{race_speed}}{% else %}{% endif %}</span>
            {% endif %}
          
          </div>
          
          {% endif %}

        </td>
        
        <td align="right" style="font-size: 1.15rem;">
          {% if rs1f %}
            {% if r_condition.distance == distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{rs1f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{rs1f|slice:"-4:"}}</div>
            {%endif%}
          {%endif%}

          {% if adv_track >= 40 %}
          <span style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-r1); color:var(--color-light);">
            {{adv_track|floatformat:1}}
          </span>
          {% elif adv_track >= 20 and adv_track < 40 %}
          <span style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-main-medium); color:var(--color-r2);">
            {{adv_track|floatformat:1}}
          </span>
          {% elif adv_track > -20 and adv_track < 20 %}
          <span style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-light); color:var(--color-r2);">
            {{adv_track|floatformat:1}}
          </span>
          {% elif adv_track > -40 and adv_track < -20 %}
          <span style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-dark-light); color:var(--color-r2);">
            {{adv_track|floatformat:1}}
          </span>
          {% else %}
          <span style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-light);">
            {{adv_track|floatformat:1}}
          </span>
          
          {% endif %}
          
        </td>

        <td align="center" style="font-size: 1.15rem;">{# G3F / 경주편성 하 #}
          
          {% if rg3f %}
            {% if r_condition.distance == distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{rg3f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{rg3f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if r_judge %}
          <div>
            {% if grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
              {% if r_judge|mul:"1" < -5 %}
              <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{r_judge}}
              </span>
              {% else %}
              <span>&nbsp;</span>
              {% endif %}
            {% else %}
            {% if r_judge|mul:"1" < -5 %}
              <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{r_judge}}
              </span>
              {% else %}
              <span>&nbsp;</span>
              {% endif %}
            {% endif %}

          </div>
          {% endif %}
          
            
        </td>

        <td align="center" style="font-size: 1.15rem;">
          {% if rg2f %}
            {% if r_condition.distance == distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{rg2f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{rg2f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
            {% if r_judge %}
            <div>
              {% if r_judge|mul:"1" >= -5 and r_judge|mul:"1" <= 5 %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% else %}
            {% if r_judge %}
            <div>
              {% if r_judge|mul:"1" >= -5 and r_judge|mul:"1" <= 5 %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
          
            
        </td>
        <td align="center" style="font-size: 1.15rem;">
          {% if rg1f %}
            {% if r_condition.distance == distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{rg1f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{rg1f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
            {% if r_judge %}
            <div>
              {% if r_judge|mul:"1" > 5  %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% else %}
            {% if r_judge %}
            <div>
              {% if r_judge|mul:"1" > 5  %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
          
        </td>

        {# 경주기록/예상기록 #}
        <td align="right" style="font-size: 1.1rem;">
          {% if record %}
          {% if rank == 1 %}
          <div style="text-align: center; font-style: italic; color:var(--color-r1); font-size: 1.1rem;">
            <span style="font-family: Arial, Helvetica, sans-serif; border-bottom: solid 1px var(--color-r1); border-radius: 4px; padding: 2px 4px;"> {% if rank > 20 %}﹆{% else %} {{record|slice:"0:1"}}&nbsp;{{record|slice:"1:6"}} {% endif %}</span>
          </div>
          {% elif rank == 2 %}
          <div style="text-align: center; font-style: italic; color:var(--color-r2); font-size: 1.1rem;">
            <span style="font-family: Arial, Helvetica, sans-serif; border-bottom: solid 1px var(--color-r2); border-radius: 4px; padding: 2px 4px;"> {% if rank > 20 %}﹆{% else %} {{record|slice:"0:1"}}&nbsp;{{record|slice:"1:6"}} {% endif %}</span>
          </div>
          {% elif rank == 3 %}
          <div style="text-align: center; font-style: italic; color:var(--color-r3); font-size: 1.1rem;">
            <span style="font-family: Arial, Helvetica, sans-serif; border-bottom: solid 1px var(--color-r3); border-radius: 4px; padding: 2px 4px;"> {% if rank > 20 %}﹆{% else %} {{record|slice:"0:1"}}&nbsp;{{record|slice:"1:6"}} {% endif %}</span>
          </div>
          
          {% else %}
          <div style="text-align: center; font-style: italic; font-size: 1.1rem;">
            <span style="font-family: Arial, Helvetica, sans-serif; border-bottom: solid 1px var(--color-gray); border-radius: 4px; padding: 2px 4px;"> {% if rank > 20 %}﹆{% else %} {{record|slice:"0:1"}}&nbsp;{{record|slice:"1:6"}} {% endif %}</span>
          </div>
          {% endif %}

          <div class="tooltip" style="text-align: right; color:var(--color-light-gray); font-size: 1.1rem; font-family: Arial; font-style: italic; font-weight: 300;">
            {% if i_convert %}
            {% if rank > 20 or grade|slice:"0:2" == '주행' %}{% else %}{{i_convert|t2s}}{% endif %}
            
            <span class="tooltip-text" style="color:var(--color-bg); background-color:var(--color-light) ; text-align: center; font-size: 1.1rem; border:1px solid orange; border-radius: 10px; padding: 4px 20px; ">
              <span style="font-style: normal;">🎲&nbsp;thethe9&nbsp;예상기록&nbsp;&nbsp;:&nbsp;&nbsp;</span>
              <span style="color: var(--color-r5);">{{p_record|slice:"0:1"}}&nbsp;{{p_record|slice:"1:6"}}</span>
            </span>
            {% endif %}

          </div>
          {%endif%}

        </td>
        
        {# gate #}
        <td style="font-size: 1.2rem;">
          
          {% if rank == 99 %}
          <span style="text-decoration:line-through; color:gray;">{{gate}}</span>
          {% else %}
            {% if rank == 1 %}
            <span style="border:0.5px solid var(--color-r1); border-radius: 50%; padding: 2px 4px; font-weight: bold; color:var(--color-r1);">
              {{gate}}
            </span>
            {% elif rank == 2 %}
            <span style="border:0.5px solid var(--color-r2); border-radius: 50%; padding: 2px 4px; font-weight: bold; color:var(--color-r2);">
              {{gate}}
            </span>
            {% elif rank == 3 %}
            <span style="border:0.5px solid var(--color-r3); border-radius: 50%; padding: 2px 4px; font-weight: bold; color:var(--color-r3);">
              {{gate}}
            </span>
            {% elif rank == 4 %}
            <span style="border:0.5px solid var(--color-r4); border-radius: 50%; padding: 2px 4px; font-weight: bold; color:var(--color-r4);">
              {{gate}}
            </span>
            {% elif rank == 5 %}
            <span style="border:0.5px solid var(--color-r5); border-radius: 50%; padding: 2px 4px; font-weight: bold; color:var(--color-r5);">
              {{gate}}
            </span>
            {% else %}
            <span style="border:0.5px solid var(--color-bg); border-radius: 50%; padding: 2px 4px; font-weight: bold; ">{{gate}}</span>
            {% endif %}
          {% endif %}
          
        </td>

        {# corners #}
        <td style="font-size: 1.1rem; font-family: Arial;">
          {% if corners %}
            <div style="color:rgb(0, 128, 255); text-align: left; font-style: italic; font-family: Arial;">
              {{corners|slice:"0:10"}}
            </div>
            <div style="color:rgb(0, 128, 255); text-align: right; font-style: italic; font-family: Arial;">
              {{corners|slice:"10:"}}
            </div>
          {% endif %}
        </td>

        {# rank #}
        <td style="font-size: 1.2rem; font-family: Arial;">
          <div>
          {% if rank == 1 %}
          <span style="font-family: Arial; border-radius: 50%; background-color:var(--color-r1); color:var(--color-light); padding: 2px 4px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          {% elif rank == 2 %}
          <span style="font-family: Arial; border-radius: 50%; background-color:var(--color-r2); color:var(--color-light); padding: 2px 4px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          {% elif rank == 3 %}
          <span style="font-family: Arial; border-radius: 50%; background-color:var(--color-r3); color:var(--color-bg); padding: 2px 4px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          {% elif rank == 4 %}
          <span style="font-family: Arial; border-radius: 50%; background-color:var(--color-r4); color:var(--color-bg); padding: 2px 4px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          {% elif rank == 5 %}
          <span style="font-family: Arial; border-radius: 50%; background-color:var(--color-r5); color:var(--color-light); padding: 2px 4px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          
          {% else %}
          <span style="font-family: Arial; border-radius: 50%; background-color:bisque; padding: 3px;">
            {% if rank > 20 %}﹆{% else %} {{rank}} {% endif %}
          </span>
          {% endif %}

          </div>

          {# 인기순위 / 프로그램 예상순위 #}
          {% if pop_rank %}
          {% if judge == NONE %}
            {% if pop_rank == 1 %}
              <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r1); border: 1px solid var(--color-r1); padding: 1px 3px; border-radius: 50%;">{{pop_rank}}</span>
            {% elif pop_rank == 2 %}
              <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r2); border: 1px solid var(--color-r2); padding: 1px 3px; border-radius: 50%;">{{pop_rank}}</span>
            {% elif pop_rank == 3 %}
              <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r3); border: 1px solid var(--color-r3); padding: 1px 3px; border-radius: 50%;">{{pop_rank}}</span>
            {% else %}
              <span style="font-family: Arial; font-size: 1.0rem; padding: 1px 1px; ">
                {% if pop_rank > 20 %}﹆{% else %} {{pop_rank}} {% endif %}
              </span>
            {% endif %}
            
            {% if p_rank %}
              {% if p_rank == 1 %}
                <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r1); border: 1px solid var(--color-r1); padding: 1px 3px; border-radius: 50%;">{{p_rank}}</span>
              {% elif p_rank == 2 %}
                <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r2); border: 1px solid var(--color-r2); padding: 1px 3px; border-radius: 50%;">{{p_rank}}</span>
              {% elif p_rank == 3 %}
                <span style="font-family: Arial; font-size: 1.0rem; color:var(--color-r3); border: 1px solid var(--color-r3); padding: 1px 3px; border-radius: 50%;">{{p_rank}}</span>
              {% else %}
                <span style="font-family: Arial; font-size: 1.0rem; padding: 1px 1px; ">
                  {% if p_rank > 20 %}﹆{% else %} {{p_rank}} {% endif %}
                </span>
              {% endif %}
            {% endif %}
          {% endif %}
          {% endif %}
        </td>

        {# 착차 #}
        <td align="left" style="font-size: 1.2rem;">
          {% if gap %}
            {% if gap|length >= 3 %}
            <span style="text-align: left; font-size: 0.7rem; color: var(--color-r1); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ gap}}</span>
            {% else %}
            <span style="text-align: left; font-size: 1.0rem; color: var(--color-r1); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ gap}}</span>
            {%endif%}
          {% else %}
            <div>&nbsp;</div>
          {%endif%}

          {% if gap_b %}
          <div style="text-align: right;">
            {% if gap_b|length >= 3 %}
            <span style="text-align: right; font-size: 0.7rem; color: var(--color-bg); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ gap_b}}</span>
            {% else %}
            <span style="text-align: right; font-size: 1.0rem; color: var(--color-bg); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ gap_b}}</span>
            {%endif%}
          </div>
          {% else %}
          <div>&nbsp;</div>
          {%endif%}
        </td>

        {# 출주마수 / 암말 수#}
        <td style="font-size: 1.2rem;">
          <div style="font-size: 1.1rem; font-family: Arial; background-color: var(--color-light); border-radius: 7px;">
            {% if h_cnt %}{{h_cnt}}{% endif %}
          </div>
          {% if h_mare %}
          <div style="font-size: 1.05rem; font-family: Arial; color: var(--color-r1);">({{h_mare}})</div>
          {% else %}
          <div style="font-size: 1.05rem; font-family: Arial; color: var(--color-r1);">{% if h_cnt %}{{h_mare}}{% endif %}</div>
          {% endif %}
        </td>
        
        {# 단식 / 연식 #}
        <td align="right" style="font-size: 1.1rem; font-family: Arial;">
        {% if alloc1r %}
          {% if rank == 1 %}
            <div style="color:var(--color-r1); font-weight: 700; font-family: Arial;">{{alloc1r}}</div>
          {%else%}
            <div style="font-family: Arial; color:var(--color-light-gray);">{{alloc1r}}</div>
          {%endif%}
        
          {% if rank <= 3 %}
            <div style="color:var(--color-r1); font-weight: 700; font-family: Arial;">{{alloc3r}}</div>
          {%else%}
            <div style="font-family: Arial; color:var(--color-light-gray);">{{alloc3r}}</div>
          {%endif%}
        {%endif%}
        </td>
        
        {# 복승식 배당율 #}
        <td align="center" style="font-size: 1.2rem;">
          {% if rank <= 2 %}
            <div style="font-family: Arial; font-size:1.15rem; font-weight:700; color:var(--color-r1); text-align: right;">
              {% if r2alloc1 %}{{r2alloc1}}{% endif %}
            </div>
            <div style="font-family: Arial; font-size:1.15rem; font-weight:700; color:var(--color-r1); text-align: right;">
              {% if r2alloc2 %}{{r2alloc2}}{% endif %}
            </div>
          {% else %}
            <div style="font-family: Arial; font-size:1.15rem; color:var(--color-light-gray); text-align: right;">
              {% if r2alloc1 %}{{r2alloc1}}{% endif %}
            </div>
            <div style="font-family: Arial; font-size:1.15rem; color:var(--color-light-gray); text-align: right;">
              {% if r2alloc2 %}{{r2alloc2}}{% endif %}
            </div>
          {% endif %}
        </td>
        
      </tr>
      {%endif%}

      {% endfor %}

    </tbody>
  </table>
</div>