{% load humanize %}
{% load mathfilters %}

{% load custom_filters %}


<div class="fold-content">
  <table class="small-friendly">
    <thead style="font-size:1.2rem;">
      <tr>
        <th colspan="1" rowspan="2" style="vertical-align:middle">
          <span style="background-color:var(--color-bg); border-radius: 10px; font-size: 1.15rem; color:var(--color-r3); padding: 6px 4px; writing-mode: vertical-lr;">ë ˆì´íŒ…</span>
        </th>
        <th><span style="font-size:1.2rem;">ì¸ê¸°</span></th>
        <th colspan="1" rowspan="1">
          <!-- <a href="{% url 'get_race_horse' r.rdate 'horse' r.horse r.jockey r.trainer r.host %}"  -->
          <a href="{% url 'jt_analysis' '%' r.rdate|mul:1|sub:50000 r.rdate '%' '%' '%' r.horse '1' '99' '1' '99' '0' '0' '0' %}" onclick="window.open(this.href, 'jt_analysis', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span style="color:var(--color-r5); font-size:1.2rem;">ğŸ´&nbsp;{{r.horse|slice:"0:6"}}</span>
            
          </a>
        </th>
        <th rowspan="1" style="vertical-align:middle">
          <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">ğŸ
            <span class="tooltip-text" style="font-size:1.1rem;">ğŸ ì¶œì£¼ë§ˆ ìˆ˜</span>
          </span>
        </th>
        
        <th rowspan="2" style="vertical-align:middle">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">âš–ï¸
              <span class="tooltip-text" style="font-size:1.1rem; text-align: left;">
                âš–ï¸&nbsp;ë§ˆì²´ì¤‘ ì¦ê°<br>ğŸ‡[
                <span style="color:var(--color-r3);">{{r.jockey}}</span>
                ]&nbsp;ê¸°ìˆ˜&nbsp;[
                <span style="color:var(--color-r3);">íŠ¹ì • ê¸°ìˆ˜ ìƒëŒ€</span>
                ] ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì 
              </span>
            </span>
          </a>
        </th>
        <th rowspan="2" style="vertical-align:middle">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' r.handycap  r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">ğŸš›
              <span class="tooltip-text" style="font-size:1.1rem; text-align: left;">
                ğŸš›&nbsp;ê¸°ìˆ˜ ë¶€ë‹´ì¤‘ëŸ‰<br>ğŸ‡[
                <span style="color:var(--color-r3);">{{r.jockey}}</span>
                ]&nbsp;ê¸°ìˆ˜&nbsp;[
                <span style="color:var(--color-r3);">{{r.handycap}}</span>
                ]ã ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì 
              </span>
            </span>
          </a>
        </th>

        <th width="5.5%">
          <!-- <a href="{% url 'get_race_awardee' r.rdate 'jockey' r.jockey r.jockey r.trainer r.host %}"
            onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;"> -->
            <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">
              ğŸ‡<span class="tooltip-text" style="font-size:1.1rem;">ğŸ‡&nbsp;[<span style="color:var(--color-r3);"><span style="color:var(--color-r3);">{{r.jockey}}</span></span>]&nbsp;ê¸°ìˆ˜ ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì </span>
            </span>
          </a>
        </th>

        <th width="5.9%">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">J&T<sup style="font-size: 0.7rem;">%</sup>
              <span class="tooltip-text" style="font-size:1.1rem;">ğŸ‡ğŸ›–&nbsp;[<span style="color:var(--color-r3);">{{r.jockey}}</span>]&nbsp;&&nbsp;[<span style="color:var(--color-r3);">{{r.trainer}}</span>] ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì </span>
            </span>
          </a>
        </th>

        
        <th rowspan="1">
          <span class="tooltip" style="font-size:1.0rem;">ğŸ’§
            <span class="tooltip-text" style="font-size:1.1rem;">ğŸ’§&nbsp;ì£¼ë¡œ í•¨ìˆ˜ìœ¨</span>
          </span>
        </th>
        <th><span style="font-size:1.2rem;">S1F</span></th>
        <th><span style="font-size:1.2rem;">G3F</span></th>
        <th><span style="font-size:1.2rem;">G2F</span></th>
        <th><span style="font-size:1.2rem;">G1F</span></th>
        <th style="vertical-align: middle; font-size:1.1rem; border:1px solid orange; border-radius: 10px; "><span style="font-size:1.1rem;">Record</span></th>
        <th rowspan="2" style="vertical-align:middle"><span class="visible-big" style="font-size:1.2rem;">ë§ˆ<br>ë²ˆ</span></th>
        <th rowspan="2" style="vertical-align:middle"><span class="visible-big" style="font-size:1.2rem;">ì½”ë„ˆ ì „ê°œ</span></th>
        <th rowspan="2" style="vertical-align:middle"><span class="visible-big" style="font-size:1.2rem;">ìˆœ<br>ìœ„</span></th>
        <th rowspan="2" style="vertical-align:middle"><span class="visible-big" style="font-size:1.2rem;">ì°©<br>ì°¨</span></th>

        <th><span style="font-size:1.2rem;">ë‹¨ì‹</span></th>
        
        <th rowspan="2" style="vertical-align:middle">
          {% if request.user.username == 'admin' %}
          <a href="{% url 'write_significant' r.rdate r.horse %}" onclick="window.open(this.href, 'w_significant', 'top=0, left=0, width=550, height=440'); return false;">
            <span class="visible-big" style="font-size:1.2rem; color:var(--color-r5);">íŠ¹ì´<br>ì‚¬í•­</span>
          </a>
          {% else %}
          <span style="font-size:1.2rem;">
          {% for gate, rank, r_rank, r_pop, horse, jockey, trainer, host, h_3rd, h_tot, paternal, maternal, p_tot, p_2rd, m_tot, m_2rd, gear1, gear2, blood1, blood2, treat1, treat2, p_tot, p_year, rating, i_cycle, reason, jockey_old, birthplace, h_sex, h_age, complex, complex5, gears in pedigree %}
          {% if r.horse == horse %}
          <div style="font-family: Arial; font-size:0.9rem; color:var(--color-bg); text-align: right;">ë§ˆí•„ì¥êµ¬<br>â€”â€”â€”â€”
          </div>
          <div style="font-family: Arial; font-size:0.9rem; color:var(--color-r5); text-align: right;">{{gear1|slice:"0:5"}}
          </div>
          <div style="font-family: Arial; font-size:0.9rem; color:var(--color-r5); text-align: right;">{{gear2|slice:"0:5"}}
          </div>
          {% endif %}
          {% endfor %}
          </span>
          {% endif %}
        </th>
        
      </tr>
      <tr>
        <th><span style="font-size:1.2rem;">ì˜ˆìƒ</span></th>
        <th colspan="1" rowspan="1"><span style="font-size:1.2rem; text-transform: capitalize;">Race Info.</span></th>
        <th rowspan="1" style="vertical-align:middle">
          <span class="tooltip" style="font-size:1.0rem; color:var(--color-r4);">(ì•”)
            <span class="tooltip-text" style="font-size:1.1rem;">ğŸ ì•”ë§ ìˆ˜</span>
          </span>
        </th>
        <th>
          <!-- <a href="{% url 'get_race_awardee' r.rdate 'trainer' r.trainer r.jockey r.trainer r.host %}"
            onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;"> -->
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">
              ğŸ›–<span class="tooltip-text" style="font-size:1.1rem;">ğŸ›–&nbsp;[<span style="color:var(--color-r3);">{{r.trainer}}</span>]&nbsp;ë§ˆë°© ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì </span>
            </span>
          </a>
        </th>
          
        <th>
          <!-- <a href="{% url 'get_race_awardee' r.rdate 'host' r.host r.jockey r.trainer r.host %}"
            onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;"> -->
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' '%' r.host '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'jt_analysis_multi', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">
              ğŸ¤ <span class="tooltip-text" style="font-size:1.1rem;">ğŸ¤ &nbsp;[<span style="color:var(--color-r3);">{{r.host}}</span>]&nbsp;ë§ˆì£¼ ìµœê·¼ 1ë…„ ê²½ì£¼ì„±ì </span>
            </span>
          </a>
        </th>
        <th rowspan="1">
          <span class="tooltip" style="font-size:1.0rem;">ğŸŒ¥ï¸
            <span class="tooltip-text" style="font-size:1.1rem;">ğŸŒ¥ï¸&nbsp;ë‚ ì”¨ / ì£¼ë¡œë¹ ë¥´ê¸°</span>
          </span>
        </th>
        <th><span style="font-size:1.2rem;">íŠ¸ë™</span></th>

        <th colspan="3"><span class="visible-big" style="text-transform:lowercase; font-style: italic; font-size:1.15rem; padding:1px 4px; border-radius: 7px;">ê²½ì£¼í¸ì„±ê°•ë„</span></th>
        <!-- <th><span style="font-size:1.2rem;">G3F</span></th>
        <th><span style="font-size:1.2rem;">G2F</span></th>
        <th><span style="font-size:1.2rem;">G1F</span></th> -->
        <th rowspan="1">
          <span class="visible-big" style="text-transform:lowercase; font-style: italic; font-size:1.15rem; padding:1px 4px; border-radius: 7px;">thethe9</span>
        </th>
        <th><span style="font-size:1.2rem;">ì—°ì‹</span></th>
        
      </tr>


    </thead>
    <tbody>
      {% for hr in hr_records %}
      {% if r.horse == hr.horse %}

      <tr align="center">
        {# rating #}
        <td>
          {% if hr.rating %}
          <div style="font-size:1.2rem; padding:2px 4px; color:var(--color-r3); font-family: Arial; border-radius: 7px; background-color:var(--color-bg);">{{hr.rating}}</div>
          {% else %}
          <div>&nbsp;</div>
          {% endif %}

          {% if hr.judge == NONE %}
          <span class="tooltip">
            <progress value={{hr.r_pop}} max="99" style="width: 1.5rem"></progress>
            <span class="tooltip-text" style="z-index: 9;">
              <div style="font-size: 1.1rem;">ğŸ“Š&nbsp;ì¸ê¸°ë„&nbsp;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{% if hr.r_pop %}{{hr.r_pop}}{% endif %}</div>
            </span>
          </span>
          {% endif %}
        </td>

        {# ì¸ê¸°ìˆœìœ„ / í”„ë¡œê·¸ë¨ ì˜ˆìƒìˆœìœ„ #}
        <td style="text-align: center;">
          {% if hr.pop_rank %}
          {% if hr.judge == NONE %}
            {% if hr.pop_rank == 1 %}
            <sup style="color:var(--color-r1); font-size: 1.1rem;">
              {% if hr.pop_rank > 20 %}ï¹†{% else %} {{hr.pop_rank}} {% endif %}
            </sup>
            {% elif hr.pop_rank == 2 %}
            <sup style="color:var(--color-r2); font-size: 1.1rem;">
              {% if hr.pop_rank > 20 %}ï¹†{% else %} {{hr.pop_rank}} {% endif %}
            </sup>
            {% elif hr.pop_rank == 3 %}
            <sup style="color:var(--color-r3); font-size: 1.1rem;">
              {% if hr.pop_rank > 20 %}ï¹†{% else %} {{hr.pop_rank}} {% endif %}
            </sup>
            {% else %}
            <sup style="font-size: 1.1rem;">
              {% if hr.pop_rank > 20 %}ï¹†{% else %} {{hr.pop_rank}} {% endif %}
            </sup>
            {% endif %}
            
            {% if hr.p_rank %}
              {% if hr.p_rank == 1 %}
              <sub style="color:var(--color-r1); font-size: 1.1rem;">
                {% if hr.p_rank > 20 %}ï¹†{% else %} {{hr.p_rank}} {% endif %}
              </sub>
              {% elif hr.p_rank == 2 %}
              <sub style="color:var(--color-r2); font-size: 1.1rem;">
                {% if hr.p_rank > 20 %}ï¹†{% else %} {{hr.p_rank}} {% endif %}
              </sub>
              {% elif hr.p_rank == 3 %}
              <sub style="color:var(--color-r3); font-size: 1.1rem;">
                {% if hr.p_rank > 20 %}ï¹†{% else %} {{hr.p_rank}} {% endif %}
              </sub>
              {% else %}
              <sub style="font-size: 1.1rem;">
                {% if hr.p_rank > 20 %}ï¹†{% else %} {{hr.p_rank}} {% endif %}
              </sub>
              {% endif %}
            {% endif %}
          {% endif %}
          {% endif %}
        </td>
        
        {# ê²½ì£¼ì •ë³´ #}
        <td>
          <a style="text-decoration:underline" href="{% url 'race_result' hr.rcity hr.rdate hr.rno hr.horse r_condition.rcity r_condition.rdate r_condition.rno %}"
            onclick="window.open(this.href, 'w_result', 'width=1000, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">

            <div style="text-align: left; color:dodgerblue; font-style: italic; text-align: left;">
              <span style="font-size: 1.2rem; font-family: Arial;">'{{hr.rdate|slice:"2:4" }}.{{hr.rdate|slice:"4:6" }}.{{hr.rdate|slice:"6:8"}}</span>
              Â­Â­Â­Â»
              {% if r_condition.distance == hr.distance %}
              <span style="font-size: 1.2rem; font-family: Arial; color:tomato; font-weight: 700;">{{hr.distance}}</span>
              {%else%}
              <span style="font-size: 1.2rem; font-family: Arial; font-weight: 300;">{% if hr.distance %}{{hr.distance}}{% else %}ì·¨ì†Œ{% endif %}</span>
              {%endif%}
              &nbsp;
            </div>
          
            {# ê²½ì£¼ì •ë³´ #}
            <div style="text-align: right; font-style: italic;">
              {% if hr.i_cycle %}
                {% if hr.i_cycle <= 16 %}
                <span style="font-family: Arial; color:var(--color-light); border-radius: 5px; background-color:var(--color-r1); padding:2px 3px;">{{hr.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% elif hr.i_cycle >= 68 %}
                <span style="font-family: Arial; color:var(--color-light); border-radius: 5px; background-color:var(--color-r2); padding:2px 3px; font-size:0.9rem;">{{hr.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% else %}
                <span style="font-family: Arial; color:var(--color-bg); border-radius: 5px; background-color:aquamarine; padding:2px 3px;">{{hr.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% endif %}
              {% endif %}
            
              {% if hr.grade %}
                {% if hr.grade|slice:"0:2" == 'ì£¼í–‰'%}
                <span style="font-size: 1.1rem; color:var(--color-r4)">{{hr.grade|slice:"0:4"}}</span>
                {%else%}

                  {% if hr.grade|slice:"1:2" == 'O' %}
                    <span class="tooltip" style="font-size: 1.0rem; color:var(--color-light); background-color: var(--color-bg); border-radius: 7px; padding: 1px 2px;">
                      {{hr.grade|slice:"0:2"}}
                      <span class="tooltip-text" style="font-size: 1.1rem;">ğŸ†&nbsp;{{hr.rname}}</span>
                    </span>

                  {% else %}
                    {% if hr.grade|slice:"0:2" == r_condition.grade|slice:"0:2" %}
                    <span style="font-size: 1.1rem; color:tomato;">{{hr.grade|slice:"0:2"}}</span>
                    {% else %}
                    <span style="font-size: 1.1rem;">{{hr.grade|slice:"0:2"}}</span>
                    {% endif %}
                  {%endif %}
                  
                  {% if hr.dividing|slice:"0:2" == r_condition.dividing|slice:"0:2"%}
                  <span style="font-size: 1.1rem; color:tomato;">{{hr.dividing|slice:"0:1"}}</span>
                  {% else %}
                  <span style="font-size: 1.1rem;">{{hr.dividing|slice:"0:1"}}</span>
                  {% endif %}

                {%endif%}
              {%endif%}
              &nbsp;
              {% if hr.h_sex|slice:"0:1" == 'ê±°' %}
              <span class="tooltip" style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-style: normal; background-color: var(--color-light); padding: 2px 4px; border-radius: 7px;">{{hr.h_sex}}
                <span class="tooltip-text" style="font-size: 1.1rem;">{{hr.rcity}} {{hr.rno}}á´¿</span></span>
              {% else %}
              <span class="tooltip" style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); padding: 2px 4px; ">{{hr.h_sex}}
                <span class="tooltip-text" style="font-size: 1.1rem;">{{hr.rcity}} {{hr.rno}}á´¿</span></span>
              {% endif %}
            </div>
          </a>
        </td>
        
        {# ì¶œì£¼ë§ˆìˆ˜ / ì•”ë§ ìˆ˜#}
        <td>
          {% if hr.h_mare %}
          <div style="font-size: 1.2rem; font-family: Arial;">{{hr.h_cnt}}</div>
          <div style="font-size: 1.05rem; font-family: Arial; color: var(--color-r4);">({{hr.h_mare}})</div>
          {% endif %}
        </td>

        {# ë§ˆì²´ì¤‘ #}
        <td style="font-size: 1.2rem;">
          {% if hr.h_weight %}
          <div style="text-align:right; font-family: Arial; text-align: left; color:var(--color-gray);">{{hr.h_weight}}</div>
          <div style="text-align:right; font-family: Arial; font-size: 1.1rem;">
            {% if hr.w_change|slice:"0:1" == '-' %}
            <span style="font-family: Arial; font-style: italic; color:var(--color-r1); padding:2px 4px; border-radius: 15px; background-color:var(--color-main-light); ">{{hr.w_change}}</span>
            {% else %}
            <span style="font-family: Arial; font-style: italic; color:var(--color-r5); padding:2px 4px; border-radius: 15px; background-color:var(--color-main-light); ">{{hr.w_change}}</span>
            {% endif %}
          </div>
          
          {% endif %}
        </td>

        {# ë¶€ë‹´ì¤‘ëŸ‰ #}
        <td style="font-size: 1.2rem;">
          <a href="{% url 'jt_analysis' '%' hr.rdate|mul:1|sub:10000 hr.rdate hr.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' hr.handycap %}" onclick="window.open(this.href, 'jt_analysis', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <div style="font-size: 1.15rem; text-align:left; font-family: Arial; color:var(--color-gray);">{% if hr.handycap %}{{hr.handycap}}{% endif %}</div>

            {% if hr.handycap|sub:r.handycap == 0 %}
            <div style="font-size: 1.1rem; font-family: Arial; text-align: right;">-&nbsp;&nbsp;</div>
            {% elif hr.handycap|sub:r.handycap > 0 %}
            <div style="font-size: 1.1rem; font-family: Arial; font-style: italic; color:var(--color-r5); padding:1px 1px; border-radius: 15px; background-color:var(--color-main-light);">+{{hr.handycap|sub:r.handycap|floatformat:1}}</div>
            {% else %}
            <div style="font-size: 1.1rem; font-family: Arial; font-style: italic; color:var(--color-r1); padding:1px 1px; border-radius: 15px; background-color:var(--color-main-light);">{{hr.handycap|sub:r.handycap|floatformat:1}}</div>
          {% endif %}
          </a>
        </td>

        {# ê¸°ìˆ˜ / ë§ˆë°© #}
        <td align="left" style="font-size: 1.2rem">
          <a href="{% url 'get_race_awardee' hr.rdate 'jockey' hr.jockey hr.jockey r.trainer r.host %}"
            onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;">

          {% if hr.jockey %}

            {% if hr.jockey_old %}  {# ê¸°ìˆ˜ë³€ê²½ #}
              {% if r.jockey == hr.jockey %}
              <div style="text-align: left;">
                <span class="blink tooltip" style="color:var(--color-light-gray)">{{hr.jockey|slice:"0:3"}}
                  <span class="tooltip-text">ğŸ´&nbsp;ê¸°ìˆ˜ë³€ê²½:&nbsp;'{{hr.jockey_old}}'ì—ì„œ<br>ğŸ´&nbsp;ë³€ê²½ì‚¬ìœ :&nbsp;{{hr.reason}}</span>
                </span>
              </div>
              {%else%}
              <div style="text-align: left;">
                <span class="blink tooltip" style="color:var(--color-r3); font-style: italic;">{{hr.jockey|slice:"0:3"}}<span class="tooltip-text">ğŸ´&nbsp;ê¸°ìˆ˜ë³€ê²½:&nbsp;'{{hr.jockey_old}}'ì—ì„œ<br>ğŸ´&nbsp;ë³€ê²½ì‚¬ìœ :&nbsp;{{hr.reason}}</span></span>
              </div>
              {%endif%}
            {% else %}
              {% if r.jockey == hr.jockey %}
              <div style="text-align: left; color:var(--color-light-gray);">{{hr.jockey|slice:"0:3"}}</div>
              {%else%}
              <div style="text-align: left; color:var(--color-r5);">{{hr.jockey|slice:"0:3"}}</div>
              {%endif%}
            {%endif%}
          
          {%endif%}

          </a>

          {% if r.trainer == hr.trainer %}
            <div style="color:var(--color-r1);  text-align: right; font-size: 1.15rem;">
              <a href="{% url 'get_race_awardee' hr.rdate 'trainer' hr.trainer r.jockey hr.trainer r.host %}" onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;">
                <span style="color:var(--color-light-gray); font-size: 1.15rem;">{{hr.trainer}}</span>
              </a>
            </div>
            {%else%}
            <div style="color:var(--color-r1);  text-align: right; font-size: 1.15rem;">
              <a href="{% url 'get_race_awardee' hr.rdate 'trainer' hr.trainer r.jockey hr.trainer r.host %}" onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;">
                <span style="color:var(--color-r1); font-size: 1.15rem;">{{hr.trainer}}</span>
              </a>
            </div>
          {%endif%}
          
        </td>

        {# J&T % / ë§ˆì£¼ #}
        <td style="font-size: 1.2rem">

          {% if hr.judge == NONE %} {# ì£¼í–‰ê²€ì‚¬ ì•„ë‹ˆë©´  #}
            {% if hr.jockey_old %}
              {# ê¸°ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ê¸°ì¡´ ê¸°ìˆ˜ì˜ ê¸°ë¡ì„ ë¼ì¸ ìŠ¤ë£¨ #}

              <div style="font-size: 1.2rem; color:gray; text-align: right;">
                <a href="{% url 'jt_analysis' '%' hr.rdate|mul:1|sub:10000 hr.rdate hr.jockey hr.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' %}"
                  onclick="window.open(this.href, 'jt_analysis', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
                  <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); z-index:9; text-decoration:line-through;">
                    {% if hr.jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                
                    <span class="tooltip-text" style="font-family: Arial; font-size: 1.2rem; z-index:9;">
                      <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp;ê¸°ìˆ˜ ë³€ê²½ì „&nbsp;{{hr.jockey_old}}&nbsp;ï¹†&nbsp;{{hr.trainer}}</div>
                      <hr>
                      <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ê²½ì£¼ì¼ ê¸°ì¤€ 1ë…„ê°„ ì¶œì£¼ íšŸìˆ˜ :
                
                        {% if hr.jt_cnt %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{hr.jt_cnt}}</span>
                        <span style="font-family: Arial; color:var(--color-r3)">{{hr.jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r4)">{{hr.jt_2nd|sub:hr.jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r5)">{{hr.jt_3rd|sub:hr.jt_2nd}}</span>
                        {% else %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                        <span style="font-family: Arial; color:var(--color-r3)">0</span>
                        <span style="font-family: Arial; color:var(--color-r4)">0</span>
                        <span style="font-family: Arial; color:var(--color-r5)">0</span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if hr.jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r2);">{{hr.jt_2nd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if hr.jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r1);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                
                    </span>
                  </span>
                </a>
              </div>

            {% else %}    {# ê¸°ìˆ˜ë³€ê²½ ì—†ì„ ë•Œ #}
              
              {# ê¸°ìˆ˜ ì¡°êµì‚¬ ì—°ëŒ€ ì¶œì£¼ ë³µìŠ¹ íšŒìˆ˜ #}
              <div style="font-size: 1.15rem; color:gray; text-align: right;">
                <a href="{% url 'jt_analysis' '%' hr.rdate|mul:1|sub:10000 hr.rdate hr.jockey hr.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' %}"
                  onclick="window.open(this.href, 'jt_analysis', 'width=1350, height=1000, toolbars=no, scrollbars=yes'); return false;">
                  <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); z-index:9;">
                    {% if hr.jt_cnt > 0 %}
                      {% if hr.jt_3rd|mul:100|div:hr.jt_cnt >= 50.0 %}
                      <span style="font-family: Arial; color: var(--color-r1);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif hr.jt_3rd|mul:100|div:hr.jt_cnt >= 40.0 %}
                      <span style="font-family: Arial; color: var(--color-r2);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif hr.jt_3rd|mul:100|div:hr.jt_cnt >= 30.0 %}
                      <span style="font-family: Arial; color: var(--color-r3);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif hr.jt_3rd|mul:100|div:hr.jt_cnt >= 20.0 %}
                      <span style="font-family: Arial; color: var(--color-r4);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% elif hr.jt_3rd|mul:100|div:hr.jt_cnt >= 10.0 %}
                      <span style="font-family: Arial; color: var(--color-r5);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% else %}
                      <span style="font-family: Arial; color: var(--color-light-gray);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% endif %}
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}

                    <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
                      <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp; {{hr.jockey}}&nbsp;ï¹†&nbsp;{{hr.trainer}}</div>
                      <hr>
                      <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ê²½ì£¼ì¼ ê¸°ì¤€ ìµœê·¼ 1ë…„ê°„ ê²½ì£¼ì„±ì  : 

                        {% if hr.jt_cnt %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{hr.jt_cnt}}</span>
                        <span style="font-family: Arial; color:var(--color-r3)">{{hr.jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r4)">{{hr.jt_2nd|sub:hr.jt_1st}}</span>
                        <span style="font-family: Arial; color:var(--color-r5)">{{hr.jt_3rd|sub:hr.jt_2nd}}</span>
                        {% else %}
                        <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                        <span style="font-family: Arial; color:var(--color-r3)">0</span>
                        <span style="font-family: Arial; color:var(--color-r4)">0</span>
                        <span style="font-family: Arial; color:var(--color-r5)">0</span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if hr.jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r2);">{{hr.jt_2nd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                      <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                        3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        {% if hr.jt_cnt > 0 %}
                        <span style="font-family: Arial; color: var(--color-r1);">{{hr.jt_3rd|mul:100|div:hr.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% else %}
                        <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                        {% endif %}
                      </div>
                
                    </span>
                  </span>
                </a>
              </div>

            {% endif %}
          {% endif %}
          
          {% if r.host == hr.host %}
          <div style="color:var(--color-gray); text-align: left; font-size: 1.15rem">
            <a href="{% url 'get_race_awardee' hr.rdate 'host' hr.host r.jockey r.trainer hr.host %}" onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;">
              <span style="color:var(--color-light-gray); text-align: left; font-size: 1.15rem">{{hr.host|slice:"0:4"}}</span>
            </a>
          </div>
          {%else%}
          <div style="color:var(--color-r1); text-align: left; font-size: 1.15rem;">
            {% if hr.host %}
            <a href="{% url 'get_race_awardee' hr.rdate 'host' hr.host r.jockey r.trainer hr.host %}" onclick="window.open(this.href, '_blank', 'width=1000, height=700, toolbars=no, scrollbars=yes'); return false;">
              <span style="color:var(--color-r1); text-align: left; font-size: 1.15rem">{{hr.host|slice:"0:4"}}</span>
            </a>
            {% endif %}
          </div>
          {%endif%}
        </td>

        {# ë‚ ì”¨ / ì£¼ë¡œ #}
        <td style="font-size: 1.2rem">
          
          {% if hr.rstate == 'ë¶ˆëŸ‰' or hr.rstate == 'í¬í™”' %}
          <div style="text-align:left; font-family: Arial; font-size: 1.1rem; color:tomato;">{{hr.rstate|slice:"0:1"}}&nbsp;{{hr.rmoisture}}</div>
          {% else %}
          <div style="text-align:left; font-family: Arial; font-size: 1.1rem; color:var(--color-gray)">{% if hr.handycap %}{{hr.rstate|slice:"0:1"}}&nbsp;{{hr.rmoisture}}{% endif %}</div>
          {% endif %}

          {% if hr.weather %}
          <div style="text-align: center; font-family: Arial;">
            <span style="font-size: 1.0rem;">
            {% if hr.weather|slice:"0:1" == 'ë§‘' %}â˜€ï¸
            {% elif hr.weather|slice:"0:1" == 'í' %}â˜ï¸
            {% elif hr.weather|slice:"0:1" == 'ë¹„' %}â˜”ï¸
            {% elif hr.weather|slice:"0:1" == 'ëˆˆ' %}â˜ƒï¸
            {% else %}ï¹†
            {% endif %}
            </span>
          
            {% if hr.race_speed == 'â‘¡' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">2</span>
            {% elif hr.race_speed == 'â‘¢' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">3</span>
            {% elif hr.race_speed == 'â‘£' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r2); padding: 1px 3px; color:var(--color-light);">4</span>
            {% elif hr.race_speed == 'â‘¤' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r3); padding: 1px 3px; color:var(--color-bg);">5</span>
            {% elif hr.race_speed == 'â‘¥' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r3); padding: 1px 3px; color:var(--color-dark-medium);">6</span>
            {% elif hr.race_speed == 'â‘¦' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">7</span>
            {% elif hr.race_speed == 'â‘§' %}
            <span style="font-weight: 400; font-style: normal; font-size: 1.0rem; border-radius: 7px; background-color: var(--color-r1); padding: 1px 3px; color:var(--color-light);">8</span>
            {% else %}
            <span>{% if hr.race_speed %}{{hr.race_speed}}{% else %}{% endif %}</span>
            {% endif %}
          
          </div>
          
          {% endif %}

        </td>
        
        <td align="right" style="font-size: 1.15rem;">
          {% if hr.rs1f %}
            {% if r_condition.distance == hr.distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{hr.rs1f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{hr.rs1f|slice:"-4:"}}</div>
            {%endif%}
          {%endif%}

          {% if hr.adv_track >= 0 %}
          <div style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-main-light); color:var(--color-r2);">
            {{hr.adv_track|floatformat:1}}
          </div>
          {% else %}
          <div style="text-align: right; font-size: 0.99rem; font-family: Arial; font-style: italic; padding:1px 2px; border-radius: 15px; background-color:var(--color-light); color:var(--color-r1);">
            {{hr.adv_track|floatformat:1}}
          </div>
          
          {% endif %}
          
        </td>

        <td align="center" style="font-size: 1.15rem;">{# G3F / ê²½ì£¼í¸ì„± í•˜ #}
          
          {% if hr.rg3f %}
            {% if r_condition.distance == hr.distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{hr.rg3f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{hr.rg3f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if hr.r_judge %}
          <div>
            {% if hr.grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
              {% if hr.r_judge|mul:"1" < -5 %}
              <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{hr.r_judge}}
              </span>
              {% else %}
              <span>&nbsp;</span>
              {% endif %}
            {% else %}
            {% if hr.r_judge|mul:"1" < -5 %}
              <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{hr.r_judge}}
              </span>
              {% else %}
              <span>&nbsp;</span>
              {% endif %}
            {% endif %}

          </div>
          {% endif %}
          
            
        </td>

        <td align="center" style="font-size: 1.15rem;">
          {% if hr.rg2f %}
            {% if r_condition.distance == hr.distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{hr.rg2f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{hr.rg2f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if hr.grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
            {% if hr.r_judge %}
            <div>
              {% if hr.r_judge|mul:"1" >= -5 and hr.r_judge|mul:"1" <= 5 %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{hr.r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% else %}
            {% if hr.r_judge %}
            <div>
              {% if hr.r_judge|mul:"1" >= -5 and hr.r_judge|mul:"1" <= 5 %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{hr.r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
          
            
        </td>
        <td align="center" style="font-size: 1.15rem;">
          {% if hr.rg1f %}
            {% if r_condition.distance == hr.distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">{{hr.rg1f|slice:"-4:"}}</div>
            {%else%}
            <div style="font-family: Arial;">{{hr.rg1f|slice:"-4:"}}</div>
            {%endif%}
          {% endif %}

          {% if hr.grade|slice:"1:2" == r_condition.grade|slice:"1:2" %}
            {% if hr.r_judge %}
            <div>
              {% if hr.r_judge|mul:"1" > 5  %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-bg); color:var(--color-main-light);">
                {{hr.r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% else %}
            {% if hr.r_judge %}
            <div>
              {% if hr.r_judge|mul:"1" > 5  %} 
                <span style=" font-size: 0.99rem; font-family: Arial; padding:2px 4px; border-radius: 15px; background-color:var(--color-r5); color:var(--color-main-light);">
                {{hr.r_judge}}
                </span>
              {% else %}
                <span>&nbsp;</span>
              {% endif %}
            </div>
            {% endif %}
          {% endif %}
          
        </td>

        {# ê²½ì£¼ê¸°ë¡/ì˜ˆìƒê¸°ë¡ #}
        <td align="right">
          {% if hr.record %}
          {% if hr.rank == 1 %}
          <div style="border:1px solid orange; border-radius: 10px; text-align: center; font-style: italic; color:var(--color-r1); font-weight: 500; font-size: 1.15rem; font-family: Arial;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.record|slice:"0:1"}}&nbsp;{{hr.record|slice:"1:6"}} {% endif %}
          </div>
          {% elif hr.rank == 2 %}
          <div style="border:1px solid orange; border-radius: 10px; text-align: center; font-style: italic; color:var(--color-r2); font-weight: 500; font-size: 1.15rem; font-family: Arial;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.record|slice:"0:1"}}&nbsp;{{hr.record|slice:"1:6"}} {% endif %}
          </div>
          {% elif hr.rank == 3 %}
          <div style="border:1px solid orange; border-radius: 10px; text-align: center; font-style: italic; color:var(--color-r3); font-weight: 500; font-size: 1.15rem; font-family: Arial;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.record|slice:"0:1"}}&nbsp;{{hr.record|slice:"1:6"}} {% endif %}
          </div>
          
          {% else %}
          <div style="border:1px solid orange; border-radius: 10px; text-align: center; font-style: italic; font-size: 1.15rem; font-family: Arial;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.record|slice:"0:1"}}&nbsp;{{hr.record|slice:"1:6"}} {% endif %}
          </div>
          {% endif %}

          <div class="tooltip" style="text-align: right; color:var(--color-gray); font-weight: 500; font-size: 1.1rem; font-family: Arial; font-style: italic;">
            {% if hr.i_convert %}
            {% if hr.rank > 20 or hr.grade|slice:"0:2" == 'ì£¼í–‰' %}{% else %}{{hr.i_convert|t2s}}{% endif %}
            
            <span class="tooltip-text" style="text-align: center; font-size: 1.1rem; border:1px solid orange; border-radius: 10px; padding: 4px 20px; ">ğŸ¦¿thethe9 ì˜ˆìƒ<br>&nbsp;{{hr.p_record|slice:"0:1"}}&nbsp;{{hr.p_record|slice:"1:6"}}</span>
            {% endif %}

          </div>
          {%endif%}

        </td>
        
        {# gate #}
        <td style="font-size: 1.2rem;">
          
          <span style="font-family: Arial; border-radius: 10px; background-color:bisque; padding: 3px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.gate}} {% endif %}
          </span>
          
        </td>

        {# corners #}
        <td style="font-size: 1.1rem; font-family: Arial;">
          {% if hr.corners %}
            <div style="color:rgb(0, 128, 255); text-align: left; font-style: italic; font-family: Arial;">
              {{hr.corners|slice:"0:10"}}
            </div>
            <div style="color:rgb(0, 128, 255); text-align: right; font-style: italic; font-family: Arial;">
              {{hr.corners|slice:"10:"}}
            </div>
          {% endif %}
        </td>

        {# rank #}
        <td style="font-size: 1.2rem; font-family: Arial;">
          {% if hr.rank %}
          {% if hr.rank == 1 %}
          <span style="font-family: Arial; border-radius: 10px; background-color:var(--color-r1); color:var(--color-light); padding: 2px 4px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          {% elif hr.rank == 2 %}
          <span style="font-family: Arial; border-radius: 10px; background-color:var(--color-r2); color:var(--color-light); padding: 2px 4px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          {% elif hr.rank == 3 %}
          <span style="font-family: Arial; border-radius: 10px; background-color:var(--color-r3); color:var(--color-bg); padding: 2px 4px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          {% elif hr.rank == 4 %}
          <span style="font-family: Arial; border-radius: 10px; background-color:var(--color-r4); color:var(--color-bg); padding: 2px 4px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          {% elif hr.rank == 5 %}
          <span style="font-family: Arial; border-radius: 10px; background-color:var(--color-r5); color:var(--color-light); padding: 2px 4px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          
          {% else %}
          <span style="font-family: Arial; border-radius: 10px; background-color:bisque; padding: 3px;">
            {% if hr.rank > 20 %}ï¹†{% else %} {{hr.rank}} {% endif %}
          </span>
          {% endif %}
          {% endif %}
        </td>

        {# ì°©ì°¨ #}
        <td align="left">
          {% if hr.gap %}
            {% if hr.gap|length >= 3 %}
            <span style="text-align: left; font-size: 0.7rem; color: var(--color-r1); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ hr.gap}}</span>
            {% else %}
            <span style="text-align: left; font-size: 1.0rem; color: var(--color-r1); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ hr.gap}}</span>
            {%endif%}
          {% else %}
            <div>&nbsp;</div>
          {%endif%}

          {% if hr.gap_b %}
          <div style="text-align: right;">
            {% if hr.gap_b|length >= 3 %}
            <span style="text-align: right; font-size: 0.7rem; color: var(--color-bg); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ hr.gap_b}}</span>
            {% else %}
            <span style="text-align: right; font-size: 1.0rem; color: var(--color-bg); background-color: var(--color-light); border-radius: 7px; padding: 2px 4px;">{{ hr.gap_b}}</span>
            {%endif%}
          </div>
          {% else %}
          <div>&nbsp;</div>
          {%endif%}
        </td>

        {# ë‹¨ì‹ / ì—°ì‹ #}
        <td align="right" style="font-size: 1.1rem; font-family: Arial;">
        {% if hr.alloc1r %}
          {% if r_condition.distance == hr.distance %}
            <div style="color:rgb(0, 128, 255); font-weight: 500; font-family: Arial;">
          {%else%}
            <div style="font-family: Arial;">
          {%endif%}
            {{hr.alloc1r}}<br>{{hr.alloc3r}}</div>

        {%endif%}
        </td>
        
        {# ë§ˆí•„ì¥êµ¬, ê²½ì£¼ íŠ¹ì´ì‚¬í•­ ë“±ë¡ #}
        <td align="center">
          {% if request.user.username == 'admin' %}
          <a href="{% url 'write_significant' hr.rdate hr.horse %}"
            onclick="window.open(this.href, 'w_significant', 'top=0, left=0, width=550, height=440'); return false;">
            
            <div style="font-family: Arial; font-size:0.9rem; color:var(--color-gray); text-align: right;">
              {% if hr.r_etc %}{{hr.r_etc|slice:"0:5"}}{% else %}ğŸ€«{% endif %}
            </div>
            <div style="font-family: Arial; font-size:0.9rem; color:var(--color-gray); text-align: center;">
              {% if hr.r_flag and hr.r_flag > '0' %}
                ì§‘ê³„âŒ
              {% else %}
                {% if hr.r_etc %}{{hr.r_etc|slice:"5:10"}}{% else %}ğŸ€«{% endif %}
              {% endif %}
            </div>
          </a>
          {% else %}
          <div style="font-family: Arial; font-size:0.9rem; color:var(--color-gray); text-align: right;">{% if hr.gear1 %}{{hr.gear1|slice:"0:5"}}{% endif %}
          </div>
          <div style="font-family: Arial; font-size:0.9rem; color:var(--color-gray); text-align: right;">{% if hr.gear2 %}{{hr.gear2|slice:"0:5"}}{% endif %}
          </div>
          {% endif %}
        </td>
        
      </tr>
      {%endif%}

      {% endfor %}

    </tbody>
  </table>
</div>