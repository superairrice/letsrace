{% load humanize %}
{% load mathfilters %}

<style>
  .home-right-insights,
  .home-right-top3 {
    font-family: "Pretendard", "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", "Segoe UI", sans-serif;
    text-rendering: optimizeLegibility;
  }

  .home-right-insights {
    margin-bottom: 0.75rem;
    display: grid;
    gap: 0.55rem;
  }

  .home-right-insight {
    border: 1px solid var(--color-dark-light);
    border-radius: 0.7rem;
    background: rgba(18, 24, 38, 0.72);
    padding: 0.72rem 0.8rem;
  }

  .home-right-insight__head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.45rem;
  }

  .home-right-top3 {
    margin-bottom: 0.55rem;
    border: 1px solid var(--color-dark-light);
    border-radius: 0.72rem;
    background: rgba(18, 24, 38, 0.72);
    padding: 0.78rem 0.86rem;
    box-shadow: none;
  }

  .home-right-top3__head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 0.55rem;
    gap: 0.5rem;
  }

  .home-right-top3__title {
    font-size: 1.24rem;
    color: var(--color-light);
    font-weight: 700;
    letter-spacing: 0.01em;
  }

  .home-right-top3__meta {
    font-size: 1.0rem;
    color: #9cafc8;
  }

  .home-right-top3__city-list {
    display: grid;
    gap: 0.46rem;
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  .home-right-top3__city {
    border: none;
    border-radius: 0.58rem;
    background: rgba(12, 18, 31, 0.55);
    padding: 0.58rem 0.62rem;
    box-shadow: inset 0 0 0 1px rgba(137, 153, 184, 0.12);
  }

  .home-right-top3__city-name {
    font-size: 1.08rem;
    font-weight: 700;
    color: #7ecff3;
    margin-bottom: 0.34rem;
  }

  .home-right-top3__rows {
    display: grid;
    gap: 0.24rem;
  }

  .home-right-top3__row {
    display: flex;
    gap: 0.45rem;
    font-size: 1.05rem;
    line-height: 1.38;
    color: #d2dcef;
    align-items: flex-start;
  }

  .home-right-top3__label {
    flex: 0 0 2.4rem;
    color: #a8b7cf;
    font-weight: 700;
    letter-spacing: 0.01em;
    padding-top: 0.2rem;
  }

  .home-right-top3__value {
    color: #d9e3f3;
    display: flex;
    flex-wrap: wrap;
    gap: 0.24rem;
  }

  .home-right-top3__pill {
    display: inline-flex;
    align-items: center;
    gap: 0.26rem;
    max-width: 100%;
    padding: 0.12rem 0.44rem;
    border-radius: 999px;
    border: none;
    background: rgba(30, 41, 63, 0.76);
    color: #dce7f6;
    font-size: 0.98rem;
    line-height: 1.25;
  }

  .home-right-top3__pill[data-tip] {
    cursor: help;
  }

  .home-right-top3__pill-rank {
    min-width: 1.6rem;
    height: 1.6rem;
    display: inline-grid;
    place-items: center;
    border-radius: 999px;
    background: rgba(66, 187, 232, 0.12);
    border: 2px solid rgba(145, 200, 224, 0.38);
    color: #b4eeff;
    font-size: 1.0rem;
    font-weight: 700;
    line-height: 1;
  }

  .home-right-top3__pill-rank.rank-1 {
    border-color: var(--color-r1);
    color: var(--color-r1);
  }

  .home-right-top3__pill-rank.rank-2 {
    border-color: var(--color-r2);
    color: var(--color-r2);
  }

  .home-right-top3__pill-rank.rank-3 {
    border-color: var(--color-r3);
    color: var(--color-r3);
  }

  .home-right-top3__pill-name {
    color: #92dcff;
    font-weight: 700;
    font-size: 1rem;
  }

  .home-right-top3__pill-detail {
    color: #c1d0e8;
    font-weight: 600;
    font-variant-numeric: tabular-nums;
    font-size: 0.96rem;
  }

  .home-right-top3__empty {
    font-size: 1rem;
    color: #8ea1be;
    padding: 0.2rem 0.1rem;
  }

  .home-right-top3__table-wrap {
    overflow-x: auto;
    border: 1px solid rgba(130, 151, 182, 0.2);
    border-radius: 0.56rem;
    background: rgba(12, 18, 31, 0.52);
  }

  .home-right-top3__city-panels {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 0.46rem;
  }

  .home-right-top3__city-panel {
    border: none;
    border-radius: 0.58rem;
    background: rgba(12, 18, 31, 0.55);
    padding: 0.5rem 0.56rem 0.58rem;
    box-shadow: inset 0 0 0 1px rgba(137, 153, 184, 0.12);
  }

  .home-right-top3__city-title {
    font-size: 1.08rem;
    font-weight: 700;
    color: #7ecff3;
    margin: 0 0 0.38rem;
    letter-spacing: 0.01em;
  }

  .home-right-top3__table {
    width: 100%;
    border-collapse: collapse;
    min-width: 0;
    table-layout: fixed;
  }

  .home-right-top3__table th,
  .home-right-top3__table td {
    padding: 0.24rem 0.42rem;
    border-bottom: 1px solid rgba(124, 145, 176, 0.16);
    font-size: 0.92rem;
    line-height: 1.28;
    vertical-align: middle;
  }

  .home-right-top3__table td {
    padding-top: 0.14rem;
    padding-bottom: 0.14rem;
  }

  .home-right-top3__table th {
    font-size: 0.84rem;
    color: #9aacc4;
    background: rgba(20, 27, 43, 0.62);
    text-align: left;
    font-weight: 700;
    letter-spacing: 0.01em;
  }

  .home-right-top3__table tr:last-child td {
    border-bottom: none;
  }

  .home-right-top3__table-group {
    color: #aebfd6;
    font-weight: 700;
    width: 3.4rem;
    text-align: center;
  }

  .home-right-top3__table-rank {
    width: 3.2rem;
    text-align: center;
  }

  .home-right-top3__table-name {
    color: #cdd9ea;
    font-weight: 700;
  }

  .home-right-top3__table-top3 {
    text-align: right;
    color: #b9cade;
    font-variant-numeric: tabular-nums;
    font-weight: 600;
    white-space: nowrap;
  }

  .home-right-top3__rank-badge {
    min-width: 1.48rem;
    height: 1.48rem;
    display: inline-grid;
    place-items: center;
    border-radius: 999px;
    border: 2px solid rgba(145, 200, 224, 0.38);
    color: #b4eeff;
    font-size: 0.9rem;
    font-weight: 700;
    line-height: 1;
  }

  .home-right-top3__rank-badge.rank-1 {
    border-color: var(--color-r1);
    color: var(--color-r1);
  }

  .home-right-top3__rank-badge.rank-2 {
    border-color: var(--color-r2);
    color: var(--color-r2);
  }

  .home-right-top3__rank-badge.rank-3 {
    border-color: var(--color-r3);
    color: var(--color-r3);
  }

  .home-right-insight__title {
    font-size: 1.24rem;
    color: var(--color-light);
    font-weight: 700;
    letter-spacing: 0.01em;
  }

  .home-right-insight__meta {
    font-size: 1.02rem;
    color: #a5b4c8;
  }

  .home-right-insight__list {
    display: grid;
    gap: 0.35rem;
  }

  .home-right-insight__item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    font-size: 1.1rem;
    color: #c8d3e2;
    padding: 0.2rem 0;
    border-bottom: 1px dashed rgba(255, 255, 255, 0.08);
    line-height: 1.35;
  }

  .home-right-insight__item--button {
    width: 100%;
    border: 0;
    background: transparent;
    text-align: left;
    cursor: pointer;
  }

  .home-right-insight__item:last-child {
    border-bottom: none;
  }

  .home-right-insight__item--race {
    align-items: flex-start;
  }

  .home-right-insight__item-main {
    display: grid;
    gap: 0.1rem;
    min-width: 0;
  }

  .home-right-insight__item-top {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    line-height: 1.3;
  }

  .home-right-insight__item-sub {
    font-size: 0.96rem;
    color: #8ea0b8;
    line-height: 1.25;
  }

  .home-right-insight__item-value {
    color: #d2dcee;
    font-weight: 600;
    white-space: nowrap;
    padding-top: 0.05rem;
  }

  .home-right-insight__comment-preview {
    margin-top: 0.08rem;
    font-size: 0.92rem;
    color: #9ab0cf;
    line-height: 1.25;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 17rem;
  }

  .home-right-insight__item--ellipsis {
    color: #9fb0c8;
    font-style: italic;
  }

  .home-right-insight__item--ellipsis-btn {
    width: 100%;
    border: 0;
    background: transparent;
    text-align: left;
    cursor: pointer;
  }

  .home-right-insight__extra[hidden] {
    display: none !important;
  }

  .home-right-insight__change-inline {
    margin-left: 0.28rem;
    font-size: 0.92rem;
    color: #91a4c2;
    line-height: 1.2;
    max-width: 15rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .home-right-insight__item strong {
    color: var(--color-main);
    font-weight: 700;
  }

  .home-right-insight__item--news {
    align-items: flex-start;
    flex-direction: column;
    gap: 0.15rem;
  }

  .home-right-insight__news-meta {
    font-size: 0.96rem;
    color: #8ea0b8;
  }

  .home-right-insight__empty {
    font-size: 1.05rem;
    color: var(--color-gray);
    padding: 0.2rem 0;
  }

  html[data-theme="light"] .home-right-insight {
    border-color: #b6c6d9;
    background: rgba(240, 246, 252, 0.92);
  }

  html[data-theme="light"] .home-right-top3 {
    border: 1px solid #b6c6d9;
    background: rgba(240, 246, 252, 0.92);
    box-shadow: none;
  }

  html[data-theme="light"] .home-right-top3__title {
    color: #173a59;
  }

  html[data-theme="light"] .home-right-top3__meta {
    color: #5f7590;
  }

  html[data-theme="light"] .home-right-top3__city {
    border: none;
    background: rgba(255, 255, 255, 0.78);
    box-shadow: inset 0 0 0 1px rgba(132, 154, 182, 0.14);
  }

  html[data-theme="light"] .home-right-top3__city-name {
    color: #0f729f;
  }

  html[data-theme="light"] .home-right-top3__row {
    color: #274360;
  }

  html[data-theme="light"] .home-right-top3__label {
    color: #65809d;
  }

  html[data-theme="light"] .home-right-top3__value {
    color: #1f3a56;
  }

  html[data-theme="light"] .home-right-top3__pill {
    border: none;
    background: rgba(228, 239, 251, 0.9);
    color: #1f3d5a;
  }

  html[data-theme="light"] .home-right-top3__pill-rank {
    background: rgba(145, 210, 237, 0.22);
    border-color: rgba(103, 160, 191, 0.45);
    color: #136f9b;
  }

  html[data-theme="light"] .home-right-top3__pill-rank.rank-1,
  html[data-theme="light"] .home-right-top3__pill-rank.rank-2,
  html[data-theme="light"] .home-right-top3__pill-rank.rank-3 {
    background: transparent;
  }

  html[data-theme="light"] .home-right-top3__pill-name {
    color: #0f729f;
  }

  html[data-theme="light"] .home-right-top3__pill-detail {
    color: #476280;
  }

  html[data-theme="light"] .home-right-top3__table-wrap {
    border-color: rgba(132, 154, 182, 0.32);
    background: rgba(255, 255, 255, 0.78);
  }

  html[data-theme="light"] .home-right-top3__city-panel {
    background: rgba(255, 255, 255, 0.78);
    box-shadow: inset 0 0 0 1px rgba(132, 154, 182, 0.14);
  }

  html[data-theme="light"] .home-right-top3__city-title {
    color: #0f729f;
  }

  html[data-theme="light"] .home-right-top3__table th {
    color: #627994;
    background: rgba(236, 244, 252, 0.72);
  }

  html[data-theme="light"] .home-right-top3__table th,
  html[data-theme="light"] .home-right-top3__table td {
    border-bottom-color: rgba(132, 154, 182, 0.22);
  }

  html[data-theme="light"] .home-right-top3__table-group {
    color: #6d86a1;
  }

  html[data-theme="light"] .home-right-top3__table-name {
    color: #264561;
  }

  html[data-theme="light"] .home-right-top3__table-top3 {
    color: #52708c;
  }

  @media (max-width: 768px) {
    .home-right-top3__city-panels {
      grid-template-columns: 1fr;
    }

    .home-right-top3__city-list {
      grid-template-columns: 1fr;
    }

    .home-right-top3__pill {
      font-size: 0.92rem;
      padding: 0.1rem 0.38rem;
      gap: 0.2rem;
    }

    .home-right-top3__pill-rank {
      min-width: 1.48rem;
      height: 1.48rem;
      font-size: 0.94rem;
    }
  }

  html[data-theme="light"] .home-right-top3__empty {
    color: #6a809a;
  }

  html[data-theme="light"] .home-right-insight__title {
    color: #1a3653;
  }

  html[data-theme="light"] .home-right-insight__meta {
    color: #5a6f88;
  }

  html[data-theme="light"] .home-right-insight__item {
    color: #39506c;
    border-bottom-color: rgba(77, 103, 132, 0.22);
  }

  html[data-theme="light"] .home-right-insight__item strong {
    color: #0b77a8;
  }

  html[data-theme="light"] .home-right-insight__item-sub {
    color: #67809c;
  }

  html[data-theme="light"] .home-right-insight__item-value {
    color: #284a69;
  }

  html[data-theme="light"] .home-right-insight__comment-preview {
    color: #6a83a1;
  }

  html[data-theme="light"] .home-right-insight__item--ellipsis {
    color: #6b829d;
  }

  html[data-theme="light"] .home-right-insight__change-inline {
    color: #6f88a4;
  }

  html[data-theme="light"] .home-right-insight__news-meta {
    color: #7187a0;
  }

  html[data-theme="light"] .home-right-insight__empty {
    color: #6a809a;
  }

  html[data-theme="light"] .home-right-insight {
    background: #f8fbff;
    border-color: #c2cfdd;
    box-shadow: 0 5px 14px rgba(53, 78, 106, 0.08);
  }

  html[data-theme="light"] .home-right-insight__title {
    color: #173a59;
    font-size: 1.2rem;
  }

  html[data-theme="light"] .home-right-insight__meta {
    color: #5d748f;
  }

  html[data-theme="light"] .home-right-insight__item {
    color: #223f5a;
    border-bottom-color: rgba(120, 145, 170, 0.24);
    font-size: 1.08rem;
  }

  html[data-theme="light"] .home-right-insight__item strong {
    color: #0f729f;
  }
</style>


<div>
  <section class="home-right-insights">
    <article class="home-right-insight">
      <div class="home-right-insight__head">
        <div class="home-right-insight__title">Ï∂úÎ∞ú ÏûÑÎ∞ï ÏïåÎ¶º</div>
        <div class="home-right-insight__meta">T-30/T-10 Ï≤¥ÌÅ¨</div>
      </div>
      <div class="home-right-insight__list">
        {% for r in right_imminent_races|slice:":5" %}
        <a class="home-right-insight__item"
           href="{% url 'race_prediction' r.rcity r.rdate r.rno 0 'awardee' %}"
           onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
          <span><strong>{{ r.rcity }} {{ r.rno }}R</strong> ¬∑ {{ r.rtime }}</span>
          <span>T-{{ r.minutes_left }}Î∂Ñ</span>
        </a>
        {% empty %}
        <div class="home-right-insight__empty">ÏûÑÎ∞ï Í≤ΩÏ£º Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
        {% endfor %}
      </div>
    </article>

    <article class="home-right-insight">
      <div class="home-right-insight__head">
        <div class="home-right-insight__title">Í¥ÄÏã¨ÎèÑ Í∏âÏ¶ù</div>
        <div class="home-right-insight__meta">ÏµúÍ∑º30Î∂Ñ - ÏßÅÏ†Ñ30Î∂Ñ</div>
      </div>
      <div class="home-right-insight__list">
        {% for r in right_hot_races|slice:":3" %}
        <button type="button"
           class="home-right-insight__item home-right-insight__item--race home-right-insight__item--button js-race-comment-open"
           data-rcity="{{ r.rcity }}"
           data-rdate="{{ r.rdate }}"
           data-rday="{{ r.rday }}"
           data-rno="{{ r.rno }}"
           aria-label="Í¥ÄÏã¨ÎèÑ Í∏âÏ¶ù ÎåìÍ∏Ä Î≥¥Í∏∞">
          <span class="home-right-insight__item-main">
            <span class="home-right-insight__item-top">
              <strong>{{ r.rcity }} {{ r.rno }}R</strong> ¬∑ {{ r.rtime }}
              {% if r.recent_comments %}
              <span class="home-right-insight__comment-preview">üí¨ {{ r.recent_comments|join:" / " }}{% if r.recent_comments_more > 0 %} / ...{% endif %}</span>
              {% endif %}
            </span>
            <span class="home-right-insight__item-sub">{{ r.rdate|slice:"0:4" }}.{{ r.rdate|slice:"4:6" }}.{{ r.rdate|slice:"6:8" }} ({{ r.rday }})</span>
          </span>
          <span class="home-right-insight__item-value">‚ñ≤ {{ r.growth }} (ÏµúÍ∑º {{ r.recent_count }})</span>
        </button>
        {% empty %}
        <div class="home-right-insight__empty">ÎåìÍ∏Ä ÏßëÍ≥Ñ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
        {% endfor %}
      </div>
    </article>

    <article class="home-right-insight">
      <div class="home-right-insight__head">
        <div class="home-right-insight__title">Ï∂úÏ†ÑÌëú Î≥ÄÍ≤ΩÎÇ¥Ïó≠</div>
        <div class="home-right-insight__meta">ÏµúÍ∑º Î≥ÄÍ≤Ω Í±¥Ïàò</div>
      </div>
      <div class="home-right-insight__list">
        {% for r in right_volatile_races|slice:":3" %}
        <a class="home-right-insight__item home-right-insight__item--race"
           href="{% url 'race_prediction' r.rcity r.rdate r.rno 0 'awardee' %}"
           onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
          <span class="home-right-insight__item-main">
            <span class="home-right-insight__item-top">
              <strong>{{ r.rcity }} {{ r.rno }}R</strong> ¬∑ {{ r.rtime }}
              {% if r.change_details %}
              <span class="home-right-insight__change-inline">
                {% for detail in r.change_details %}
                  {{ detail }}{% if not forloop.last %} / {% endif %}
                {% endfor %}
                {% if r.change_detail_more > 0 %} / ...{% endif %}
              </span>
              {% endif %}
            </span>
            <span class="home-right-insight__item-sub">{{ r.rdate|slice:"0:4" }}.{{ r.rdate|slice:"4:6" }}.{{ r.rdate|slice:"6:8" }} ({{ r.rday }})</span>
          </span>
          <span class="home-right-insight__item-value">{{ r.change_count }}Í±¥</span>
        </a>
        {% empty %}
        <div class="home-right-insight__empty">Î≥ÄÍ≤Ω ÎÇ¥Ïó≠Ïù¥ ÏóÜÏäµÎãàÎã§.</div>
        {% endfor %}
        {% if right_volatile_races|length > 3 %}
        <button type="button"
                class="home-right-insight__item home-right-insight__item--ellipsis home-right-insight__item--ellipsis-btn js-volatile-expand"
                aria-expanded="false">
          <span class="home-right-insight__item-main">
            <span class="home-right-insight__item-top js-volatile-expand-label">...</span>
          </span>
          <span class="home-right-insight__item-value">Ïô∏ {{ right_volatile_races|length|sub:3 }}Í≤ΩÏ£º</span>
        </button>
        <div id="home-right-volatile-extra" class="home-right-insight__extra" hidden>
          {% for r in right_volatile_races|slice:"3:" %}
          <a class="home-right-insight__item home-right-insight__item--race"
             href="{% url 'race_prediction' r.rcity r.rdate r.rno 0 'awardee' %}"
             onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
            <span class="home-right-insight__item-main">
              <span class="home-right-insight__item-top">
                <strong>{{ r.rcity }} {{ r.rno }}R</strong> ¬∑ {{ r.rtime }}
                {% if r.change_details %}
                <span class="home-right-insight__change-inline">
                  {% for detail in r.change_details %}
                    {{ detail }}{% if not forloop.last %} / {% endif %}
                  {% endfor %}
                  {% if r.change_detail_more > 0 %} / ...{% endif %}
                </span>
                {% endif %}
              </span>
              <span class="home-right-insight__item-sub">{{ r.rdate|slice:"0:4" }}.{{ r.rdate|slice:"4:6" }}.{{ r.rdate|slice:"6:8" }} ({{ r.rday }})</span>
            </span>
            <span class="home-right-insight__item-value">{{ r.change_count }}Í±¥</span>
          </a>
          {% endfor %}
        </div>
        {% endif %}
      </div>
    </article>

  </section>

  <section class="home-right-top3">
    <div class="home-right-top3__head">
      <div class="home-right-top3__title">ÏÑ±Ï†Å Top 3</div>
      <div class="home-right-top3__meta">Íµ¨Î∂Ñ ¬∑ Ïù¥Î¶Ñ ¬∑ 3ÏúÑÎÇ¥</div>
    </div>
    {% if right_city_top3 %}
    <div class="home-right-top3__city-panels">
      {% for c in right_city_top3 %}
      <article class="home-right-top3__city-panel">
        <div class="home-right-top3__city-title">{{ c.rcity }}</div>
        <div class="home-right-top3__table-wrap">
          <table class="home-right-top3__table">
            <thead>
              <tr>
                <th>Íµ¨Î∂Ñ</th>
                <th>Ïù¥Î¶Ñ</th>
                <th style="text-align:right;">3ÏúÑÎÇ¥</th>
              </tr>
            </thead>
            <tbody>
              {% for x in c.jockeys %}
              <tr>
                {% if forloop.first %}
                <td class="home-right-top3__table-group" rowspan="{{ c.jockeys|length }}">Í∏∞Ïàò</td>
                {% endif %}
                <td class="home-right-top3__table-name tooltip" data-tip="Í∏∞Ïàò {{ x.name }} ¬∑ 1ÏúÑ {{ x.wins }}Ìöå ¬∑ ÌèâÍ∑†ÏàúÏúÑ {{ x.avg_rank|floatformat:1 }}">{{ x.name }}</td>
                <td class="home-right-top3__table-top3">{{ x.top3 }}/{{ x.entries }}</td>
              </tr>
              {% endfor %}
              {% for x in c.trainers %}
              <tr>
                {% if forloop.first %}
                <td class="home-right-top3__table-group" rowspan="{{ c.trainers|length }}">ÎßàÎ∞©</td>
                {% endif %}
                <td class="home-right-top3__table-name tooltip" data-tip="ÎßàÎ∞© {{ x.name }} ¬∑ 1ÏúÑ {{ x.wins }}Ìöå ¬∑ ÌèâÍ∑†ÏàúÏúÑ {{ x.avg_rank|floatformat:1 }}">{{ x.name }}</td>
                <td class="home-right-top3__table-top3">{{ x.top3 }}/{{ x.entries }}</td>
              </tr>
              {% endfor %}
              {% for x in c.gates %}
              <tr>
                {% if forloop.first %}
                <td class="home-right-top3__table-group" rowspan="{{ c.gates|length }}">ÎßàÎ≤à</td>
                {% endif %}
                <td class="home-right-top3__table-name tooltip" data-tip="ÎßàÎ≤à {{ x.name }}Î≤à ¬∑ 1ÏúÑ {{ x.wins }}Ìöå ¬∑ ÌèâÍ∑†ÏàúÏúÑ {{ x.avg_rank|floatformat:1 }}">{{ x.name }}Î≤à</td>
                <td class="home-right-top3__table-top3">{{ x.top3 }}/{{ x.entries }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </article>
      {% endfor %}
    </div>
    {% else %}
    <div class="home-right-top3__empty">ÏßëÍ≥Ñ Í∞ÄÎä•Ìïú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</div>
    {% endif %}
  </section>

  <article class="home-right-insight">
    <div class="home-right-insight__head">
      <div class="home-right-insight__title">Í≤ΩÎßà Îâ¥Ïä§</div>
      <div class="home-right-insight__meta">ÏµúÍ∑º Í∏∞ÏÇ¨</div>
    </div>
    <div class="home-right-insight__list">
      {% for item in right_racing_news|slice:":3" %}
      <a class="home-right-insight__item home-right-insight__item--news" href="{{ item.link }}" target="_blank" rel="noopener noreferrer">
        <strong>{{ item.title }}</strong>
        <span class="home-right-insight__news-meta">{{ item.source }}{% if item.pub_date %} ¬∑ {{ item.pub_date|slice:":16" }}{% endif %}</span>
      </a>
      {% empty %}
      <div class="home-right-insight__empty">Îâ¥Ïä§Î•º Î∂àÎü¨Ïò§ÏßÄ Î™ªÌñàÏäµÎãàÎã§.</div>
      {% endfor %}
    </div>
  </article>
</div>

<script>
  document.addEventListener("click", function (e) {
    var btn = e.target.closest(".js-volatile-expand");
    if (!btn) return;
    var extra = document.getElementById("home-right-volatile-extra");
    if (!extra) return;
    var isOpen = !extra.hidden;
    extra.hidden = isOpen;
    btn.setAttribute("aria-expanded", isOpen ? "false" : "true");
    var label = btn.querySelector(".js-volatile-expand-label");
    if (label) label.textContent = isOpen ? "..." : "Ï†ëÍ∏∞";
  });
</script>
