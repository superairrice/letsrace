{# thethe9 home í™”ë©´ ì¢Œì¸¡ë©”ë‰´ì˜ tabë³„ ë¦¬ìŠ¤íŠ¸ ì •ë³´ #}

{% load static %}
{% load mathfilters %}
{% load humanize %}

<style>
  /* ì›ë˜ ë‚´ì¥ëœ tooltip í…ìŠ¤íŠ¸ëŠ” ìˆ¨ê¸°ê³ , í¬íƒˆë¡œë§Œ í‘œì‹œ */
  .tooltip .tooltip-text { display: none !important; }
  /* í¬íƒˆ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (JSì—ì„œ positionê³¼ ì¢Œí‘œë§Œ ì œì–´) */
  .tooltip-portal {
    position: fixed;
    z-index: 99999;
    max-width: 40rem;
    background: rgba(18, 18, 18, 0.96);
    color: var(--color-light-gray);
    padding: 8px 10px;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    pointer-events: none;
    font-size: 1.1rem;
    line-height: 1.35;
    font-family: Arial, Helvetica, sans-serif;
  }
</style>

<tr>
  
  {# ê²½ì£¼ë²ˆí˜¸ / ê²½ì£¼ì¡°ê±´ #}
  <td style="vertical-align: middle; background-color: var(--color-dark-mid);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      
      <div class="tooltip" style="font-size: 1.7rem; background-color: var(--color-bg); padding: 8px 10px; border-radius: 10px;">
        {% if r_rcity == 'ì„œìš¸' %}
        <div style="font-size: 1.0rem; font-weight: 350; color:var(--color-main); padding-top: 5px;">{{r_rcity}}</div>
        {% else %}
        <div style="font-size: 1.0rem; font-weight: 350; color:var(--color-r3); padding-top: 5px;">{{r_rcity}}</div>
        {% endif %}
        <span style="text-align: right; font-weight: 350; font-size: 1.7rem; border-bottom:1px solid orange; border-radius: 5px;">

          {% if r_rno|mul:1 >= 10 %}{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% else %}&nbsp;{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% endif %}
          
        </span>
        <div class="tooltip-text" style="font-size: 1.1rem; text-align: left; color:var(--color-light-gray); width: 20rem; z-index:999;">
          {% if request.user.username == 'admin' %}
          <span style="font-size: 1.1rem; color:var(--color-light-gray);">{{r_overview|linebreaksbr}}</span>
          <br>
          <span class="r-guide"
                style="font-size:1.1rem; color:var(--color-light-gray);"
                data-guide="{{ r_guide|escape }}">
          </span>

          <script>
            (function () {
              document.querySelectorAll('.r-guide').forEach(el => {
                el.innerHTML = el.dataset.guide.replace(/\|/g, '<br>');
              });
            })();
          </script>

          {% else %}
          <span style="font-size: 1.1rem; color:var(--color-light-gray);">ê²½ì£¼ë°˜í˜¸</span>
          {% endif %}
      </div>
    </a>
    
  </td>

  <td align="right" style="border-right: 1px solid var(--color-bg); background-color: var(--color-dark-mid);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      <span>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-main);">{{rtime}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light);">{{distance}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{grade|slice:"0:2"}}</div>
        
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{dividing|slice:"0:2"}}</div>
      </span>
    </a>
  </td>

  {# ì „ì—­ íˆ´íŒ í¬íƒˆ ìŠ¤í¬ë¦½íŠ¸: ì—¬ëŸ¬ ë²ˆ include ë˜ì–´ë„ 1íšŒë§Œ ì´ˆê¸°í™” #}
  <script>
    (function () {
      if (window.__tooltipPortalInit) return; // ì¤‘ë³µ ì´ˆê¸°í™” ë°©ì§€
      window.__tooltipPortalInit = true;

      var portal = null;
      var GAP = 12;

      function ensurePortal() {
        if (!portal) {
          portal = document.createElement('div');
          portal.className = 'tooltip-portal';
          document.body.appendChild(portal);
        }
        return portal;
      }

      function place(x, y) {
        var vw = window.innerWidth, vh = window.innerHeight;
        portal.style.left = Math.max(8, Math.min(x, vw - portal.offsetWidth - 8)) + 'px';
        portal.style.top  = Math.max(8, Math.min(y, vh - portal.offsetHeight - 8)) + 'px';
      }

      function onEnter(e) {
        var host = e.target.closest('.tooltip');
        if (!host) return;
        var txt = host.querySelector('.tooltip-text');
        if (!txt) return;
        ensurePortal();
        portal.innerHTML = txt.innerHTML; // ê¸°ì¡´ í…ìŠ¤íŠ¸/HTML ìœ ì§€

        var r = host.getBoundingClientRect();
        place(r.right + GAP, r.top + GAP);

        // ë§ˆìš°ìŠ¤ ì´ë™ì— ë”°ë¼ ì‚´ì§ ë”°ë¼ì˜¤ë„ë¡
        document.addEventListener('mousemove', onMove, true);
      }

      function onMove(e) {
        if (!portal) return;
        place(e.clientX + GAP, e.clientY + GAP);
      }

      function onLeave(e) {
        var host = e.target.closest('.tooltip');
        if (!host) return;
        if (portal && portal.parentNode) {
          portal.parentNode.removeChild(portal);
        }
        portal = null;
        document.removeEventListener('mousemove', onMove, true);
      }

      // ìº¡ì²˜ ë‹¨ê³„ì—ì„œ ì „ì—­ ë“±ë¡: í¬í•¨ ì¤‘ë³µì—ë„ 1íšŒë§Œ ë™ì‘
      document.addEventListener('mouseenter', onEnter, true);
      document.addEventListener('mouseleave', onLeave, true);
    })();
  </script>

  
  <td colspan="1" style="border-right: 1px solid gray; width:5.0%">

    <div style="text-align:center;">

      <a href="https://kraplayer.starplayer.net/kra/vod/starplayer.php?meet={% if r_rcity == 'ì„œìš¸' %}1{%else%}3{%endif%}&rcdate={{r_rdate}}&rcno={{r_rno}}&vod_type=r"
        onclick="window.open(this.href, 'w_broadcast', 'width=1400, height=700, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.2rem;">ğŸ–¥ï¸
          <span class="tooltip-text">ğŸ–¥ï¸&nbsp;&nbsp;Relay Broadcast</span>
        </span>
      </a>
    </div>

    {% if r2alloc %}
    
    <div align="right" style="padding-top: 4px;">
      <a href="{% url 'race_result' r_rcity r_rdate r_rno 0 0 0 0 %}"
        onclick="window.open(this.href, 'w_result', 'width=900, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
        <div class="tooltip" style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">
          {% with r2alloc|slice:"2:"|mul:1 as r2 %}
              {% if r2 < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r2alloc|slice:"2:"}}</span>
              {% elif r2 <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r2alloc|slice:"2:"}}</span>
              {% elif r2 <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r2alloc|slice:"2:"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r1); font-weight: normal;">{{r2alloc|slice:"2:"}}</span>
              {% endif %}
            {% endwith %}
          <div align="right" style="line-height: 110%;">
            {% with r333alloc|slice:"3:"|mul:1 as r333_val %}
              {% if r333_val < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r333alloc|slice:"3:"}}</span>
              {% elif r333_val <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r333alloc|slice:"3:"}}</span>
              {% elif r333_val <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r333alloc|slice:"3:"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r1); font-weight: normal;">{{r333alloc|slice:"3:"}}</span>
              {% endif %}
            {% endwith %}
          </div>
          <div align="right" style="line-height: 150%;">
            {% with r123alloc|slice:"3:"|mul:1 as r123_val %}
              {% if r123_val < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r123alloc|slice:"3:"}}</span>
              {% elif r123_val <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r123alloc|slice:"3:"}}</span>
              {% elif r123_val <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r123alloc|slice:"3:"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-main); font-weight: normal;">{{r123alloc|slice:"3:"}}</span>
              {% endif %}
            {% endwith %}
          </div>

          <span class="tooltip-text" style="font-family: Arial; font-size: 1.1rem; text-align: left; width: 130px; z-index: 9;">
            
            <table style="z-index: 9;">
              <tr>
                <th style="font-size: 1.1rem;">ìŠ¹ì‹</th>
                <th style="font-size: 1.1rem;">ë°°ë‹¹ìœ¨</th>
              </tr>
              <tr>
                <td style="text-align: center; font-size: 1.1rem;">ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r2alloc|slice:"2:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r333alloc|slice:"3:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ìŒìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r123alloc|slice:"3:"}}</td>
              </tr>
      
            </table>
          </span>

          
        </div>
        

      </a>
    </div>
    
    
    {%else%}
    
    <div align="center" style="font-size: 1.1rem;">
      {% if request.user.username == 'admin' %}
      <a href="{% url 'update_changed_race' r_rcity r_rdate r_rno %}" onclick="window.open(this.href, 'w_update_changed_race', 'width=900, height=800, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.0rem; padding-top: 0.7rem;">ğŸ”
          <span class="tooltip-text" style="font-size: 1.1rem; text-align: center; z-index: 1;">ğŸ”&nbsp;ì¸ê¸°ë„ & ê²½ì£¼ê²°ê³¼(ìˆœìœ„) ì…ë ¥</span>
        </span>
      </a>
      {% endif %}
    </div>
    {%endif%}

  </td>

  {% for rcity, rdate, rday, rno, gate, rank, r_rank, horse, remark, jockey, trainer, host, r_pop, distance, handycap, i_prehandy, complex, complex5, i_complex, jt_per, jt_cnt, jt_3rd, s1f_rank, i_cycle, rcount, recent3, recent5, convert_r, jockey_old, reason, alloc3r, m_rank, tot_score,  s1f_per, g3f_per, g1f_per, start_score, comment_one, g2f_rank, rec_per, rec8_trend, h_weight in expects %}  
  {% if r_rcity == rcity and r_rdate == rdate and r_rno == rno %}
  
  <td align="center" {% if rank < 90 %} style="color: var(--color-main);" {% else %} style="color: var(--color-main); background-color: var(--color-dark-light);" {% endif %}>

    {# ë§ˆë²ˆ #}
    {% if r_rank > 90 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:brown; border-radius: 10px;">
    {% elif r_rank == 0 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark); border-radius: 15px; border: 0.5px solid var(--color-bg);">
    {% elif r_rank == 1 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r1);">
    {% elif r_rank == 2 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r2);">
    {% elif r_rank == 3 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r3);">
    {% elif r_rank == 4 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg);">
    {% elif r_rank == 5 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg);">
    {% elif r_rank == 6 %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg);">
    {% else %}
    <div align="center" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark); border-radius: 10px;">
    {% endif %}
    
      <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if r_rank %}
        {% if r_rank == 1 %}
        <span class="tooltip" style=" color:var(--color-r1); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank == 2 %}
        <span class="tooltip" style=" color:var(--color-r2); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank == 3 %}
        <span class="tooltip" style=" color:var(--color-r3); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank == 4 %}
        <span class="tooltip" style=" color:var(--color-r4); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank == 5 %}
        <span class="tooltip" style=" color:var(--color-r5); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank == 6 %}
        <span class="tooltip" style=" color:var(--color-r6); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif r_rank > 90 %}
        <span class="tooltip" style=" color:var(--color-gray); font-size: 1.5rem; font-weight: normal; text-decoration:line-through white;">
          {{gate}}
          <span class="tooltip-text" style="font-size: 1.2rem; text-align: left;">
            <span style="font-style:normal;">ğŸ´&nbsp;&nbsp;{{horse}}</span>
            <br>
            <span style="font-style:normal;">ğŸš«&nbsp;&nbsp;ì·¨ì†Œ : {{reason}}</span>
        </span>
        </span>
        {% else %}
        <span class="tooltip" style=" color:var(--color-gray); font-size: 1.5rem;  font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% endif %}
      {% else %}
        {% if rank == 1 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif rank == 2 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif rank == 3 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif rank == 4 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% elif rank == 5 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
        {% else %}
          {% if complex == complex5 %}
          <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
            {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
          {% else %}
          <span class="tooltip" style=" color:var(--color-light); font-weight: normal; font-size:1.6rem;">
            {{gate}}<span class="tooltip-text" style="font-size: 1.1rem; font-style: normal; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                    ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{gate}}ë²ˆ {{horse}}]<br>{{comment_one}}<br>{{g2f_rank|linebreaksbr}}</span></span>
          {% endif %}
        {% endif %}
      {% endif %}
      </a>
    </div>
    
    <div>
    {# ê¸°ìˆ˜ #}
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if jockey_old %}
      <span style="font-size: 0.83rem; color:var(--color-light); background-color: var(--color-r1); border-radius: 50%; padding:2px 2px; margin: 0px;">
        <span class="tooltip" style="color:var(--color-light); font-weight: normal;">
          {{jockey|slice:"-2:"}}
          <span class="tooltip-text" style="text-align: left; font-size: 1.0rem;">
            ğŸ‡&nbsp;ê¸°ìˆ˜ ë³€ê²½<br>
            ë³€ê²½ì „ : {{jockey_old}}<br>
            ì‚¬ìœ  : {{reason}}

          </span>
        </span>
      </span>
      {% else %}
        <span style="font-size: 0.83rem; color:var(--color-main-light); background-color:var(--color-dark); border-radius: 50%; padding:2px 2px; margin: 0px;">{{jockey|slice:"-2:"}}</span>
      {% endif %}
    </a>
    </div>

    <div style="text-align:center; font-size:0.95rem;">
      <span class="tooltip" style="font-weight: normal;">
      {% if tot_score == 100 %}
      <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{tot_score|floatformat:0}}</span>
      {% elif tot_score >= 90.0 and tot_score < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 80.0 and tot_score < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 70 and tot_score < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 60 and tot_score < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 50 and tot_score < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); ">{{tot_score|floatformat:1}}</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{tot_score|floatformat:1}}</span>
      {% endif %}
      <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
          â†ªï¸&nbsp;&nbsp;ver2 score: {{tot_score|floatformat:1}}</span></span>
    </div>

    
  </td>
  
  <td align="center" {% if rank < 90 %} style="font-family: Arial; color: var(--color-main); border-right: 1px solid gray;" {% else %} style="font-family: Arial; color: var(--color-main); background-color: var(--color-dark-light); border-right: 1px solid gray;" {% endif %}>
    
    
    
    <div style="text-align:right; font-size:0.9rem;">
      <span class="tooltip" style="font-weight: normal;">
      {% if s1f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif s1f_per >= 90.0 and s1f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px; ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 80.0 and s1f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 70 and s1f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 60 and s1f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 50 and s1f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{s1f_per|floatformat:1}}</span>
      {% endif %}
      <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
          â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â†ªï¸&nbsp;&nbsp;ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}</span></span>
    </div>

    <div style="text-align:right; font-size:0.9rem;">
      <span class="tooltip" style="font-weight: normal;">
      {% if g3f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif g3f_per >= 90.0 and g3f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 80.0 and g3f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 70 and g3f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 60 and g3f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 50 and g3f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{g3f_per|floatformat:1}}</span>
      {% endif %}
      <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
          â†ªï¸&nbsp;&nbsp;ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}</span></span>
    </div>

    <div style="text-align:right; font-size:0.9rem;">
      <span class="tooltip" style="font-weight: normal;">
      {% if g1f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif g1f_per >= 90.0 and g1f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 80.0 and g1f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 70 and g1f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 60 and g1f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 50 and g1f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{g1f_per|floatformat:1}}</span>
      {% endif %}
      <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
          â†ªï¸&nbsp;&nbsp;ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}</span></span>
    </div>

    {# ë¶€ë‹´ì¤‘ëŸ‰ #}
    <div style="text-align:right; font-size:0.9rem;">
      <span class="tooltip" style="font-weight: normal;">
      {% if i_prehandy %}
        {% with handy_diff=handycap|sub:i_prehandy %}
          {% if handy_diff >= 2 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">+{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff >= 0.5 and handy_diff < 2 %}
          <span style="font-family: Arial; color: var(--color-r2); ">+{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff == 0 %}
          <span style="font-family: Arial; color: var(--color-gray); ">{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff >= -1.5 and handy_diff <= -0.5 %}
          <span style="font-family: Arial; color: var(--color-r4); ">{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff < -1.5 %}
          <span style="font-family: Arial; color: var(--color-r5); ">{{handy_diff|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{handy_diff|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}</span></span>
        {% endwith %}
      {% else %}
        {% with handy_diff=0 %}
          <span style="font-family: Arial; color: var(--color-gray); ">{{handy_diff|floatformat:1}}</span>
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}</span></span>
        {% endwith %}
      {% endif %}
    </div>
    
    {% if alloc3r %}
      <div style="font-size: 0.9rem; font-family: Arial; text-align: right;">
        
        {% if r_rank == 1 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r1); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% elif r_rank == 2 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r2); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% elif r_rank == 3 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r3); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% else %}
          {% if alloc3r >= 1.0 and alloc3r < 2.0 %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r1); border-radius:4px; border-bottom: 1px solid var(--color-r1);">{{alloc3r}}</span>
          {% elif alloc3r >= 2.0 and alloc3r < 3.0 %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-light); border-radius:4px; border-bottom: 1px solid var(--color-gray);">{{alloc3r}}</span>
          {% else %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-gray); border-radius:4px; border-bottom: 1px solid var(--color-gray);">{{alloc3r}}</span>
          {% endif %}
        {% endif %}
      </div>

    {% else %}
      <div style="text-align:right; font-size:0.9rem;">
        <span class="tooltip" style="font-weight: normal;">
        {% with h_weight|slice:"0:3"|add:0 as weight_prefix %}
        {% if weight_prefix %}
          {% with handycap|div:weight_prefix|mul:100 as handy_ratio %}
          {% if handy_ratio >= 11.9 %}
          <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px; ">{{handycap}}</span>
          {% elif handy_ratio >= 11 and handy_ratio < 11.9 %}
          <span style="font-family: Arial; color: var(--color-r2); ">{{handycap}}</span>
          {% elif handy_ratio >= 10 and handy_ratio < 11 %}
          <span style="font-family: Arial; color: var(--color-r3); ">{{handycap}}</span>
          {% elif handy_ratio <= 10 %}
          <span style="font-family: Arial; color: var(--color-r4); ">{{handycap}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{handycap}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}</span></span>
          {% endwith %}
        {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">NA</span>
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA</span></span>
        {% endif %}
        {% endwith %}
      </div>

    {% endif %}
    
    
  </td>


  

  {% endif %}
  {% endfor %}



</tr>
