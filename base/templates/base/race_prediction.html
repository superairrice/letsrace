<!DOCTYPE html>
{% load static %}
{% load mathfilters %}
{% load humanize %}

{# load my_custom_tags #}


<html lang="en">

<head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BFZZL101LZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-BFZZL101LZ');
  </script>
  <!-- End Google tag -->

  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="shortcut icon" type="image/x-icon" href="{% static '/images/number-9.png' %}" />
  
  <link rel="stylesheet" href="{% static 'styles/style.css' %}" />
  <link rel="stylesheet" href="{% static 'styles/styles.css' %}" />

  <script src="{% static 'js/script.js' %}"></script>

  <script src="{% static 'js/jquery-3.6.1.js' %}"></script>

  <title>ê²½ì£¼ë¶„ì„ '{{r_condition.rdate|slice:"2:4"}}.{{r_condition.rdate|slice:"4:6"}}.{{r_condition.rdate|slice:"6:8"}}&nbsp;({{r_condition.rday}}) {{r_condition.rcity}}&nbsp;&nbsp;{{r_condition.rno}}ê²½ì£¼</title>

  <style>
    body.race-prediction-page {
      padding: 0.2rem 2rem;
    }
    body.race-prediction-page .container {
      max-width: none;
      width: 100%;
    }
    body.race-prediction-page .roomList {
      width: 100%;
    }

    #race-loader-overlay {
      position: fixed;
      inset: 0;
      z-index: 100000;
      background: rgba(12, 14, 18, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: all;
      opacity: 1;
      transition: opacity 0.25s ease;
    }

    #race-loader-overlay.is-hidden {
      opacity: 0;
    }

    #race-loader-box {
      width: min(460px, 90vw);
      padding: 18px 16px;
      border-radius: 12px;
      background: rgba(0, 0, 0, 0.26);
      border: 1px solid rgba(255, 255, 255, 0.12);
      backdrop-filter: blur(2px);
    }

    #race-loader-label {
      font-size: 1.2rem;
      color: var(--color-light-gray);
      margin-bottom: 10px;
      text-align: center;
    }

    #race-loader-track {
      width: min(420px, 86vw);
      height: 4px;
      background: rgba(255, 255, 255, 0.14);
      overflow: hidden;
      border-radius: 999px;
    }

    #race-loader-bar {
      width: 42%;
      height: 100%;
      background: linear-gradient(90deg, #ff6f3d 0%, #ffd166 100%);
      box-shadow: 0 0 14px rgba(255, 111, 61, 0.55);
      animation: race-loading-bar 1.2s ease-in-out infinite;
    }

    @keyframes race-loading-bar {
      0% {
        transform: translateX(-120%);
      }
      50% {
        transform: translateX(65%);
      }
      100% {
        transform: translateX(220%);
      }
    }

    .popup-mini-footer {
      position: fixed;
      left: 2rem;
      right: 2rem;
      bottom: 0.45rem;
      padding: 0.45rem 0.7rem;
      border: 1px solid rgba(130, 149, 176, 0.28);
      border-radius: 8px;
      background: rgba(12, 18, 30, 0.9);
      color: var(--color-light-gray);
      font-family: Arial, Helvetica, sans-serif;
      font-size: 1.02rem;
      line-height: 1.3;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.8rem;
      z-index: 1200;
    }

    .popup-mini-footer button {
      border: 1px solid rgba(130, 149, 176, 0.5);
      background: rgba(16, 26, 44, 0.95);
      color: var(--color-main);
      font-family: Arial, Helvetica, sans-serif;
      font-size: 0.95rem;
      border-radius: 6px;
      padding: 0.2rem 0.55rem;
      cursor: pointer;
    }

    .popup-mini-footer button:hover {
      border-color: var(--color-main);
    }

    /* race_prediction page-only readability tuning */
    body.race-prediction-page table.fold-table {
      border: 1px solid rgba(130, 149, 176, 0.38);
      border-radius: 10px;
      overflow: hidden;
    }

    body.race-prediction-page table.fold-table > tbody > tr.view {
      font-family: Arial, Helvetica, sans-serif;
    }

    body.race-prediction-page table.fold-table th {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 1.18rem;
      letter-spacing: 0.1px;
    }

    body.race-prediction-page table.fold-table td {
      font-family: Arial, Helvetica, sans-serif;
      font-size: 1.14rem;
      line-height: 1.45;
      padding-top: 0.46rem;
      padding-bottom: 0.46rem;
    }

    body.race-prediction-page .btn.btn--pill {
      border-width: 1px;
      padding: 0.42rem 0.88rem;
      font-family: Arial, Helvetica, sans-serif;
      font-weight: 600;
      letter-spacing: 0.1px;
    }

    body.race-prediction-page #id_description {
      border: 1px solid rgba(130, 149, 176, 0.36);
      border-radius: 8px;
      padding: 0.6rem 0.72rem;
      line-height: 1.55 !important;
      background: color-mix(in srgb, var(--color-dark) 90%, var(--color-bg) 10%);
    }

    html[data-theme="light"] body.race-prediction-page {
      background: #edf2f8;
      color: #15273a;
    }

    html[data-theme="light"] body.race-prediction-page .roomList {
      background: #f5f8fc;
      border: 1px solid #c8d3df;
      border-radius: 12px;
      padding: 0.7rem 0.75rem 1rem;
      box-shadow: 0 6px 20px rgba(56, 80, 108, 0.08);
    }

    html[data-theme="light"] body.race-prediction-page table.fold-table {
      background: #fbfdff;
      border-color: #b8c8d8;
      box-shadow: inset 0 1px 0 #ffffff;
    }

    html[data-theme="light"] body.race-prediction-page table.fold-table th {
      border-bottom-color: #c3d2e2;
      color: #17324d;
      font-weight: 700;
    }

    html[data-theme="light"] body.race-prediction-page table.fold-table > tbody > tr.view td,
    html[data-theme="light"] body.race-prediction-page table.fold-table > tbody > tr.view th {
      border-bottom: 1px solid #ccd9e7;
      color: #18344f;
    }

    html[data-theme="light"] body.race-prediction-page table.fold-table > tbody > tr.view:nth-child(4n-3) {
      background: #f2f7fd;
    }

    html[data-theme="light"] body.race-prediction-page table.fold-table > tbody > tr.view:hover,
    html[data-theme="light"] body.race-prediction-page table.fold-table > tbody > tr.view.open {
      background: #deebf8;
      color: #10273f;
    }

    html[data-theme="light"] body.race-prediction-page .btn.btn--pill {
      background: #f8fbff !important;
      border-color: #b9c7d6 !important;
      color: #17324b !important;
    }

    html[data-theme="light"] body.race-prediction-page .btn.btn--pill:hover {
      background: #eaf2fb !important;
      border-color: #9fb6cf !important;
    }

    html[data-theme="light"] body.race-prediction-page .popup-mini-footer {
      background: rgba(245, 250, 255, 0.94);
      border-color: #b8c7d8;
      color: #243d56;
      box-shadow: 0 4px 14px rgba(58, 83, 109, 0.14);
    }

    html[data-theme="light"] body.race-prediction-page .popup-mini-footer button {
      background: #f0f6ff;
      border-color: #a8bfd8;
      color: #155b84;
    }

    html[data-theme="light"] body.race-prediction-page .popup-mini-footer button:hover {
      background: #dcecff;
      border-color: #86a9ce;
    }

  </style>
</head>

{% block content %}

<body class="create-room layout race-prediction-page" style="padding-bottom: 4.6rem;" >
  <div id="race-loader-overlay" aria-live="polite" aria-label="í˜ì´ì§€ ë¡œë”© ì¤‘">
    <div id="race-loader-box">
      <div id="race-loader-label">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
      <div id="race-loader-track">
        <div id="race-loader-bar"></div>
      </div>
    </div>
  </div>
  
  <div class="container">

    <div class="roomList" style="height: auto;">

      {# Header #}
      {% include 'base/m_header_of_prediction.html' %}

      <hr style="border: solid 1px black;">
      
      <a class="btn btn--main btn--pill" style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-dark-medium);" href="{% url 'race_training' r_condition.rcity r_condition.rdate r_condition.rno %}" onclick="window.open(this.href, 'w_training', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">ì¡°êµí˜„í™©</a>
      <a class="btn btn--main btn--pill" style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-dark-medium);" href="{% url 'race_judged' r_condition.rcity r_condition.rdate r_condition.rno %}" onclick="window.open(this.href, 'w_judged', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">ë§ˆí•„ë³‘ë ¥ & ì¬ê²°</a>
      <a class="btn btn--main btn--pill" style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-dark-medium);" href="{% url 'race_related' r_condition.rcity r_condition.rdate r_condition.rno %}"
        onclick="
                let monitorWidth = 1920; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë„ˆë¹„ (ì˜ˆ: 1920px)
                let monitorHeight = 1080; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë†’ì´ (ì˜ˆ: 1080px)
                let monitorOffset = 1920; // ì²« ë²ˆì§¸ ëª¨ë‹ˆí„° ëì—ì„œ ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„°ê°€ ì‹œì‘í•˜ëŠ” ìœ„ì¹˜
                
                let winWidth = 900; // ìƒˆ ì°½ì˜ ë„ˆë¹„
                let winHeight = 1000; // ìƒˆ ì°½ì˜ ë†’ì´
                
                //let winLeft =  monitorOffset + (monitorWidth - winWidth); // ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„° ìš°ì¸¡ ì •ë ¬
                let winLeft = 666; // ì¢Œì¸¡ ì •ë ¬: ëª¨ë‹ˆí„° ì‹œì‘ ìœ„ì¹˜
                let winTop = 0; // ìƒë‹¨ ê³ ì •
                window.open(
                  this.href,
                  'w_related',
                  `width=${winWidth},height=${winHeight},toolbars=no,scrollbars=yes,left=${winLeft},top=${winTop}`
                );
                return false;">ê¸°ìˆ˜ & ë§ˆë°© & ë§ˆì£¼</a>
      {% if request.user.username == 'admin' %}
      <a class="btn btn--main btn--pill" style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-r5);" href="{% url 'race_related_info' r_condition.rcity r_condition.rdate r_condition.rno %}" 
                onclick="
                monitorWidth = 1920; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë„ˆë¹„ (ì˜ˆ: 1920px)
                monitorHeight = 1080; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë†’ì´ (ì˜ˆ: 1080px)
                monitorOffset = 1920; // ì²« ë²ˆì§¸ ëª¨ë‹ˆí„° ëì—ì„œ ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„°ê°€ ì‹œì‘í•˜ëŠ” ìœ„ì¹˜
              
                winWidth = 900; // ìƒˆ ì°½ì˜ ë„ˆë¹„
                winHeight = 1000; // ìƒˆ ì°½ì˜ ë†’ì´
              
                winLeft =  monitorOffset + (monitorWidth - winWidth); // ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„° ìš°ì¸¡ ì •ë ¬
                //winLeft = 1246; // ì¢Œì¸¡ ì •ë ¬: ëª¨ë‹ˆí„° ì‹œì‘ ìœ„ì¹˜
                winTop = 0; // ìƒë‹¨ ê³ ì •
                window.open(
                  
                  'w_related_info',
                  `width=${winWidth},height=${winHeight},toolbars=no,scrollbars=yes,left=${winLeft},top=${winTop}`
                );
                return false;">Related Info.
      </a>
      {% endif %}
      &nbsp;&nbsp;&nbsp;&nbsp;
      {% if request.user.is_authenticated %}
        <a style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-main);" href="{% url 'mock_audit' r_condition.rcity r_condition.rdate r_condition.rno 0 0 %}" onclick="window.open(this.href, 'w_mock_audit', 'width=900, height=1000, toolbars=no, scrollbars=yes'); return false;">
          <button class="btn btn--link" type="submit" style="font-size: 1.1rem;">âš™ï¸&nbsp;Mock Audit</button>
        </a>
        &nbsp;&nbsp;
        <a href="#" 
          style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-main);" 
          onclick="runMockAccept('{{ r_condition.rcity }}', '{{ r_condition.rdate }}', '{{ r_condition.rno }}'); return false;">
          <button class="btn btn--link" type="submit" style="font-size: 1.1rem;">ğŸ¤”&nbsp;Accept</button>
        </a>

        <script>
        function runMockAccept(rcity, rdate, rno) {
          // âœ… Ajaxë‚˜ fetchë¡œ ì„œë²„ì˜ íŠ¹ì • í•¨ìˆ˜ë§Œ ì‹¤í–‰
          fetch(`/mock_accept/${rcity}/${rdate}/${rno}`, {
            method: "GET",
          })
          .then(res => res.text())
          .then(data => {
            setTimeout(() => location.reload(), 500);
            console.log("Mock audit result:", data);
            // ì´ ë¶€ë¶„ì—ì„œ UI ì—…ë°ì´íŠ¸ ë“± ì¶”ê°€ ì‘ì—… ê°€ëŠ¥
          })
          .catch(err => console.error(err));
        }
        </script>
      {% endif %}

      &nbsp;&nbsp;&nbsp;&nbsp;
      {% if request.user.username == 'admin' %}
      
      <span style="color: var(--color-main); padding-top: 0.6rem;">
        <a href="#" 
          style="font-size: 1.2rem; border-radius: 7px; background-color: var(--color-bg); border-color: var(--color-main);" 
          onclick="runChatGPT('{{ r_condition.rcity }}', '{{ r_condition.rdate }}', '{{ r_condition.rno }}'); return false;">
          <button class="btn btn--link" type="submit" style="font-size: 1.1rem;">ğŸ’¬&nbsp;chatGPT</button>
        </a>

        <script>
        function runChatGPT(rcity, rdate, rno) {
          // âœ… Ajaxë‚˜ fetchë¡œ ì„œë²„ì˜ íŠ¹ì • í•¨ìˆ˜ë§Œ ì‹¤í–‰
          fetch(`/exec_chatGPT/${rcity}/${rdate}/${rno}`, {
            method: "GET",
          })
          .then(res => res.text())
          .then(data => {
            setTimeout(() => location.reload(), 500);
            console.log("Mock audit result:", data);
            // ì´ ë¶€ë¶„ì—ì„œ UI ì—…ë°ì´íŠ¸ ë“± ì¶”ê°€ ì‘ì—… ê°€ëŠ¥
          })
          .catch(err => console.error(err));
        }
        </script>
        &nbsp;&nbsp;&nbsp;&nbsp;
        <span style="color: var(--color-main); padding-top: 0.6rem;">
          <a href="{% url 'race_review' r_condition.rcity r_condition.rdate r_condition.rno %}" 
                    onclick="
                    monitorWidth = 1920; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë„ˆë¹„ (ì˜ˆ: 1920px)
                    monitorHeight = 1080; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë†’ì´ (ì˜ˆ: 1080px)
                    monitorOffset = 1920; // ì²« ë²ˆì§¸ ëª¨ë‹ˆí„° ëì—ì„œ ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„°ê°€ ì‹œì‘í•˜ëŠ” ìœ„ì¹˜
                    
                    winWidth = 900; // ìƒˆ ì°½ì˜ 43.128.149.102ë„ˆë¹„
                    winHeight = 1000; // ìƒˆ ì°½ì˜ ë†’ì´
                    
                    // winLeft =  monitorOffset + (monitorWidth - winWidth); // ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„° ìš°ì¸¡ ì •ë ¬
                    winLeft = 1246; // ì¢Œì¸¡ ì •ë ¬: ëª¨ë‹ˆí„° ì‹œì‘ ìœ„ì¹˜
                    winTop = 0; // ìƒë‹¨ ê³ ì •
                    window.open(
                      this.href,
                      'w_race_review',
                      `width=${winWidth},height=${winHeight},toolbars=no,scrollbars=yes,left=${winLeft},top=${winTop}`
                    );
                    return false;">ğŸ”§
              <span style="font-size: 1.35rem;">
            </span>
          </a>
        </span>
      </span>
      {% endif %}
      &nbsp;&nbsp;&nbsp;&nbsp;
      {% if alloc.r2alloc %} {# ê²½ì£¼ê²°ê³¼ê°€ ì…ë ¥ë˜ì—ˆìœ¼ë©´ #}
      <span style="color: var(--color-main); padding-top: 0.6rem;">
        <a href="{% url 'race_result' r_condition.rcity r_condition.rdate r_condition.rno 0 0 0 0 %}"
          onclick="window.open(this.href, 'w_result', 'width=900, height=1000, toolbars=no, scrollbars=yes'); return false;">
          <span class="tooltip" style="font-size: 1.35rem;">ğŸ“ƒ
            <span class="tooltip-text" style="width:11rem; text-align: center;">ğŸ“ƒ&nbsp;Race Result</span>
          </span>
        </a>
      </span>
      {% endif %}
      <hr style="border: solid 1px black;">

      {% include 'base/m_prediction.html' %}

    </div>
    <!-- Room End -->
  </div>
  <!-- {{r_condition.r_guide}} -->
  {% if request.user.is_authenticated %}

  <span style="color: var(--color-main); padding-top: 20px;">
    <a href="{% url 'race_review' r_condition.rcity r_condition.rdate r_condition.rno %}" 
              onclick="
              monitorWidth = 1920; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë„ˆë¹„ (ì˜ˆ: 1920px)
              monitorHeight = 1080; // íŠ¹ì • ëª¨ë‹ˆí„°ì˜ ë†’ì´ (ì˜ˆ: 1080px)
              monitorOffset = 1920; // ì²« ë²ˆì§¸ ëª¨ë‹ˆí„° ëì—ì„œ ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„°ê°€ ì‹œì‘í•˜ëŠ” ìœ„ì¹˜
              
              winWidth = 900; // ìƒˆ ì°½ì˜ ë„ˆë¹„
              winHeight = 1000; // ìƒˆ ì°½ì˜ ë†’ì´
              
              // winLeft =  monitorOffset + (monitorWidth - winWidth); // ë‘ ë²ˆì§¸ ëª¨ë‹ˆí„° ìš°ì¸¡ ì •ë ¬
              winLeft = 1246; // ì¢Œì¸¡ ì •ë ¬: ëª¨ë‹ˆí„° ì‹œì‘ ìœ„ì¹˜
              winTop = 0; // ìƒë‹¨ ê³ ì •
              window.open(
                this.href,
                'w_race_review',
                `width=${winWidth},height=${winHeight},toolbars=no,scrollbars=yes,left=${winLeft},top=${winTop}`
              );
              return false;">ğŸ˜
        <span style="font-size: 1.35rem;">
      </span>
    </a>
  </span>
  <span style="font-size: 1.3rem; color:var(--color-light-gray); padding-top: 20px;">{{r_condition.r_guide|linebreaksbr}}</span>
  <br>
  <span style="font-size: 1.3rem; color:var(--color-r5);">{{r_condition.r_overview|linebreaksbr}}</span>
  {% endif %}

  {% if judged %}
  <div style="font-size: 0.3rem; padding: 2px 6px;">&nbsp;</div>
  <span style="font-size: 1.3rem; padding: 2px 6px;">âš–ï¸&nbsp;ì‹¬íŒìœ„ì› Report</span>

  {% if r_memo.0.3 %}
  <span style="font-size: 1.3rem; padding: 2px 6px; color:var(--color-r5);">[&nbsp;{{r_memo.0.3}}&nbsp;]</span>
  {% endif %}
  
  <div class="form__group">
    <!-- <label for="room_description">ì‹¬íŒìœ„ì› Report</label> -->
    <textarea name="description" cols="400" rows="100" id="id_description" style="font-family:sans-serif; height: 20rem; font-size: 1.35rem; color:var(--color-light-gray); line-height:20px; font-weight: 350;">{{judged}}</textarea>
  </div>
  {% endif %}


  <script>
    (function () {
      function hideRaceLoader() {
        var overlay = document.getElementById('race-loader-overlay');
        if (!overlay) return;
        overlay.classList.add('is-hidden');
        window.setTimeout(function () {
          if (overlay && overlay.parentNode) {
            overlay.parentNode.removeChild(overlay);
          }
        }, 260);
      }

      if (document.readyState === 'complete') {
        hideRaceLoader();
        return;
      }

      window.addEventListener('load', hideRaceLoader, { once: true });
    })();
  </script>

  <script>
    $(function () {
      $(".fold-table tr.view").on("click", function () {
        if ($(this).hasClass("open")) {
          $(this).removeClass("open").next(".fold").removeClass("open");
        } else {
          $(".fold-table tr.view").removeClass("open").next(".fold").removeClass("open");
          $(this).addClass("open").next(".fold").addClass("open");
        }
      });
    });

  </script>

  <div class="popup-mini-footer">
    <span>Â© {% now "Y" %} thethe9 Â· Race Prediction</span>
    <button type="button" onclick="window.close();">ì°½ ë‹«ê¸°</button>
  </div>

</body>
{% endblock %}

</html>
