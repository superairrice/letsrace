{# thethe9 home í™”ë©´ ì¢Œì¸¡ë©”ë‰´ì˜ tabë³„ ë¦¬ìŠ¤íŠ¸ ì •ë³´ #}

{% load static %}
{% load mathfilters %}
{% load humanize %}

<tr>
  
  {# ê²½ì£¼ë²ˆí˜¸ / ê²½ì£¼ì¡°ê±´ #}
  <td style="vertical-align: middle; background-color: var(--color-dark-medium);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      
      <div class="tooltip" style="font-size: 1.7rem; background-color: var(--color-bg); padding: 10px 12px; border-radius: 10px;">
        {% if r_rcity == 'ì„œìš¸' %}
        <div style="font-size: 1.0rem; font-weight: 350; color:var(--color-main); padding-top: 5px;">{{r_rcity}}</div>
        {% else %}
        <div style="font-size: 1.0rem; font-weight: 350; color:var(--color-r3); padding-top: 5px;">{{r_rcity}}</div>
        {% endif %}
        <span style="text-align: right; font-weight: 350; font-size: 1.7rem; border-bottom:1px solid orange; border-radius: 5px;">

          {% if r_rno|mul:1 >= 10 %}{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% else %}&nbsp;{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% endif %}
          
        </span>
        <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ‡&nbsp;Race ë¶„ì„</span>
      </div>
    </a>
    
  </td>

  <td align="right" style="border-right: 1px solid var(--color-bg); background-color: var(--color-dark-medium);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      <span>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-main);">{{rtime}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light);">{{distance}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{grade|slice:"0:2"}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{dividing|slice:"0:2"}}</div>
      </span>
    </a>
  </td>

  
  <td colspan="1" style="border-right: 1px solid gray; width:5.0%">

    <div style="text-align:center;">

      <a href="https://kraplayer.starplayer.net/kra/vod/starplayer.php?meet={% if r_rcity == 'ì„œìš¸' %}1{%else%}3{%endif%}&rcdate={{r_rdate}}&rcno={{r_rno}}&vod_type=r"
        onclick="window.open(this.href, 'w_broadcast', 'width=1400, height=700, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.2rem;">ğŸ–¥ï¸
          <span class="tooltip-text">ğŸ–¥ï¸&nbsp;&nbsp;Relay Broadcast</span>
        </span>
      </a>
    </div>

    {% if r2alloc %}
    <div style="font-size: 0.7rem; padding-top: 0.9rem; text-align: center;">ğŸ’°</div>
    <div align="right" style="line-height: 120%;">
      <a href="{% url 'race_result' r_rcity r_rdate r_rno 0 0 0 0 %}"
        onclick="window.open(this.href, 'w_result', 'width=1000, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
        <span class="tooltip" style="font-size: 1.0rem; font-family: Arial; color:var(--color-main); font-weight: 400;">{{r2alloc|slice:"2:8"}}
          
          <span class="tooltip-text" style="font-family: Arial; font-size: 1.1rem; text-align: left; width: 130px; z-index: 9;">
            <table style="z-index: 9;">
              <tr>
                <th style="font-size: 1.1rem;">ìŠ¹ì‹</th>
                <th style="font-size: 1.1rem;">ë°°ë‹¹ìœ¨</th>
              </tr>
              <tr>
                <td style="text-align: center; font-size: 1.1rem;">ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r2alloc|slice:"2:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r333alloc|slice:"3:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ìŒìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r123alloc|slice:"3:"}}</td>
              </tr>
      
            </table>
          </span>
          
        </span>
      </a>
    </div>
    
    {%else%}
    
    <div align="center" style="font-size: 1.1rem;">
      {% if request.user.username == 'admin' %}
      <a href="{% url 'update_changed_race' r_rcity r_rdate r_rno %}" onclick="window.open(this.href, 'w_update_changed_race', 'width=900, height=800, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.0rem; padding-top: 0.7rem;">ğŸ”
          <span class="tooltip-text" style="font-size: 1.1rem; text-align: center; z-index: 1;">ğŸ”&nbsp;ì¸ê¸°ë„ & ê²½ì£¼ê²°ê³¼(ìˆœìœ„) ì…ë ¥</span>
        </span>
      </a>
      {% endif %}
    </div>
    {%endif%}

  </td>

  {% for rcity, rdate, rday, rno, gate, rank, r_rank, horse, remark, jockey, trainer, host, r_pop, distance, handycap, i_prehandy, complex, complex5, i_complex, jt_per, jt_cnt, jt_3rd, s1f_rank, i_cycle, rcount, recent3, recent5, convert_r, jockey_old, reason in expects %}  
  {% if r_rcity == rcity and r_rdate == rdate and r_rno == rno %}
  
  <td align="center" {% if rank < 90 %} style="font-family: Arial; color: var(--color-main);" {% else %} style="font-family: Arial; color: var(--color-main); background-color: var(--color-dark-light);" {% endif %}>

    {# ë§ˆë²ˆ #}
    {% if r_rank > 90 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:brown; border-radius: 50%;">
    {% elif r_rank == 1 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-bg); border-radius: 50%;">
    {% elif r_rank == 2 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-bg); border-radius: 50%;">
    {% elif r_rank == 3 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-bg); border-radius: 50%;">
    {% elif r_rank == 4 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-dark-medium); border-radius: 50%;">
    {% elif r_rank == 5 %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-dark-medium); border-radius: 50%;">
    {% else %}
    <div align="center" style="font-style: italic; font-size: 1.7rem; background-color:var(--color-dark); border-radius: 50%;">
    {% endif %}
    
      <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if r_rank %}
        {% if r_rank == 1 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-r1); font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif r_rank == 2 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-r2); font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif r_rank == 3 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-r3); font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif r_rank == 4 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-r4); font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif r_rank == 5 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-r5); font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif r_rank > 90 %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-gray); font-size: 1.5rem; font-weight: 350; text-decoration:line-through white;">
          {{gate}}
          <span class="tooltip-text" style="font-size: 1.2rem; text-align: left;">
            <span style="font-style:normal;">ğŸ´&nbsp;&nbsp;{{horse}}</span>
            <br>
            <span style="font-style:normal;">ğŸš«&nbsp;&nbsp;ì·¨ì†Œ : {{reason}}</span>
        </span>
        </span>
        {% else %}
        <span class="tooltip" style="font-family: Arial; color:var(--color-gray); font-size: 1.5rem;  font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size: 1.2rem; font-weight: 350;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% endif %}
      {% else %}
        {% if rank == 1 %}
        <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif rank == 2 %}
        <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif rank == 3 %}
        <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif rank == 4 %}
        <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% elif rank == 5 %}
        <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
        </span>
        {% else %}
          {% if complex == complex5 %}
          <span class="tooltip" style="font-family: Arial; color:greenyellow; font-weight: 350; font-size:1.7rem;">
            {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
          </span>
          {% else %}
          <span class="tooltip" style="font-family: Arial; color:var(--color-light); font-weight: 350; font-size:1.6rem;">
            {{gate}}<sub style="font-size: 0.9rem;">&nbsp;</sub><span class="tooltip-text" style="font-size: 1.2rem;">ğŸ´&nbsp;&nbsp;<span style="font-style:normal;">{{horse}}</span></span>
          </span>
          {% endif %}
        {% endif %}
      {% endif %}
      </a>
    </div>

    {# ì¶œì£¼ ì£¼ê¸° #}
    <div>
      {% if i_cycle %}
        {% if i_cycle <= 16 %} 
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r2); border-bottom: 1px solid var(--color-r2); padding:2px 4px; border-radius: 7px;">
            {{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.7rem;">w</sup>
          </span>
        {% elif i_cycle >= 68 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r1); border-bottom: 1px solid var(--color-r1); padding:2px 4px; border-radius: 7px;">
            {{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.7rem;">w</sup>
          </span>
        {% else %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r3);">{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.7rem;">w</sup></span>
        {% endif %}
      {% else %}
        <span style="font-size:0.9rem; color:var(--color-light);">ğŸ¥</span>
      {% endif %}
    </div>

    {# ê¸°ìˆ˜ #}
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if jockey_old %}
      <div style="font-size: 0.9rem; color:var(--color-light); background-color: brown; border-radius: 50%; padding:2px 3px; margin: 0px;">
        <span class="tooltip">
          {{jockey|slice:"-2:"}}
          <span class="tooltip-text" style="text-align: left; font-size: 1.0rem;">
            ğŸ‡&nbsp;ê¸°ìˆ˜ ë³€ê²½<br>
            ë³€ê²½ì „ : {{jockey_old}}<br>
            ì‚¬ìœ  : {{reason}}

          </span>
        </span>
      </div>
      {% else %}
        <div style="font-size: 0.9rem; color:var(--color-main-light); background-color:var(--color-dark); border-radius: 50%; padding:2px 3px; margin: 0px;">{{jockey|slice:"-2:"}}</div>
      {% endif %}
    </a>

    
  </td>
  
  <td align="center" {% if rank < 90 %} style="font-family: Arial; color: var(--color-main); border-right: 1px solid gray;" {% else %} style="font-family: Arial; color: var(--color-main); background-color: var(--color-dark-light); border-right: 1px solid gray;" {% endif %}>

    <div style="font-size: 0.9rem; font-family: Arial; text-align: right; padding-top: 0.4rem;">
    {% if s1f_rank %}
      {% if s1f_rank >= 7 %}
      <span style="font-size: 0.9rem; padding:2.4px 1.2px; font-family: Arial; color:var(--color-light-gray); ">{{s1f_rank}}</span>
      {% elif s1f_rank >= 3 and s1f_rank < 7 %}
      <span style="font-size: 0.9rem; padding:2.4px 1.2px; font-family: Arial; color:var(--color-r2);">{{s1f_rank}}</span>
      {% else %}
      <span style="font-size: 0.9rem; padding:2.4px 1.2px; font-family: Arial; color:var(--color-r1); border-radius: 50%; background-color: var(--color-light);">{{s1f_rank}}</span>
      {% endif %}
    {% else %}
      <span style="font-size: 0.9rem; padding:2.4px 1.2px; font-family: Arial; color:var(--color-light-gray);">&nbsp;</span>
    {% endif %}
    </div>

    {# jt_per #}
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      <div style="padding-top: 0.2rem; font-family: Arial;">
      {% if jt_cnt == 0 %}
        <span style="font-size: 0.85rem; color:var(--color-r1);">ğŸ…¾ï¸</span>
      {%else%}

        {% if rcount|mul:1 > 12 and rank == 12 %}   {# ë§Œì•½ 12ë‘ ì´ìƒì˜ ê²½ì£¼ë§ˆê°€ ì¶œì£¼í–ˆìœ¼ë©´ ì¤„ì„ë§ í‘œì‹œ #}
          <span class="tooltip" style="font-size: 0.8rem; animation: blink-effect 1.0s step-end infinite; z-index: 1;">m..
            <span class="tooltip-text" style="width:2rem; z-index: 1;">ì¶œì£¼ë§ˆê°€ ë” ìˆìŠµë‹ˆë‹¤.</span>
          </span>
        {% else %}
          {% if jt_per == 100.0 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-r1);">{{jt_per|floatformat:0}}</span> 
          {% elif jt_per >= 50 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-r1);">{{jt_per|floatformat:1}}</span>
          {% elif jt_per >= 40 and jt_per < 50 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-r2);">{{jt_per|floatformat:1}}</span>
          {% elif jt_per >= 30 and jt_per < 40 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-r3);">{{jt_per|floatformat:1}}</span>
          {% elif jt_per >= 20 and jt_per < 30 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-light-gray);">{{jt_per|floatformat:1}}</span>
          {% elif jt_per >= 10 and jt_per < 20 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-gray);">{{jt_per|floatformat:1}}</span>
          {% elif jt_per > 0 and jt_per < 10 %} 
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-gray);">{{jt_per|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; font-size: 0.9rem; color:var(--color-5); border: 1px solid var(--color-r5); padding: 1px 3px; border-radius: 50%;">{{jt_cnt}}</span>
          {% endif %}
        {% endif %}
        
      {% endif %}
      </div>
    </a>

    {# ë¶€ë‹´ì¤‘ëŸ‰ ì¦˜ê° #}
    <div style="text-align: right;">
      <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      {% if handycap|sub:i_prehandy == 0 or handycap|sub:i_prehandy >= 10 %}
      <div style="padding-top:0.3rem;  font-size: 0.9rem; font-family: Arial; color:rgb(0,128,255); line-height:120%; text-align: center;">&nbsp;<br>-</div>
      {% else %}
      {% if handycap|sub:i_prehandy > 0 %}
      <div style="padding-top:0.3rem; font-size: 0.9rem; font-family: Arial; color:rgb(0,128,255); line-height:120%;">âœš<br>{{handycap|sub:i_prehandy}}</div>
      {% else %}
      <div style="padding-top:0.3rem; font-size: 0.9rem; font-family: Arial; color:tomato; line-height:120%;">âŠ–<br>{{handycap|sub:i_prehandy|mul:-1}}</div>
      {% endif %}
      {% endif %}
      </a>
    </div>

  </td>

  {% endif %}
  {% endfor %}



</tr>