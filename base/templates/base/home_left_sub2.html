{# thethe9 home í™”ë©´ ì¢Œì¸¡ë©”ë‰´ì˜ tabë³„ ë¦¬ìŠ¤íŠ¸ ì •ë³´ #}

{% load static %}
{% load mathfilters %}
{% load humanize %}

<tr class="home-left-sub2-row" data-rday="{{ r_rday }}">
  
  {# ê²½ì£¼ë²ˆí˜¸ / ê²½ì£¼ì¡°ê±´ #}
  <td style="vertical-align: middle; background-color: var(--color-dark-mid);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      
      {% if r2alloc %}
      <div class="tooltip"
           data-tip="â¡ï¸ {{r_rcity}} {{r_rdate|slice:'4:6'}}/{{r_rdate|slice:'6:8'}} ({{r_rday}}) {{r_rno}}R"
           style="font-size: 1.7rem; background-color: var(--color-bg); padding: 8px 10px; border-radius: 10px; border: 1px solid var(--color-dark-light);">
      {% else %}
      <div class="tooltip"
           data-tip="â¡ï¸ {{r_rcity}} {{r_rdate|slice:'4:6'}}/{{r_rdate|slice:'6:8'}} ({{r_rday}}) {{r_rno}}R"
           style="font-size: 1.7rem; background-color: var(--color-bg); padding: 8px 10px; border-radius: 10px; border: 1px solid var(--color-r3);">
      {% endif %}
        
        {% ifchanged r_rday %}
        <span class="js-rday-badge" style="font-size: 1.3rem; color:var(--color-r5); background-color: var(--color-dark-mid); border: 1px solid var(--color-r5); padding: 3px 5px; border-radius: 50%;">
          {{r_rday}}
        </span>
        {% endifchanged %}
        
        
        <span style="text-align: right; font-weight: normal; font-size: 1.7rem; border-bottom:1px solid orange; border-radius: 5px;">
          {% if r_rno|mul:1 >= 10 %}{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% else %}&nbsp;{{r_rno}}<sup style="font-size: 1.0rem;">R</sup>{% endif %}
        </span>

      </div>
    </a>
    <button
      type="button"
      class="race-comment-badge js-race-comment-open"
      data-rcity="{{ r_rcity }}"
      data-rdate="{{ r_rdate }}"
      data-rday="{{ r_rday }}"
      data-rno="{{ r_rno }}"
      aria-label="ëŒ“ê¸€ë‹¬ê¸°">
      ğŸ’¬ <strong class="js-race-comment-count">0</strong>
    </button>
  </td>

  <td align="right" style="background-color: var(--color-dark-mid);">
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
      <span>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-main);">{{rtime}}</div>
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-r3);">{{distance}}</div>
        {% if 'OPEN' in grade %}
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-r1);">{{grade|slice:"0:2"}}</div>
        {% else %}
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{grade|slice:"0:2"}}</div>
        {% endif %}

        {% if dividing|slice:"0:2" == 'ë³„ì •' %}
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-r1);">{{dividing|slice:"0:2"}}</div>
        {% else %}
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; color: var(--color-light-gray);">{{dividing|slice:"0:2"}}</div>
        {% endif %}
        
      </span>
    </a>
  </td>

  <td colspan="1" style="width:5.0%; background-color: var(--color-dark-mid);">

    <div style="text-align:center;">

      <a href="https://kraplayer.starplayer.net/kra/vod/starplayer.php?meet={% if r_rcity == 'ì„œìš¸' %}1{%else%}3{%endif%}&rcdate={{r_rdate}}&rcno={{r_rno}}&vod_type=r"
        onclick="window.open(this.href, 'w_broadcast', 'width=1400, height=700, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.2rem;">ğŸ–¥ï¸
          <span class="tooltip-text">ğŸ–¥ï¸&nbsp;&nbsp;Relay Broadcast</span>
        </span>
      </a>
    </div>

    {% if r2alloc %}
    
    <div align="right" style="padding-top: 4px;">
      <a href="{% url 'race_result' r_rcity r_rdate r_rno 0 0 0 0 %}"
        onclick="window.open(this.href, 'w_result', 'width=900, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
        <div class="tooltip" style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">
          {% with r2alloc|slice:"2:"|mul:1 as r2 %}
              {% if r2 < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r2alloc|slice:"2:9"}}</span>
              {% elif r2 <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r2alloc|slice:"2:9"}}</span>
              {% elif r2 <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r2alloc|slice:"2:9"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r1); font-weight: normal;">{{r2alloc|slice:"2:9"}}</span>
              {% endif %}
            {% endwith %}
          <div align="right" style="line-height: 110%;">
            {% with r333alloc|slice:"3:"|mul:1 as r333_val %}
              {% if r333_val < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r333alloc|slice:"3:10"}}</span>
              {% elif r333_val <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r333alloc|slice:"3:10"}}</span>
              {% elif r333_val <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r333alloc|slice:"3:10"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r1); font-weight: normal;">{{r333alloc|slice:"3:10"}}</span>
              {% endif %}
            {% endwith %}
          </div>
          <div align="right" style="line-height: 150%;">
            {% with r123alloc|slice:"3:"|mul:1 as r123_val %}
              {% if r123_val < 10 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r4); font-weight: normal;">{{r123alloc|slice:"3:10"}}</span>
              {% elif r123_val <= 50 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r3); font-weight: normal;">{{r123alloc|slice:"3:10"}}</span>
              {% elif r123_val <= 100 %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-r2); font-weight: normal;">{{r123alloc|slice:"3:10"}}</span>
              {% else %}
                <span style="font-size: 1.0rem; font-family: Arial; color:var(--color-main); font-weight: normal;">{{r123alloc|slice:"3:10"}}</span>
              {% endif %}
            {% endwith %}
          </div>

          <span class="tooltip-text" style="font-family: Arial; font-size: 1.1rem; text-align: left; width: 130px; z-index: 9;">
            
            <table style="z-index: 9;">
              <tr>
                <th style="font-size: 1.1rem;">ìŠ¹ì‹</th>
                <th style="font-size: 1.1rem;">ë°°ë‹¹ìœ¨</th>
              </tr>
              <tr>
                <td style="text-align: center; font-size: 1.1rem;">ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r2alloc|slice:"2:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ë³µìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r333alloc|slice:"3:"}}</td>
              </tr>
              <tr>
                <td style="font-size: 1.1rem;">ì‚¼ìŒìŠ¹</td>
                <td style="font-family: Arial; font-size: 1.1rem; text-align: right;">{{r123alloc|slice:"3:"}}</td>
              </tr>
      
            </table>
          </span>

          
        </div>
        

      </a>
    </div>
    
    
    {%else%}
    
    <div align="center" style="font-size: 1.1rem;">
      {% if request.user.username == 'admin' %}
      <a href="{% url 'race_review' r_rcity r_rdate r_rno %}" onclick="window.open(this.href, 'w_race_review', 'width=900, height=800, toolbars=no, scrollbars=yes'); return false;">
        <span class="tooltip" style="font-size: 1.0rem; padding-top: 0.7rem;">ğŸ”
          <span class="tooltip-text" style="font-size: 1.1rem; text-align: center; z-index: 1;">ğŸ”&nbsp;ì¸ê¸°ë„ & ê²½ì£¼ê²°ê³¼(ìˆœìœ„) ì…ë ¥</span>
        </span>
      </a>
      {% endif %}
    </div>
    {%endif%}

  </td>

  {% for rcity, rdate, rday, rno, gate, rank, r_rank, horse, remark, jockey, trainer, host, r_pop, distance, handycap, i_prehandy, complex, complex5, i_complex, jt_per, jt_cnt, jt_3rd, s1f_rank, i_cycle, rcount, recent3, recent5, convert_r, jockey_old, reason, alloc3r, m_rank, tot_score,  s1f_per, g3f_per, g1f_per, start_score, comment_one, g2f_rank, rec_per, rec8_trend, h_weight in expects_for_race|default_if_none:'' %}
  
  <td align="center" {% if rank < 90 %} style="color: var(--color-main); background-color: var(--color-dark-mid);" {% else %} style="color: var(--color-main); background-color: var(--color-dark-light);" {% endif %}>

    {# ë§ˆë²ˆ #}
    {% if r_rank > 90 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:brown; border-radius: 10px; padding-top: 2px;">
    {% elif r_rank == 0 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark); border-radius: 15px; border: 0.5px solid var(--color-bg); padding-top: 2px;">
    {% elif r_rank == 1 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r1); padding-top: 2px;">
    {% elif r_rank == 2 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r2); padding-top: 2px;">
    {% elif r_rank == 3 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-bg); border-radius: 10px; border: 0.5px solid var(--color-r3); padding-top: 2px;">
    {% elif r_rank == 4 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg); padding-top: 2px;">
    {% elif r_rank == 5 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg); padding-top: 2px;">
    {% elif r_rank == 6 %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark-medium); border-radius: 10px; border: 0.5px solid var(--color-bg); padding-top: 2px;">
    {% else %}
    <div align="center" class="home-left-sub2-gate-tooltip" style="font-style: italic; font-size: 1.6rem; background-color:var(--color-dark); border-radius: 10px; padding-top: 2px;">
    {% endif %}
    
      <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if r_rank %}
        {% if r_rank == 1 %}
        <span class="tooltip" style=" color:var(--color-r1); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank == 2 %}
        <span class="tooltip" style=" color:var(--color-r2); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank == 3 %}
        <span class="tooltip" style=" color:var(--color-r3); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank == 4 %}
        <span class="tooltip" style=" color:var(--color-r4); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank == 5 %}
        <span class="tooltip" style=" color:var(--color-r5); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank == 6 %}
        <span class="tooltip" style=" color:var(--color-r6); font-weight: normal;">
          {{gate}}<sub style="font-size: 0.9rem;">{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif r_rank > 90 %}
        <span class="tooltip" style=" color:var(--color-gray); font-size: 1.5rem; font-weight: normal; text-decoration:line-through white;">
          {{gate}}
          <span class="tooltip-text" style="font-size:clamp(0.96rem, 2.3vw, 1.1rem); line-height:1.46; text-align:left; color:#dce7f7; width:min(29rem, 84vw); max-width:84vw; padding:clamp(0.58rem, 1.55vw, 0.72rem) clamp(0.72rem, 1.9vw, 0.95rem); border-radius:10px; background:rgba(18,10,10,0.96); border:1px solid rgba(238,116,116,0.42); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
            <span style="display:block; font-style:normal; font-size:clamp(1.04rem, 3vw, 1.34rem); font-weight:800; color:#ffb2b2; letter-spacing:0.01em; margin-bottom:0.26rem;">ğŸ´ {{gate}}ë²ˆ {{horse}}</span>
            <br>
            <span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span>
            <br>
            {% if r_rank == 97 %}
            <span style="font-style:normal;">ğŸš«&nbsp;&nbsp;ì£¼í–‰ì¤‘ì§€ : {{reason}}</span>
            {% elif r_rank == 98 %}
            <span style="font-style:normal;">ğŸš«&nbsp;&nbsp;ì¶œì£¼ì·¨ì†Œ : {{reason}}</span>
            {% else %}
            <span style="font-style:normal;">ğŸš«&nbsp;&nbsp;ì·¨ì†Œ : {{reason}}</span>
            {% endif %}
        </span>
        </span>
        {% else %}
        <span class="tooltip" style=" color:var(--color-gray); font-size: 1.5rem;  font-weight: 350;">
          {{gate}}<sub style="font-size: 0.9rem;">&nbsp;{{r_rank}}</sub>
          <span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% endif %}
      {% else %}
        {% if rank == 1 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif rank == 2 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif rank == 3 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif rank == 4 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% elif rank == 5 %}
        <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
          {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
        {% else %}
          {% if complex == complex5 %}
          <span class="tooltip" style=" color:chartreuse; font-weight: normal; font-size:1.7rem;">
            {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
          {% else %}
          <span class="tooltip" style=" color:var(--color-light); font-weight: normal; font-size:1.6rem;">
            {{gate}}<span class="tooltip-text" style="font-size:clamp(0.98rem, 2.45vw, 1.12rem); line-height:1.48; font-style:normal; color:#dce7f7; text-align:left; z-index:999; width:min(34rem, 88vw); max-width:88vw; padding:clamp(0.62rem, 1.6vw, 0.8rem) clamp(0.78rem, 2vw, 1rem); border-radius:10px; background:rgba(8,14,28,0.96); border:1px solid rgba(120,160,210,0.35); box-shadow:0 10px 24px rgba(0,0,0,0.35);">
                    <span style="display:block; font-size:clamp(1.08rem, 3.1vw, 1.38rem); font-weight:800; color:#8fd8ff; letter-spacing:0.01em; margin-bottom:0.22rem;">ğŸ {{gate}}ë²ˆ {{horse}}</span><br><span style="display:block; font-size:1.03rem; color:#bcd0ec; margin-bottom:0.28rem;">â€¢ ê¸°ìˆ˜: {{jockey}} Â· ì¡°êµì‚¬: {{trainer}}<br>â€¢ ë§ˆì£¼: {{host}} Â· ë§ˆì²´ì¤‘: {{h_weight}} Â· ë¶€ë‹´ì¤‘ëŸ‰: {{handycap}}</span><br>â€¢ ver2 score: {{tot_score|floatformat:1}}<br>â€¢ ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>â€¢ ì„ í–‰ì‹œ ì…ìƒê¸°ëŒ€ ì ìˆ˜: {{start_score}}<br>â€¢ ì¢…ë°˜ 600m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>â€¢ ì¢…ë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>â€¢ ì¶œì£¼ì£¼ê¸°: {% if i_cycle %}{{i_cycle|div:7|floatformat:0}}<sup style="font-size: 0.8rem;">w</sup>{% else %}ì‹ ë§ˆ{% endif %}<br>{% if i_prehandy %}{% with handy_diff=handycap|sub:i_prehandy %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: {{handy_diff|floatformat:1}}<br>{% endwith %}{% else %}â€¢ ë¶€ë‹´ì¤‘ëŸ‰ ë³€í™”: 0.0<br>{% endif %}{% if not alloc3r %}{% with h_weight|slice:"0:3"|add:0 as weight_prefix %}{% if weight_prefix %}{% with handycap|div:weight_prefix|mul:100 as handy_ratio %}â€¢ ë§ˆì²´ì¤‘({{weight_prefix}})/ë¶€ë‹´ì¤‘ëŸ‰({{handycap}}) ì§€ìˆ˜: {{handy_ratio|floatformat:1}}{% endwith %}{% else %}â€¢ ë§ˆì²´ì¤‘/ë¶€ë‹´ì¤‘ëŸ‰ ì§€ìˆ˜: NA{% endif %}{% endwith %}{% endif %}</span></span>
          {% endif %}
        {% endif %}
      {% endif %}
      </a>
    </div>

    <div style="text-align:center; font-size:0.88rem; line-height:1.15; margin-top:0.1rem;">
      {% if i_cycle %}
      {% if i_cycle <= 14 %}
      <span style="color:var(--color-r1);">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.72rem;">w</sup></span>
      {% elif i_cycle >= 70 %}
      <span style="color:var(--color-r3);">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.72rem;">w</sup></span>
      {% else %}
      <span style="color:var(--color-light-gray);">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.72rem;">w</sup></span>
      {% endif %}
      {% else %}
      <span style="color:var(--color-gray);">ì‹ ë§ˆ</span>
      {% endif %}
    </div>
    
    <div>
    {# ê¸°ìˆ˜ #}
    <a href="{% url 'race_prediction' r_rcity r_rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">

      {% if jockey_old %}
      <span class="jockey-badge jockey-badge--changed">
        <span class="tooltip" style="color:var(--color-light); font-weight: normal;">
          {{jockey|slice:"-2:"}}
          <span class="tooltip-text" style="text-align: left; font-size: 1.0rem;">
            ğŸ‡&nbsp;ê¸°ìˆ˜ ë³€ê²½<br>
            ë³€ê²½ì „ : {{jockey_old}}<br>
            ì‚¬ìœ  : {{reason}}
          </span>
        </span>
      </span>
      {% else %}
      <span class="jockey-badge">{{jockey|slice:"-2:"}}</span>
      {% endif %}
    </a>
    </div>

    <div style="text-align:center; font-size:0.95rem;">
      <span style="font-weight: normal;">
      {% if tot_score == 100 %}
      <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{tot_score|floatformat:0}}</span>
      {% elif tot_score >= 90.0 and tot_score < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 80.0 and tot_score < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 70 and tot_score < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 60 and tot_score < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score >= 50 and tot_score < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{tot_score|floatformat:1}}</span>
      {% elif tot_score == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); ">{{tot_score|floatformat:1}}</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{tot_score|floatformat:1}}</span>
      {% endif %}
      </span>
    </div>

    
  </td>
  
  <td align="center" {% if rank < 90 %} style="font-family: Arial; color: var(--color-main); background-color: var(--color-dark-mid);" {% else %} style="font-family: Arial; color: var(--color-main); background-color: var(--color-dark-light);" {% endif %}>

    <div style="text-align:right; font-size:0.9rem;">
      <span style="font-weight: normal;">
      {% if s1f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif s1f_per >= 90.0 and s1f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px; ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 80.0 and s1f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 70 and s1f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 60 and s1f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per >= 50 and s1f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{s1f_per|floatformat:1}}</span>
      {% elif s1f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{s1f_per|floatformat:1}}</span>
      {% endif %}
      </span>
    </div>

    <div style="text-align:right; font-size:0.9rem;">
      <span style="font-weight: normal;">
      {% if g3f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif g3f_per >= 90.0 and g3f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 80.0 and g3f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 70 and g3f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 60 and g3f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per >= 50 and g3f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{g3f_per|floatformat:1}}</span>
      {% elif g3f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{g3f_per|floatformat:1}}</span>
      {% endif %}
      </span>
    </div>

    <div style="text-align:right; font-size:0.9rem;">
      <span style="font-weight: normal;">
      {% if g1f_per == 100 %}
      <span style="font-family: Arial; color: var(--color-r1);  font-weight: bold;">âš¡ï¸</span>
      {% elif g1f_per >= 90.0 and g1f_per < 100 %}
      <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 80.0 and g1f_per < 90 %}
      <span style="font-family: Arial; color: var(--color-r2); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 70 and g1f_per < 80 %}
      <span style="font-family: Arial; color: var(--color-r3); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 60 and g1f_per < 70 %}
      <span style="font-family: Arial; color: var(--color-r4); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per >= 50 and g1f_per < 60 %}
      <span style="font-family: Arial; color: var(--color-r5); ">{{g1f_per|floatformat:1}}</span>
      {% elif g1f_per == 0 %}
      <span style="font-family: Arial; color: var(--color-r1); font-size:0.7rem;">ğŸ”´</span>
      {% else %}
      <span style="font-family: Arial; color: var(--color-gray);">{{g1f_per|floatformat:1}}</span>
      {% endif %}
      </span>
    </div>

    {# ë¶€ë‹´ì¤‘ëŸ‰ #}
    <div style="text-align:right; font-size:0.9rem;">
      <span style="font-weight: normal;">
      {% if i_prehandy %}
        {% with handy_diff=handycap|sub:i_prehandy %}
          {% if handy_diff >= 2 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">+{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff >= 0.5 and handy_diff < 2 %}
          <span style="font-family: Arial; color: var(--color-r2); ">+{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff == 0 %}
          <span style="font-family: Arial; color: var(--color-gray); ">{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff >= -1.5 and handy_diff <= -0.5 %}
          <span style="font-family: Arial; color: var(--color-r4); ">{{handy_diff|floatformat:1}}</span>
          {% elif handy_diff < -1.5 %}
          <span style="font-family: Arial; color: var(--color-r5); ">{{handy_diff|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{handy_diff|floatformat:1}}</span>
          {% endif %}
        {% endwith %}
      {% else %}
        {% with handy_diff=0 %}
          <span style="font-family: Arial; color: var(--color-gray); ">{{handy_diff|floatformat:1}}</span>
        {% endwith %}
      {% endif %}
      </span>
    </div>
    
    {% if alloc3r %}
      <div style="font-size: 0.9rem; font-family: Arial; text-align: right;">
        
        {% if r_rank == 1 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r1); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% elif r_rank == 2 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r2); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% elif r_rank == 3 %}
        <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r3); border-radius: 4px; background-color: var(--color-bg);">{{alloc3r}}</span>
        {% else %}
          {% if alloc3r >= 1.0 and alloc3r < 2.0 %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-r1); border-radius:4px; border-bottom: 1px solid var(--color-r1);">{{alloc3r}}</span>
          {% elif alloc3r >= 2.0 and alloc3r < 3.0 %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-light); border-radius:4px; border-bottom: 1px solid var(--color-gray);">{{alloc3r}}</span>
          {% else %}
          <span style="font-size: 0.9rem; padding:2px 2px; font-family: Arial; color:var(--color-gray); border-radius:4px; border-bottom: 1px solid var(--color-gray);">{{alloc3r}}</span>
          {% endif %}
        {% endif %}
      </div>

    {% else %}
      <div style="text-align:right; font-size:0.9rem;">
        <span style="font-weight: normal;">
        {% with h_weight|slice:"0:3"|add:0 as weight_prefix %}
        {% if weight_prefix %}
          {% with handycap|div:weight_prefix|mul:100 as handy_ratio %}
          {% if handy_ratio >= 11.9 %}
          <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px; ">{{handycap}}</span>
          {% elif handy_ratio >= 11 and handy_ratio < 11.9 %}
          <span style="font-family: Arial; color: var(--color-r2); ">{{handycap}}</span>
          {% elif handy_ratio >= 10 and handy_ratio < 11 %}
          <span style="font-family: Arial; color: var(--color-r3); ">{{handycap}}</span>
          {% elif handy_ratio <= 10 %}
          <span style="font-family: Arial; color: var(--color-r4); ">{{handycap}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{handycap}}</span>
          {% endif %}
          {% endwith %}
        {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">NA</span>
        {% endif %}
        {% endwith %}
        </span>
      </div>

    {% endif %}
    
  </td>


  

  {% endfor %}



</tr>
