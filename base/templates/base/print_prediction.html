<!DOCTYPE html>
{% load static %}
<html lang="en">

<head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BFZZL101LZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-BFZZL101LZ');
  </script>
  <!-- End Google tag -->
  
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="shortcut icon" type="image/x-icon" href="{% static '/images/number-9.png' %}" />
  <link rel="stylesheet" href="{% static 'styles/style.css' %}" />
  <link rel="stylesheet" href="{% static 'styles/styles.css' %}" />

  <title>{{fdate}}&nbsp;{{race.0.0}}({{race.0.2}}) Race Prediction</title>
  <style>
    :root {
      --print-bg: #e9eef5;
      --sheet-bg: #ffffff;
      --line: #9eafc2;
      --line-soft: #c8d4e2;
      --head-bg: #eef4fb;
      --head-text: #2d435c;
      --text-main: #24364b;
      --text-sub: #4c627a;
    }

    html {
      font-size: 62.5%;
    }

    body {
      margin: 0;
      background: var(--print-bg);
      color: #1e2b3b;
      font-family: "Pretendard", "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
    }

    .print-toolbar {
      max-width: 1320px;
      margin: 8px auto 0;
      padding: 10px 14px;
      border: 1px solid #c4d2e0;
      border-radius: 12px;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: 0 6px 18px rgba(21, 35, 52, 0.08);
    }

    .print-toolbar form {
      display: flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 1.26rem;
    }

    .print-toolbar__group {
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .print-toolbar__label {
      font-size: 1.2rem;
      font-weight: 700;
      color: #2f4560;
      white-space: nowrap;
    }

    .print-toolbar fieldset {
      border: 1px solid #d3deea;
      border-radius: 8px;
      padding: 5px 9px;
      margin: 0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f8fbff;
    }

    .print-toolbar fieldset label {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      font-size: 1.2rem;
      color: #324a65;
      font-weight: 600;
      line-height: 1;
    }

    .print-toolbar input[type="radio"] {
      width: 1.32rem;
      height: 1.32rem;
      accent-color: #3b9bc2;
    }

    .print-toolbar input[type="date"],
    .print-toolbar input[type="text"] {
      border: 1px solid #c5d2df;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 1.2rem;
      color: #1f344b;
      background: #ffffff;
    }

    .print-toolbar input[type="date"] {
      min-width: 14.2rem;
    }

    .print-toolbar__toggle {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border: 1px solid #cad7e5;
      border-radius: 9px;
      padding: 2px;
      background: #f3f8ff;
    }

    .print-toolbar__toggle label {
      display: inline-flex;
      align-items: center;
      gap: 3px;
      padding: 4px 8px;
      border-radius: 7px;
      font-size: 1.2rem;
      color: #365171;
      font-weight: 700;
    }

    .print-toolbar .btn {
      border: 0;
      border-radius: 8px;
      padding: 7px 14px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      background: #59aeca;
      color: #fff;
      white-space: nowrap;
    }

    .print-toolbar .btn.btn-print {
      background: #7286a1;
    }

    .print-sheet-wrap {
      max-width: 1320px;
      margin: 0 auto;
      padding: 8px 0 24px;
    }

    .a4-sheet {
      width: calc(100vw - 12px);
      max-width: 1320px;
      min-height: auto;
      margin: 0 auto;
      background: var(--sheet-bg);
      box-shadow: 0 8px 24px rgba(18, 30, 44, 0.15);
      border-radius: 10px;
      padding: 16px 14px;
      overflow: auto;
    }

    .print-sheet-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 10px;
      padding: 8px 10px;
      border: 1px solid var(--line-soft);
      border-radius: 10px;
      background: linear-gradient(180deg, #f8fbff, #f2f7fc);
    }

    .print-sheet-head__title {
      font-size: 1.46rem;
      font-weight: 800;
      color: #1f3651;
      letter-spacing: 0.01em;
    }

    .print-sheet-head__meta {
      display: inline-flex;
      align-items: center;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 1.08rem;
      color: var(--text-sub);
    }

    .print-chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 7px;
      border: 1px solid #c9d6e4;
      border-radius: 999px;
      background: #ffffff;
      color: #3a526d;
      font-weight: 700;
      line-height: 1.2;
    }

    .print-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      background: #fff;
      color: var(--text-main);
      font-size: 1.08rem;
    }

    .print-table th,
    .print-table td {
      border: 1px solid var(--line);
      padding: 5px 3px;
      vertical-align: middle;
      line-height: 1.28;
    }

    .print-table thead th {
      background: var(--head-bg);
      color: var(--head-text);
      white-space: nowrap;
    }

    .print-table tbody tr:nth-child(even) td {
      background: #fbfdff;
    }

    .print-table thead th {
      position: sticky;
      top: 0;
      z-index: 2;
    }

    /* RÏåç(ÎßàÎ≤à/ÏßÄÌëú) Í∞ÄÏö¥Îç∞ Íµ¨Î∂ÑÏÑ† Ï†úÍ±∞ */
    .print-table td.print-gate-td {
      border-right: none !important;
    }

    .print-table td.print-metric-td {
      border-left: none !important;
    }

    /* Í≤ΩÏ£ºÎ≤àÌò∏(Ìñâ Ï≤´ Î≤àÏß∏ TD) Ïö∞Ï∏° Î≥¥Îçî Ï†úÍ±∞ */
    .print-table td.print-rno-td {
      border-right: none !important;
    }

    .print-table td.print-rinfo-td {
      border-left: none !important;
    }

    @page {
      size: A4;
      margin: 8mm;
    }

    @media print {
      body {
        background: #fff;
      }

      .print-toolbar,
      footer,
      #header {
        display: none !important;
      }

      .print-sheet-wrap {
        padding: 0;
        max-width: none;
      }

      .a4-sheet {
        width: 210mm;
        min-height: 297mm;
        margin: 0;
        padding: 0;
        border-radius: 0;
        box-shadow: none;
        max-width: none;
      }

      .print-sheet-head {
        margin-bottom: 6px;
        box-shadow: none;
      }

      .print-table thead {
        display: table-header-group;
      }

      .print-table tr {
        break-inside: avoid;
        page-break-inside: avoid;
      }

      .print-table thead th {
        position: static;
      }

      .print-table th,
      .print-table td {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }

      .print-table tbody tr:nth-child(even) td {
        background: #fff;
      }
    }

    @media (max-width: 980px) {
      .print-toolbar {
        margin: 8px 4px 0;
        max-width: none;
      }

      .print-sheet-wrap {
        max-width: none;
      }

      .a4-sheet {
        width: calc(100vw - 8px);
        padding: 10px 8px;
      }
    }
  </style>

</head>

{% load mathfilters %}
{% load humanize %}

{% block content %}
<body>
  <div class="print-toolbar">
    <form method="GET" action="{% url 'print_prediction' %}">
      <div class="print-toolbar__group">
        <span class="print-toolbar__label">Í≤ΩÎßàÏû•</span>
        <fieldset>
          {% if race.0.0 == 'ÏÑúÏö∏' %}
            <label>ÏÑúÏö∏ <input type="radio" name="rcity" value="ÏÑúÏö∏" checked></label>
            <label>Î∂ÄÏÇ∞ <input type="radio" name="rcity" value="Î∂ÄÏÇ∞"></label>
          {% elif race.0.0 == 'Î∂ÄÏÇ∞' %}
            <label>ÏÑúÏö∏ <input type="radio" name="rcity" value="ÏÑúÏö∏"></label>
            <label>Î∂ÄÏÇ∞ <input type="radio" name="rcity" value="Î∂ÄÏÇ∞" checked></label>
          {% else %}
            <label>ÏÑúÏö∏ <input type="radio" name="rcity" value="ÏÑúÏö∏"></label>
            <label>Î∂ÄÏÇ∞ <input type="radio" name="rcity" value="Î∂ÄÏÇ∞"></label>
          {% endif %}
        </fieldset>
      </div>

      <div class="print-toolbar__group">
        <span class="print-toolbar__label">Í≤ΩÎßàÏùº</span>
        <input type="date" value="{{ fdate }}" name="q">
      </div>

      <div class="print-toolbar__group">
        <span class="print-toolbar__label">Ï°∞ÌöåÍ∏∞Ï§Ä</span>
        <div class="print-toolbar__toggle">
          <label>v1 <input type="radio" name="view_type" value="1" {% if view_type == "1" %}checked{% endif %}></label>
          <label>v2 <input type="radio" name="view_type" value="2" {% if view_type != "1" %}checked{% endif %}></label>
        </div>
      </div>

      <button class="btn" type="submit">Ï°∞Ìöå</button>
    </form>
    <button class="btn btn-print" type="button" onclick="window.print();">Ïù∏ÏáÑ</button>
  </div>

<main class="print-sheet-wrap">
  <div class="a4-sheet">
      <section class="print-sheet-head">
        <div class="print-sheet-head__title">Program Expected Ranking</div>
        <div class="print-sheet-head__meta">
          <span class="print-chip">Í≤ΩÎßàÏû• {{ race.0.0|default:"-" }}</span>
          <span class="print-chip">Í≤ΩÎßàÏùº {{ fdate|default:"-" }}</span>
          <span class="print-chip">Ï°∞ÌöåÍ∏∞Ï§Ä {% if view_type == "1" %}v1{% else %}v2{% endif %}</span>
          <span class="print-chip">Ï∂úÎ†• {% now "Y.m.d H:i" %}</span>
        </div>
      </section>
      <table class="print-table">
        <thead>
          <tr>
            <th width="7.0%" colspan="2" rowspan="2" align="center" style="vertical-align: middle; font-size:1.7rem; font-weight:700; color:#444444; text-transform:capitalize; border-right: 1px solid #444444;">
              {{race.0.0}}
            <th width="93%" colspan="24" rowspan="1" align="center" style="font-size:1.5rem; color:#444444; text-transform:capitalize;">
              {{race.0.1|slice:"0:4"}}.{{race.0.1|slice:"4:6"}}.{{race.0.1|slice:"6:8"}}&nbsp; ({{race.0.2}})&nbsp;&nbsp;&nbsp;&nbsp;
            
              Program Expected Ranking (Î∂ÄÎã¥Ï§ëÎüâ Ï¶ùÍ∞ê : ‚äñ üü• ‚úö üü¶)</th>
          </tr>
          <tr>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R1</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R2</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R3</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R4</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R5</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R6</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R7</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R8</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R9</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R10</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">R11</th>
            <th width="7.6%" colspan="2" align="center" style="font-size:1.5rem; color:#444444;">r12</th>
          </tr>
        </thead>
        <tbody>
          {% for r_rcity, r_rdate, r_rday, r_rno, rtime, distance, grade, dividing in race %}
          
          <tr>
            <td class="print-rno-td" style="text-align: right; vertical-align: top;">
              <div style="font-family: Arial; font-size:1.9rem; font-weight: 550; color:var(--color-dark);">{{r_rno}}</div>
            </td>
            
            <td class="print-rinfo-td" style="border-right: 1px solid #444444;">
              
              <div style="font-size:0.9rem; text-align:center; color:blue; font-family: Arial; padding-bottom: .3rem;">{{rtime}}</div>
              <div style="font-size:0.9rem; font-family: Arial; text-align:center; color: var(--color-r2);">{{distance}}</div>
              <div style="font-size:0.9rem; font-family: Arial; text-align:center; color: var(--color-r5);">
                <span>{{grade}}</span>
              </div>
              <div style="font-size:0.9rem; font-family: Arial; text-align:center; color: var(--color-r5);">
                <span>{{dividing}}</span>
              </div>

              
            </td>


            {% for rcity, rdate, rday, rno, gate, rank, r_rank, horse, remark, jockey, trainer, host, r_pop, distance, handycap, i_prehandy, complex, complex5, i_complex, jt_per, jt_cnt, jt_3rd, s1f_rank, i_cycle, rcount, recent3, recent5, convert_r, jockey_old, reason, alloc3r, m_rank, tot_score, s1f_per, g3f_per, g1f_per, start_score, comment_one, g2f_rank, rec_per, rec8_trend, h_weight, disease, tcnt in expects %}  
            {% if r_rcity == rcity and r_rdate == rdate and r_rno == rno %}
            
            <td class="print-gate-td" align="center" {% if rank < 90 %} style="font-family: Arial; color: #26384d; background-color: #ffffff;" {% else %} style="font-family: Arial; color: #26384d; background-color: #f4f7fb;" {% endif %}>
              <div align="center" style="font-style: italic; font-size: 1.55rem; border-radius: 10px; padding-top: 2px; background-color: #f8fbff; border: 1px solid #d2deea;">
                {% if r_rank %}
                <span style="color:#304a67; font-weight: 700;">
                  {{gate}}<sub style="font-size: 0.8rem;">{{r_rank}}</sub>
                </span>
                {% else %}
                <span style="color:#4a6078;">{{gate}}</span>
                {% endif %}
              </div>

              <div style="text-align:center; font-size:0.82rem; line-height:1.15; margin-top:0.1rem;">
                {% if i_cycle %}
                  {% if i_cycle <= 14 %}
                  <span style="color:#d93b3b;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% elif i_cycle >= 70 %}
                  <span style="color:#e08a1f;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% else %}
                  <span style="color:#6a7f96;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                  {% endif %}
                {% else %}
                <span style="color:#8a9aab;">Ïã†Îßà</span>
                {% endif %}
              </div>

              <div style="font-size:0.86rem; font-weight:600; line-height:1.2;">
                {% if jockey_old %}
                <span style="display:inline-block; padding:1px 4px; border-radius:6px; color:#ffffff; background:#667d95;">{{jockey|slice:"-2:"}}</span>
                {% else %}
                <span style="color:#2f455d;">{{jockey|slice:"-2:"}}</span>
                {% endif %}
              </div>

              <div style="text-align:center; font-size:0.88rem; line-height:1.15;">
                {% if tot_score == 100 %}
                <span style="font-family: Arial; color: #d93b3b; font-weight: bold;">{{tot_score|floatformat:0}}</span>
                {% elif tot_score >= 90 and tot_score < 100 %}
                <span style="font-family: Arial; color: #d93b3b;">{{tot_score|floatformat:1}}</span>
                {% elif tot_score >= 80 and tot_score < 90 %}
                <span style="font-family: Arial; color: #e08a1f;">{{tot_score|floatformat:1}}</span>
                {% elif tot_score >= 70 and tot_score < 80 %}
                <span style="font-family: Arial; color: #2a86d1;">{{tot_score|floatformat:1}}</span>
                {% elif tot_score >= 60 and tot_score < 70 %}
                <span style="font-family: Arial; color: #4d7ea8;">{{tot_score|floatformat:1}}</span>
                {% else %}
                <span style="font-family: Arial; color: #7b8795;">{{tot_score|floatformat:1}}</span>
                {% endif %}
              </div>
            </td>

            <td class="print-metric-td" align="right" {% if rank < 90 %} style="font-family: Arial; color: #26384d; border-right: 1px solid gray; background-color:#ffffff;" {% else %} style="font-family: Arial; color: #26384d; background-color:#f4f7fb; border-right: 1px solid gray;" {% endif %}>
              <div style="text-align:right; font-size:0.86rem;">
                {% if s1f_per >= 90 %}<span style="color:#d93b3b;">{{s1f_per|floatformat:1}}</span>
                {% elif s1f_per >= 80 %}<span style="color:#e08a1f;">{{s1f_per|floatformat:1}}</span>
                {% elif s1f_per >= 70 %}<span style="color:#2a86d1;">{{s1f_per|floatformat:1}}</span>
                {% elif s1f_per >= 60 %}<span style="color:#4d7ea8;">{{s1f_per|floatformat:1}}</span>
                {% else %}<span style="color:#8a97a4;">{{s1f_per|floatformat:1}}</span>{% endif %}
              </div>

              <div style="text-align:right; font-size:0.86rem;">
                {% if g3f_per >= 90 %}<span style="color:#d93b3b;">{{g3f_per|floatformat:1}}</span>
                {% elif g3f_per >= 80 %}<span style="color:#e08a1f;">{{g3f_per|floatformat:1}}</span>
                {% elif g3f_per >= 70 %}<span style="color:#2a86d1;">{{g3f_per|floatformat:1}}</span>
                {% elif g3f_per >= 60 %}<span style="color:#4d7ea8;">{{g3f_per|floatformat:1}}</span>
                {% else %}<span style="color:#8a97a4;">{{g3f_per|floatformat:1}}</span>{% endif %}
              </div>

              <div style="text-align:right; font-size:0.86rem;">
                {% if g1f_per >= 90 %}<span style="color:#d93b3b;">{{g1f_per|floatformat:1}}</span>
                {% elif g1f_per >= 80 %}<span style="color:#e08a1f;">{{g1f_per|floatformat:1}}</span>
                {% elif g1f_per >= 70 %}<span style="color:#2a86d1;">{{g1f_per|floatformat:1}}</span>
                {% elif g1f_per >= 60 %}<span style="color:#4d7ea8;">{{g1f_per|floatformat:1}}</span>
                {% else %}<span style="color:#8a97a4;">{{g1f_per|floatformat:1}}</span>{% endif %}
              </div>

              <div style="text-align:right; font-size:0.86rem; margin-top:1px;">
                {% if i_prehandy == 0.0 %}
                <span style="color:#3c4f63;">{{handycap}}</span>
                {% elif handycap|sub:i_prehandy == 0 %}
                <span style="color:#6e7f91;">{{handycap}}</span>
                {% elif handycap|sub:i_prehandy > 0 %}
                <span style="color:#2a86d1;">{{handycap}}</span>
                {% else %}
                <span style="color:#d93b3b;">{{handycap}}</span>
                {% endif %}
              </div>
            </td>
            

            {% endif %}
            {% endfor %}

          </tr>
          {% endfor %}
      
      
        </tbody>
      </table>

  </div>

  <script src="{% static 'js/script.js' %}"></script>
  
  <script src="{% static 'js/jquery-3.6.1.js' %}"></script>

</main>
{% endblock %}

{% include 'footer.html' %}
 </body>
</html>
