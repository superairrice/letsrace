{% load static %}
{% load mathfilters %}
{% load humanize %}

<style>
  /* í¬íƒˆ ê¸°ë°˜ íˆ´íŒ: ì»¨í…Œì´ë„ˆ overflowì— ì˜ë¦¬ì§€ ì•Šë„ë¡ ìµœìƒë‹¨ì— í‘œì‹œ */
  .tooltip .tooltip-text { display: none !important; }
  .tooltip-portal {
    position: fixed;
    z-index: 99999;
    max-width: 42rem;
    background: rgba(18,18,18,0.96);
    color: var(--color-light-gray);
    padding: 8px 10px;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    pointer-events: none;
    font-size: 1.1rem;
    line-height: 1.35;
  }
</style>

<table class="fold-table" style="border-radius: 7px;">
  <thead>
    <tr>
      
      {% if exp011s.0.r_rank > 0 %}
      <th rowspan="1"><span style="color:var(--color-main); font-weight: bold;">ì˜ˆìƒ</span></th>
      {% else %}
      <th rowspan="2" style="vertical-align: middle;"><div style="font-size: 2.0rem; color: var(--color-r3);">ğ‘</div></th>
      {% endif %}

      <th rowspan="1" valign="center"><span style="color:var(--color-main); font-weight: bold;">ë§ˆë²ˆ</span></th>

      <th colspan="2">
        <a href="{% url 'status_stable' r_condition.rcity r_condition.rdate r_condition.rno %}"
          onclick="window.open(this.href, 'w_status_stable', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">
          <span class="tooltip" style="font-size: 1.2rem;">ğŸ´&nbsp;Horse
            <span class="tooltip-text">ğŸ”‘&nbsp;ë§ˆë°© ê²½ì£¼ë§ˆ ë³´ìœ í˜„í™© </span>
        </a>
      </th>
      <th rowspan="2" style="vertical-align:middle">
        <span class="tooltip" style="font-size:1.2rem; color:var(--color-r5);">ğŸš›
          <span class="tooltip-text" style="font-size:1.1rem; text-align: left;">
            ğŸš›&nbsp;ê¸°ìˆ˜ ë¶€ë‹´ì¤‘ëŸ‰
          </span>
        </span>
      </th>

      <th>
        <a href="{% url 'trend_winning_rate' r_condition.rcity r_condition.rdate r_condition.rno 'jockey' '99' %}"
          onclick="window.open(this.href, 'w_trend_jockey', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">
          <span class="tooltip" style="font-size: 1.2rem;">ğŸ‡
            <span class="tooltip-text">ğŸ”‘&nbsp;ê¸°ìˆ˜ ì—°ìŠ¹ìœ¨ ì¶”ì´</span>
        </a>
      </th>
      <th rowspan="2"><div>ë³µ</div><div>ìŠ¹</div><div>%</div></th>
      <th rowspan="2" style="vertical-align: middle;"><span class="tooltip">J&T<sup style="font-size: 0.7rem;">%</sup><span class="tooltip-text">ë§ˆë°© & ê¸°ìˆ˜ 3ìœ„ë‚´ ì…ìƒí˜„í™©</span></span></th>
      <th rowspan="2" style="vertical-align: middle;"><span class="tooltip">
          <span style="font-size: 0.8rem; text-transform:capitalize;">Form<br>Race8</span><span class="tooltip-text">ìµœê·¼ ê¸°ë¡ Form & ìµœê·¼ 8ê²½ì£¼ ì¶”ì„¸</span></span>
      </th>
      <th rowspan="1"><span>s1f</span></th>
      <th rowspan="1"><span>g3f</span></th>
      <th rowspan="1"><span>g1f</span></th>
      
      <th rowspan="2" colspan="1" style="vertical-align: middle;">
        {% if request.user.is_authenticated %}
        <a href="{% url 'race_simulation' r_condition.rcity r_condition.rdate r_condition.rno 0 0 %}" onclick="window.open(this.href, 'w_simulation', 'width=900, height=1000, toolbars=no, scrollbars=yes'); return false;">
        <div style="text-transform:lowercase; font-style: italic; font-size:1.1rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px;">thethe9</div>
        <div style="text-transform:capitalize; font-style: italic; font-size:0.9rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px;color:dodgerblue;">Simulation</div>
        <div style="text-transform:capitalize; font-style: italic; font-size:0.9rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px; text-align: right;">ê¸°ë¡ì°¨</div>
        </a>
        {% else %}
        <div style="text-transform:lowercase; font-style: italic; font-size:1.1rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px;">thethe9</div>
        <div style="text-transform:capitalize; font-style: italic; font-size:0.9rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px;color:dodgerblue;">Simulation</div>
        <div style="text-transform:capitalize; font-style: italic; font-size:0.9rem; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px; text-align: right;">ê¸°ë¡ì°¨</div>
        {% endif %}
      </th>
      <th>
        <span style="font-size: 1.1rem; color:var(--color-r5); font-family: Arial, Helvetica, sans-serif;">{{r_condition.distance}}á´¹</span>
        <span style="font-size: 1.1rem;">3á´¿</span>
      </th>
      
      {% if exp011s.0.r_rank > 0 %}
      <th><div>P.&nbsp;í™˜ì‚°</div></th>
      {% else %}
      <th rowspan="2" style="vertical-align: middle;"><div>P.&nbsp;í™˜ì‚°</div></th>
      {% endif %}

      <th rowspan="2" style="vertical-align: middle;"><span style="font-size: 1.2rem;">ìµœê·¼ 7ê²½ì£¼<br>ìˆœìœ„</span></th>

      {% if exp011s.0.r_rank > 0 %}
      <th><span style="color:var(--color-bg)">ë‹¨ì‹</span></th>
      {% endif %}
      
    </tr>
    <tr>
      
      {% if exp011s.0.r_rank > 0 %} {# ê²½ì£¼ê²°ê³¼ê°€ ì…ë ¥ë˜ì—ˆìœ¼ë©´ #}
      <th rowspan="1"><span style="color:var(--color-main); font-weight: bold;">ê²°ê³¼</span></th>
      {% endif %}

      <th rowspan="1"><span style="font-size: 1.2rem; color:var(--color-light); border-radius: 10px; background-color:var(--color-bg); padding: 2px 4px;">AI R</span></th>

      <th>
        <a href="{% url 'cycle_winning_rate' r_condition.rcity r_condition.rdate r_condition.rno 'trainer' '99' %}"
          onclick="window.open(this.href, 'w_cycle_winning_rate', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">
          <span class="tooltip" style="font-size: 1.2rem;">Info.
            <span class="tooltip-text">ğŸ”‘&nbsp;ë§ˆë°© ì¶œì£¼ì£¼ê¸°ë³„ ì—°ìŠ¹ë¥ </span>
        </a>
      <th rowspan="1">
        <span class="tooltip" style="font-size:1.0rem; color:var(--color-r5);">âš–ï¸
          <span class="tooltip-text" style="font-size:1.1rem;">ğŸ´ ë§ˆì²´ì¤‘ ì¦ê°</span>
        </span>
      </th>

      <th>
        <a href="{% url 'trend_winning_rate' r_condition.rcity r_condition.rdate r_condition.rno 'trainer' '99' %}"
          onclick="window.open(this.href, 'w_trend_trainer', 'width=900, height=880, toolbars=no, scrollbars=yes'); return false;">
          <span class="tooltip" style="font-size: 1.2rem;">ğŸ›–
            <span class="tooltip-text">ğŸ”‘&nbsp;ë§ˆë°© ì—°ìŠ¹ìœ¨ ì¶”ì´</span>
        </a>
      </th>

      <th rowspan="1"><span style="font-size: 0.8rem; color:var(--color-r5); ">Score</span></th>
      <th rowspan="1" colspan="2">
        <div style="font-size: 1.2rem; font-family: Arial, Helvetica, sans-serif; background-color: var(--color-bg); padding:1px 4px; border-radius: 7px;">
          <span class="blink" style="font-size: 1.2rem; color:var(--color-main); font-style: italic;">
            {% if track.0.0 %}{{track.0.0|slice:"0:1"}}&nbsp;{{track.0.0|slice:"1:"}}{% endif %}
          </span>
        </div>
      </th>
  
      <th><span style="font-size: 1.2rem;">ìµœê·¼ 6á´¿</span></th>

      {% if exp011s.0.r_rank > 0 %} {# ê²½ì£¼ê²°ê³¼ê°€ ì…ë ¥ë˜ì—ˆìœ¼ë©´ #}
      <th>
        <span class="tooltip" style="font-size: 1.0rem; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg); color: var(--color-light-gray);">
          íšŒë³µë°œì£¼
          <span class="tooltip-text">ğŸ”´ í”¼ë¡œíšŒë³µ ğŸ”µ ì¶œë°œì¡°êµ ğŸŸ¢ ë°œì£¼ì¡°êµ</span>
        </span>
      </th>
      {% endif %}

      {% if exp011s.0.r_rank > 0 %}
      <th><span style="color:var(--color-bg)">ì—°ì‹</span></th>
      {% endif %}
      
      
    </tr>

  </thead>
  <tbody>
    {% for r in exp011s %}
    <tr class="view" {% if r.r_rank == 99 %} style="background: var(--color-dark-light);" {% endif %}>
      
      <td align="center" style="font-family: Arial; font-size: 1.4rem; color: var(--color-main-light); background-color: var(--color-dark-medium); border-radius: 10px; border: 1px solid var(--color-bg);">
        <div style="font-family: Arial;">{% if r.rank > 20 %}<span style="font-size: 1.0rem;">ğŸ£</span>{% else %} {{forloop.counter}} {% endif %}</div>

        <div style="font-family: Arial; font-size:1.0rem; font-style: italic; color:var(--color-r1); text-align: right;">
        
        {% if r.r_rank %}
          
          {% if r.r_rank == 1 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main-light); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r1);">{{r.r_rank}}</span>
          {% elif r.r_rank == 2 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r2);">{{r.r_rank}}</span>
          {% elif r.r_rank == 3 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r3);">{{r.r_rank}}</span>
          {% elif r.r_rank == 4 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r4); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r4);">{{r.r_rank}}</span>
          {% elif r.r_rank == 5 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r5); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r5);">{{r.r_rank}}</span>
          {% elif r.r_rank == 6 %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r6); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r6);">{{r.r_rank}}</span>
          {% elif r.r_rank == 99 %}
          <span style="font-family: Arial; font-size:.9rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">ğŸš«</span>
          {% else %}
          <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main); text-align: right; padding:2px 4px; border-radius: 7px;">{{r.r_rank}}</span>
          {% endif %}

        {% else %}

          {% if compare_r.rating__max == r.rating and r.rating != 0 %}
          <span style="font-family: Arial; color:var(--color-light); border-radius: 10px; background-color:var(--color-r1); padding: 2px 4px; border: solid 1px var(--color-light);">{{r.rating}}</span>
          {% else %}
          <span style="font-family: Arial; color:var(--color-light-gray); border-radius: 10px; background-color:var(--color-bg); padding: 2px 4px;">{{r.rating}}</span>
          {% endif %}
          
        {% endif %}

        </div>
      </td>

      {# gate(ë§ˆë²ˆ) ë ˆì´íŒ… #}
      <td align="center" style="border-radius: 10px; border: 0.5px solid gray; font-size: 1.4rem;">
        {% if r.r_rank == 99 %}
        <span style="font-family: Arial, Helvetica, sans-serif; font-style: italic; text-decoration:line-through; color:gray;">{{r.gate}}</span>
        {% else %}
        <span style="font-family: Arial, Helvetica, sans-serif; font-style: italic; color:var(--color-light);">{{r.gate}}</span>
        {% endif %}
        
        <div style="font-family: Arial; font-size: 1.0rem; text-align: right; ">
          
          {% if request.user.username == 'admin' %}
          {% if r.m_rank %}
          
            {% if r.m_rank == 1 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main-light); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r1);">{{r.m_rank}}</span>
            {% elif r.m_rank == 2 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r2);">{{r.m_rank}}</span>
            {% elif r.m_rank == 3 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r3);">{{r.m_rank}}</span>
            {% elif r.m_rank == 4 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r4); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r4);">{{r.m_rank}}</span>
            {% elif r.m_rank == 5 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r5); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r5);">{{r.m_rank}}</span>
            {% elif r.m_rank == 6 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r6); text-align: right; padding:2px 4px; border-radius: 7px; border: 1px solid var(--color-r6);">{{r.m_rank}}</span>
            {% elif r.m_rank >= 10 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main); text-align: right; padding:1px;">{{r.m_rank}}</span>
            {% elif r.m_rank == 99 %}
            <span style="font-family: Arial; font-size:.9rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">ğŸš«</span>
            {% else %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main); text-align: right; padding:2px 4px; border-radius: 7px;">{{r.m_rank}}</span>
            {% endif %}
            
          {% endif %}

          {% if r.r_pop %}
          
            {% if r.r_pop == 1 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-main-light); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r1);">{{r.r_pop}}</span>
            {% elif r.r_pop == 2 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-bg); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r2);">{{r.r_pop}}</span>
            {% elif r.r_pop == 3 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-bg); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r3);">{{r.r_pop}}</span>
            {% elif r.r_pop == 4 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-r4); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r4);">{{r.r_pop}}</span>
            {% elif r.r_pop == 5 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-r5); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r5);">{{r.r_pop}}</span>
            {% elif r.r_pop == 6 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-r6); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r6);">{{r.r_pop}}</span>
            {% elif r.r_pop >= 10 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-main); text-align: right; padding:1px;">{{r.r_pop}}</span>
            {% elif r.r_pop == 99 %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-gray); text-align: right; padding:2px 3px; border-radius: 7px;">ğŸš«</span>
            {% else %}
            <span style="font-family: Arial; font-size:0.7rem; color:var(--color-main); text-align: right; padding:2px 3px; border-radius: 7px;">{{r.r_pop}}</span>
            {% endif %}
            
          {% endif %}
          {% endif %}

          <!-- {% if compare_r.rating__max == r.rating and r.rating != 0 %}
          <span style="font-family: Arial; color:var(--color-light); border-radius: 10px; background-color:var(--color-r1); padding: 2px 4px; border: solid 1px var(--color-light);">{{r.rating}}</span>
          {% else %}
          <span style="font-family: Arial; color:var(--color-light-gray); border-radius: 10px; background-color:var(--color-bg); padding: 2px 4px;">{{r.rating}}</span>
          {% endif %} -->
        
        </div>

      </td>

      {# ê²½ì£¼ë§ˆ ì´ë¦„ ì¶œì£¼ì£¼ê¸°, ì‚°ì§€ ì„±ë³„ ë‚˜ì´ #}
      <td>
        
        <div style="font-size: 1.3rem;">

          {% if request.user.username == 'admin' %}

            <a href="{% url 'write_significant' r.rdate r.horse %}" 
                    onclick="window.open(this.href, 'write_significant', 'top=' + window.screenTop + ', left=' + window.screen.width + ', width=500, height=570, toolbars=no, scrollbars=yes'); return false;">
              {% for hname, r_etc, r_flag, judge in r_memo %}
                {% if hname == r.horse %}

                  {% include 'base/m_memo.html' with size='1.3rem' color='var(--color-r4)' %}

                {% endif %}
              {% endfor %}
            </a>

            <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); position: relative; ">
              {% if r.s1f_rank == 3.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; background-color: var(--color-r1); color: var(--color-light); border-radius: 5px; padding: 2px 4px;">â¬†ï¸</span>
              {% elif r.s1f_rank == 2.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; border: 1px solid var(--color-r2); color: var(--color-r2); border-radius: 5px; padding: 2px 2px;">â–²</span>
              {% elif r.s1f_rank == 1.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; border: 1px solid var(--color-r3); color: var(--color-r3); border-radius: 5px; padding: 2px 3px;">â–¶ï¸</span>
              {% elif r.s1f_rank == 0.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; background-color: var(--color-light-gray); color: var(--color-dark-medium); border-radius: 5px; padding: 2px 3px;">â—¼ï¸</span>
              {% elif r.s1f_rank == -1.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; background-color: var(--color-gray); color: blue; border-radius: 5px; padding: 2px 3px;">â—€ï¸</span>
              {% elif r.s1f_rank == -2.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; background-color: var(--color-gray); color: var(--color-light); border-radius: 5px; padding: 2px 3px;">â–¼</span>
              {% elif r.s1f_rank == -3.0 %}
              <span style="font-size: 1.0rem; font-family: Arial; background-color: darkblue; color: var(--color-light-gray); border-radius: 5px; padding: 2px 4px;">â¬‡ï¸</span>
              {% else %}
              &nbsp;
              {% endif %}
              <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:33rem">
                ğŸ‘ï¸â€ğŸ—¨ï¸&nbsp;&nbsp;[{{r.gate}}ë²ˆ {{r.horse}}]<br>{{r.g2f_rank|linebreaksbr}}</span></span>
          
          {% endif %}

          <span class="tooltip" style="font-family: Arial; color:var(--color-light-gray); position: relative; ">
          {% if r.r_rank == 99 %}
            <span style="font-size: 1.25rem; font-style: italic; text-decoration:line-through; color:gray;">{{r.horse|slice:"0:6"}}</span>
          {% else %}
            {% if r.rank == 1 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r1);">{{r.horse|slice:"0:6"}}</span>
            {% elif r.rank == 2 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r2);">{{r.horse|slice:"0:6"}}</span>
            {% elif r.rank == 3 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r3);">{{r.horse|slice:"0:6"}}</span>
            {% elif r.rank == 4 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r4);">{{r.horse|slice:"0:6"}}</span>
            {% elif r.rank == 5 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r5);">{{r.horse|slice:"0:6"}}</span>
            {% elif r.rank == 6 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r6);">{{r.horse|slice:"0:6"}}</span>
            {%else%}
              {% if r.complex == r.complex5 %}
              <span style="font-size: 1.25rem; font-style: italic; color:var(--color-r6);">{{r.horse|slice:"0:6"}}</span>
                
              {% else %}
                <span style="font-size: 1.25rem; font-style: italic; color:var(--color-light-gray);">{{r.horse|slice:"0:6"}}</span>
              {% endif %}
            {%endif%}
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:45rem">
              ğŸ´&nbsp;&nbsp;{{r.comment_all|linebreaksbr}}</span></span>

        </div>

        <div align="right" style="font-size: 1.235rem; color:var(--color-gray);">

          {# ì¶œì£¼ì£¼ê¸° #}
          {% if r.r_rank == 99 %}
          <span style="font-size: 1.15rem;">&nbsp;</span>
          <span style="font-size:0.9rem; color:gray;">{% if r.reason %}{{r.reason|slice:"0:8"}}{% endif %}
          </span>
          {% else %}

            {% if r.rank >= 20 %}
            <span style="font-size: 1.15rem;">&nbsp;</span>
            {% else %}
              {% if r.i_cycle <= 16 %}
              <span style="font-family: Arial; font-size:1.15rem; color:var(--color-r1); border-radius: 10px; border: solid 1px var(--color-r1); padding:2px 4px;">{{r.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
              
              {% elif r.i_cycle >= 26 and r.i_cycle < 80 %}
              <span style="font-family: Arial; font-size:1.15rem; color:var(--color-main); border-radius: 10px; border-bottom: solid 1px var(--color-main); padding:2px 4px;">{{r.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
              {% elif r.i_cycle >= 80 %}
              <span style="font-family: Arial; font-size:1.15rem; color:var(--color-r1); border-radius: 10px; border-bottom: solid 1px var(--color-r1); padding:2px 4px;">{{r.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
              {% else %}
              <span style="font-family: Arial; font-size:1.15rem; color:var(--color-light-gray); border-radius: 10px; border-bottom: 1px solid var(--color-gray); padding:2px 4px;">{{r.i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
              {% endif %}
            {% endif %}

            {# ì¶œìƒì§€ #}
            {% if r.birthplace == 'í•œ' %}
            <span style="font-size: 1.15rem; color:var(--color-light); border-radius: 10px; background-color:var(--color-bg); padding: 0px 2px;">{{r.birthplace}}</span>
            {% elif r.birthplace == 'ë¯¸' %}
            <span style="font-size: 1.15rem; color:var(--color-main); border-radius: 10px; border: 1px solid var(--color-r1); padding: 0px 2px;">{{r.birthplace}}</span>
            {%else%}
              {% if 'í¬' in r.birthplace %}
              <span style="font-size: 1.15rem; color:var(--color-r4); border-radius: 10px; border: 1px solid var(--color-r5); padding: 0px 2px;">í¬</span>
              {% else %}
              <span style="font-size: 1.15rem; color:var(--color-r4); border-radius: 10px; background-color:var(--color-bg); padding: 0px 2px;">{{r.birthplace}}</span>
              {% endif %}
            {%endif%}
            
            {# ì„±ë³„ #}
            {% if r.h_sex == 'ì•”' %}
            <span style="font-size: 1.15rem; color:var(--color-r5); border-radius: 10px; background-color:var(--color-bg); padding: 1px 2px;">{{r.h_sex}}</span>
            {% elif r.h_sex == 'ê±°' %}
            <span style="font-size: 1.15rem; color:var(--color-r1); border-radius: 10px; background-color:var(--color-bg); padding: 1px 2px;">{{r.h_sex}}</span>
            {%else%}
            <span style="font-size: 1.15rem; color:var(--color-light-gray); border-radius: 10px; background-color:var(--color-bg); padding: 1px 2px;">{{r.h_sex}}</span>
            {%endif%}
            
            {# ë‚˜ì´ #}
            {% if r.h_age >= 5.9 %}
            <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-r1); border-radius: 10px; background-color:var(--color-bg); padding:1px 3px">{{r.h_age}}</span>
            {% elif r.h_age < 3 %}
            <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-r2); border-radius: 10px; background-color:var(--color-bg); padding:1px 3px">{{r.h_age}}</span>
            {%else%}
            <span style="font-family: Arial; font-size: 1.1rem; font-style: italic; color:var(--color-gray); border-radius: 10px; background-color:var(--color-bg); padding:1px 3px">{{r.h_age}}</span>
            {%endif%}

          {% endif %}

          {% if request.user.username == 'admin' %}
            
            {% if r.bet == '0' %}
              <span style="font-family: Arial; color: var(--color-bg); font-size: 1.0rem;">&nbsp;</span>
            {% elif r.bet == '1' %}
              <span style="font-family: Arial; color: var(--color-r1); font-size: 1.0rem; border: 1px solid var(--color-r1); padding: 2px 4px; border-radius: 50%;">{{r.bet}}</span>
            {% elif r.bet == '2' %}
              <span style="font-family: Arial; color: var(--color-r2); font-size: 1.0rem; border: 1px solid var(--color-r2); padding: 2px 4px; border-radius: 50%;">{{r.bet}}</span>
            {% elif r.bet == '3' %}
              <span style="font-family: Arial; color: var(--color-r3); font-size: 1.0rem; border: 1px solid var(--color-r3); padding: 2px 4px; border-radius: 50%;">{{r.bet}}</span>
            {% elif r.bet == '4' %}
              <span style="font-family: Arial; color: var(--color-r4); font-size: 1.0rem; border: 1px solid var(--color-r4); padding: 2px 4px; border-radius: 50%;">{{r.bet}}</span>
            {% elif r.bet == '5' %}
              <span style="font-family: Arial; color: var(--color-r5); font-size: 1.0rem; border: 1px solid var(--color-r5); padding: 2px 4px; border-radius: 50%;">{{r.bet}}</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray); font-size: 1.0rem; background-color: var(--color-bg); padding: 2px 4px; border-radius: 50%; border: 1px solid gray">{{r.bet}}</span>
            {% endif %}
            
          {% endif %}
        
        </div>
        
      </td>

      {# ë§ˆì²´ì¤‘ #}
      <td style="font-family: Arial; font-size: 1.2rem;">
        
        <div style="text-align:center">

          {# ê²½ì£¼ë§ˆ ì²´ì¤‘ ì¦ê° #}

            {% if r.h_weight|slice:"0:3" <= '440' %}
            <span style="padding:2px 2px; font-family: Arial; color:var(--color-r5);">{{r.h_weight|slice:"0:3"}}<sup style="font-size: 0.7rem; font-style: italic;">ã</sup></span>
            {% elif r.h_weight|slice:"0:3" >= '500' %}
            <span style="padding:2px 2px; font-family: Arial; color:var(--color-r2);">{{r.h_weight|slice:"0:3"}}<sup style="font-size: 0.7rem; font-style: italic;">ã</sup></span>
            {% else %}
            <span style="padding:2px 2px; font-family: Arial; color:var(--color-light-gray);">{{r.h_weight|slice:"0:3"}}<sup style="font-size: 0.7rem; font-style: italic;">ã</sup></span>
            {% endif %}
          
        </div>

        {% if r.h_weight|slice:"4:" %}
          {% if r.h_weight|slice:"4:5" == '+' %}
          <div style="text-align:right; font-style: italic; font-size: 1.1rem;  color:var(--color-r1);">
            <span style="font-family: Arial; border-radius: 7px; background-color: var(--color-bg); padding:1px 4px;">{{r.h_weight|slice:"4:"}}</span>
          </div>
          {% else %}
          <div style="text-align:right; font-style: italic; font-size: 1.1rem;  color:var(--color-r5);">
            <span style="font-family: Arial; border-radius: 7px; background-color: var(--color-bg); padding:1px 4px;">{{r.h_weight|slice:"4:"}}</span>
          </div>
          {% endif %}
        {% endif %}

      </td>

      {# ë¶€ë‹´ì¤‘ëŸ‰ #}
      <td style="font-family: Arial; font-size: 1.2rem;">

        <div align="center" style="font-size:1.2rem;">
          {# ë¶€ë‹´ì¤‘ëŸ‰ #}
          {% if r.handycap == compare_r.handycap__max %}
          <span style="padding:2px 2px; font-family: Arial; color:var(--color-r1);">{{r.handycap}}</span>
          {% else %}
            {% for jname, load_in, tot_1st in loadin %}
            {% if jname == r.jockey %}
              {% if r.handycap|mul:1|floatformat:0 <= load_in|mul:1|floatformat:0 %}
              <span style="padding:2px 2px; font-family: Arial; font-style:italic; font-size:1.1rem; color:var(--color-r3); border-radius:7px; background-color:var(--color-bg);">{{r.handycap}}</span>
              {% elif r.handycap|mul:1|floatformat:0 <= load_in|mul:1|add:1|floatformat:0 %}
              <span style="padding:2px 2px; font-family: Arial; font-style:italic; font-size:1.1rem; color:var(--color-light-gray); border-radius:7px; background-color:var(--color-bg);">{{r.handycap}}</span>
              {% else %}
              <span style="padding:2px 2px; font-family: Arial; color:var(--color-light-gray);">{{r.handycap}}</span>
              {% endif %}
            {% endif %}
            {% endfor %}
          {% endif %}
        </div>

        <div style="text-align: right; font-size: 1.2rem;">
          {# ë¶€ë‹´ì¤‘ëŸ‰ ì¦ê° #}
          {% if r.i_prehandy == 0.0 %}
            <span style="font-family: Arial; font-style: italic; font-size: 1.0rem; color: var(--color-gray); text-align: right;">ì‹ ë§ˆ</span>
          {% else %}
            {% if r.handycap|sub:r.i_prehandy == 0 %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-gray); text-align: right;">&nbsp;</span>
            {% elif r.handycap|sub:r.i_prehandy > 0 and r.handycap|sub:r.i_prehandy <= 1 %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-r2); text-align: right;">+{{r.handycap|sub:r.i_prehandy}}</span>
            {% elif r.handycap|sub:r.i_prehandy < 0 and r.handycap|sub:r.i_prehandy >= -1 %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-r4); text-align: right;">{{r.handycap|sub:r.i_prehandy}}</span>
            {% elif r.handycap|sub:r.i_prehandy > 1 %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-r1); text-align: right; padding:2px; border-radius: 7px; background-color: var(--color-bg);">+{{r.handycap|sub:r.i_prehandy}}</span>
            {% elif r.handycap|sub:r.i_prehandy < -1 %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-r5); text-align: right; padding:2px; border-radius: 7px; background-color: var(--color-bg);">{{r.handycap|sub:r.i_prehandy}}</span>
            {% else %}
              <span style="font-family: Arial; font-style: italic; font-size: 1.1rem; color: var(--color-r5); text-align: right;">{{r.handycap|sub:r.i_prehandy}}</span>
            
            {% endif %}
          {% endif %}
        </div>
        
      </td>

      {# ê¸°ìˆ˜ ì¡°êµì‚¬ #}
      <td align="center">
        <div style="font-size: 1.2rem; text-align: left; ">
          <a href="{% url 'jt_analysis_multi' r.rcity r.rdate|mul:1|sub:10000 r.rdate r.jockey '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            <span style="color:var(--color-r2); font-size:0.9rem">
            </span>
            {% if r.jockey_old %}   {# ê¸°ìˆ˜ë³€ê²½ #}
              <span class="tooltip" style="font-style: italic; color:var(--color-r2); border-bottom:1px solid var(--color-gray);">{{r.jockey|slice:"0:3"}}
                <span class="tooltip-text" style="z-index: 9;">
                  ğŸ´ ë³€ê²½ì‚¬ìœ  : {{r.reason}}{% if r.jockey_old %}
                  <br>
                  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ë³€ê²½ì „ ê¸°ìˆ˜ : <span style="color:var(--color-r2); background-color:var(--color-light); border-radius: 7px; padding: 2px 4px;">{{r.jockey_old}}</span>{% endif %}
                  
                </span>
              </span>
              
            {% else %}
              <span style="color:var(--color-light-gray); border-bottom:1px solid var(--color-gray);">{{r.jockey|slice:"0:3"}}</span>
            {%endif %}

            {% for jockey, cnt in training_cnt %}
              {% if r.jockey == jockey %}
                {% if cnt|mul:1 <= 4 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-light); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-bg);">{{cnt}}</span>
                {% elif cnt|mul:1 == 5 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-light); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r5);">{{cnt}}</span>
                {% elif cnt|mul:1 == 6 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-bg); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r4);">{{cnt}}</span>
                {% elif cnt|mul:1 == 7 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-bg); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r3);">{{cnt}}</span>
                {% elif cnt|mul:1 == 8 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-bg); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r2);">{{cnt}}</span>
                {% elif cnt|mul:1 == 9 %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-bg); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r2);">{{cnt}}</span>
                {% elif cnt|mul:1 >= 10 %}
                <span style="font-family: Arial; font-size: 1.0rem; text-align: right; color:var(--color-light); border-radius: 10px; border: 1px solid var(--color-light); padding:2px 2px; background-color: var(--color-r1);">{{cnt}}</span>
                {% else %}
                <span style="font-family: Arial; font-size: 1.1rem; text-align: right; color:var(--color-light); border-radius: 10px; border: 1px solid var(--color-light); padding:1px 4px; background-color: var(--color-r1);">{{cnt}}</span>
                {% endif %}
              {% endif %}
            {% endfor %}
          </a>
          
        </div>
        
        {% if r.trainer in trainer_double_check %}
        <div style="font-size: 1.2rem; text-align: right;">
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
          {% for hname, max_date, cnt in disease %}
            {% if r.horse == hname %}
              {% if cnt >= 10 %}
              <span style="font-family: Arial; font-size: 0.9rem; border-radius: 10px; background-color: var(--color-bg); padding:1px 2px; color:var(--color-r5); border: 1px solid var(--color-r5);">{{cnt}}</span>
              {% else %}
              <span style="font-family: Arial; font-size: 1.1rem; border-radius: 10px; background-color: var(--color-bg); padding:1px 4px; color:var(--color-r5); border: 1px solid var(--color-r5);">{{cnt}}</span>
              {% endif %}
            {% endif %}
          {% endfor %}  
          
          <span style="color:var(--color-r3); border-bottom:1px solid var(--color-gray);">{{r.trainer}}</span>
          </a>
        </div>
        {% else %}
        <div style="font-size: 1.2rem; text-align: right;">
          <a href="{% url 'jt_analysis_multi' r.rno r.rdate|mul:1|sub:10000 r.rdate '%' r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' r.rno '%' %}" onclick="window.open(this.href, 'w_jt_analysis_multi', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
          {% for hname, max_date, cnt in disease %}
            {% if r.horse == hname %}
              {% if cnt >= 10 %}
              <span style="font-family: Arial; font-size: 0.9rem; border-radius: 10px; background-color: var(--color-bg); padding:1px 2px; color:var(--color-r5); border: 1px solid var(--color-r5);">{{cnt}}</span>
              {% else %}
              <span style="font-family: Arial; font-size: 1.1rem; border-radius: 10px; background-color: var(--color-bg); padding:1px 4px; color:var(--color-r5); border: 1px solid var(--color-r5);">{{cnt}}</span>
              {% endif %}
            {% endif %}
          {% endfor %}  
          <span style="color:var(--color-gray); border-bottom:1px solid var(--color-gray);">{{r.trainer}}</span>
          </a>
        </div>
        {% endif %}
        
      </td>

      {# ë³µìŠ¹ë¥  #}
      <td align="right" style="font-size: 1.2rem ">

        <a href="{% url 'jt_collaboration' r.rcity r.rdate r.rno r.jockey 'jockey' %}" 
              onclick="window.open(this.href, 'w_jt_collaboration', 'top=' + (window.screen.availHeight / 2 ) + ', left=' + window.screenX + ', width=550, height=300, toolbars=no, scrollbars=yes'); return false;">
        {% if r.jockey_old %}
        <div style="font-family: Arial; font-size: 1.2rem; color:var(--color-r1); text-decoration:line-through;">{{r.j_per}}</div>
        {% else %}
          {% if r.j_per %}
            {% if compare_r.j_per__max == r.j_per %}
            <div style="font-family: Arial; font-size: 1.2rem; color:var(--color-r1); border-bottom:1px solid var(--color-gray);">{{r.j_per}}</div>
            {%else%}
            <div style="font-family: Arial; font-size: 1.2rem; color:var(--color-light-gray); border-bottom:1px solid var(--color-gray);">{{r.j_per}}</div>
            {%endif%}
          {% endif %}
        {% endif %}
        </a>

        
        {% if r.t_per %}
          {% if compare_r.t_per__max == r.t_per %}
          <div style="color:var(--color-r1); font-family: Arial; font-size: 1.2rem;">
            <a href="{% url 'jt_collaboration' r.rcity r.rdate r.rno r.trainer 'trainer' %}" 
              onclick="window.open(this.href, 'w_jt_collaboration', 'top=' + (window.screen.availHeight / 2 ) + ', left=' + window.screenX + ', width=550, height=300, toolbars=no, scrollbars=yes'); return false;">
              <span style="color:var(--color-r1); font-family: Arial; font-size: 1.2rem; border-bottom:1px solid var(--color-gray);">{{r.t_per}}</span>
            </a>
          </div>
          {%else%}
          <div style="color: var(--color-gray); font-family: Arial; font-size: 1.2rem;">
            <a href="{% url 'jt_collaboration' r.rcity r.rdate r.rno r.trainer 'trainer' %}" 
              onclick="window.open(this.href, 'w_jt_collaboration', 'top=' + (window.screen.availHeight / 2 ) + ', left=' + window.screenX + ', width=550, height=300, toolbars=no, scrollbars=yes'); return false;">
              <div style="color: var(--color-gray); font-family: Arial; font-size: 1.2rem; border-bottom:1px solid var(--color-gray);">{{r.t_per}}</div>
            </a>
          </div>
          {%endif%}
        {% endif %}
        
      </td>

      {# ê¸°ìˆ˜ ì¡°êµì‚¬ ì—°ëŒ€ìœ¨ #}
      {# url "jt_analysis" '%' r_condition.rdate|mul:1|sub:10000 r_condition.rdate r.jockey r.trainer '%' '%' '1' '99' '1' '99' '0' '0' '0' as url_path #}
      <td align="right">

        {% if r.jockey_old %}
          {# ê¸°ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ê¸°ì¡´ ê¸°ìˆ˜ì˜ ê¸°ë¡ì„ ì‚­ì œ #}
          {% if r.jt_cnt > 0 %}
          <div class="tooltip" style="font-size: 1.2rem; font-weight: normal;">
            {% if r.jt_per == 100.0 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r1); text-decoration: line-through;">{{r.jt_per|floatformat:0}}</span> 
            {% elif r.jt_per >= 50 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r1); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% elif r.jt_per >= 40 and r.jt_per < 50 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r2); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% elif r.jt_per >= 30 and r.jt_per < 40 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r3); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% elif r.jt_per >= 20 and r.jt_per < 30 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r4); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% elif r.jt_per >= 10 and r.jt_per < 20 %} 
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r5); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% else %}
            <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-gray); text-decoration: line-through;">{{r.jt_per|floatformat:1}}</span>
            {% endif %}

            <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
              <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp;ë³€ê²½ì „ {{r.jockey_old}}&nbsp;ï¹†&nbsp;{{r.trainer}}</div>
              <hr>
              
              <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ê²½ì£¼ì¼ ê¸°ì¤€ ìµœê·¼ 1ë…„ê°„ ê²½ì£¼ì„±ì  : 

                {% if r.jt_cnt %}
                <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{r.jt_cnt}}</span>
                <span style="font-family: Arial; color:var(--color-r3)">{{r.jt_1st}}</span>
                <span style="font-family: Arial; color:var(--color-r4)">{{r.jt_2nd|sub:r.jt_1st}}</span>
                <span style="font-family: Arial; color:var(--color-r5)">{{r.jt_3rd|sub:r.jt_2nd}}</span>
                {% else %}
                <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                <span style="font-family: Arial; color:var(--color-r3)">0</span>
                <span style="font-family: Arial; color:var(--color-r4)">0</span>
                <span style="font-family: Arial; color:var(--color-r5)">0</span>
                {% endif %}
              </div>
              <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                {% if r.jt_cnt > 0 %}
                <span style="font-family: Arial; color: var(--color-r2);">{{r.jt_2nd|mul:100|div:r.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                {% else %}
                <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                {% endif %}
              </div>
              <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                {% if r.jt_cnt > 0 %}
                <span style="font-family: Arial; color: var(--color-r1);">{{r.jt_3rd|mul:100|div:r.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                {% else %}
                <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                {% endif %}
              </div>
            </span>
          </div>
          {% else %}
          <div class="tooltip" style="font-size: 1.0rem; font-weight: normal;">ğŸš«</div>
          {% endif %}

        {% else %}
          {% if r.jt_cnt %}
            <div class="tooltip" style="font-size: 1.2rem; font-weight: normal;">
              {% if r.jt_per == 100.0 %} 
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r1); background-color: var(--color-bg); padding: 2px 4px; border-radius: 5px;">{{r.jt_per|floatformat:0}}</span> 
                {% elif r.jt_per >= 50 %} 
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r1); background-color: var(--color-bg); padding: 2px 4px; border-radius: 5px;">{{r.jt_per|floatformat:1}}</span>
                {% elif r.jt_per >= 40 and r.jt_per < 50 %} 
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r2); background-color: var(--color-bg); padding: 2px 4px; border-radius: 5px;">{{r.jt_per|floatformat:1}}</span>
                {% elif r.jt_per >= 30 and r.jt_per < 40 %} 
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r3); background-color: var(--color-bg); padding: 2px 4px; border-radius: 5px;">{{r.jt_per|floatformat:1}}</span>
                {% elif r.jt_per >= 20 and r.jt_per < 30 %} 
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-r4);">{{r.jt_per|floatformat:1}}</span>
                
                {% else %}
                <span style="font-family: Arial, Helvetica, sans-serif; color:var(--color-gray);">{{r.jt_per|floatformat:1}}</span>
                {% endif %}

                <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
                  <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp; {{r.jockey}}&nbsp;ï¹†&nbsp;{{r.trainer}}</div>
                  <hr>

                  <div style="text-align: left; ">
                    <span style="font-family: Arial; color:var(--color-light-gray);">chatGPT J&T Score :</span>
                    <span style="font-family: Arial; color:var(--color-light); background-color: var(--color-r1); border-radius: 5px; padding: 2px 4px;">{{r.jt_score}}</span>
                  </div>

                  <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ìµœê·¼ 1ë…„ê°„ ê²½ì£¼ì„±ì  : 

                    {% if r.jt_cnt %}
                    <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{r.jt_cnt}}</span>
                    <span style="font-family: Arial; color:var(--color-r3)">{{r.jt_1st}}</span>
                    <span style="font-family: Arial; color:var(--color-r4)">{{r.jt_2nd|sub:r.jt_1st}}</span>
                    <span style="font-family: Arial; color:var(--color-r5)">{{r.jt_3rd|sub:r.jt_2nd}}</span>
                    {% else %}
                    <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                    <span style="font-family: Arial; color:var(--color-r3)">0</span>
                    <span style="font-family: Arial; color:var(--color-r4)">0</span>
                    <span style="font-family: Arial; color:var(--color-r5)">0</span>
                    {% endif %}
                  </div>
                  <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                    2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if r.jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-r2);">{{r.jt_2nd|mul:100|div:r.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                  </div>
                  <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                    3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if r.jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-r1);">{{r.jt_3rd|mul:100|div:r.jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                  </div>
                </span>
            </div>
            {% else %}
          <div class="tooltip" style="font-size: 1.0rem; font-weight: normal;">ğŸš«
            <span class="tooltip-text" style="font-family: Arial, Helvetica, sans-serif; color:var(--color-gray);">{{r.jt_per|floatformat:1}}</span>
          </div>
            
          {% endif %}
        
        {% endif %}
        
          
        {# ì„ í–‰ì‹œ ì—°ëŒ€ìœ¨ #}
        <div  style="text-align:right; font-size:1.0rem; ">
          <span class="tooltip" style="font-weight: normal;">
          {% if r.jt_score == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.jt_score|floatformat:0}}</span>
          {% elif r.jt_score >= 90.0 and r.jt_score < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.jt_score|floatformat:1}}</span>
          {% elif r.jt_score >= 80.0 and r.jt_score < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.jt_score|floatformat:1}}</span>
          {% elif r.jt_score >= 70 and r.jt_score < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.jt_score|floatformat:1}}</span>
          {% elif r.jt_score >= 60 and r.jt_score < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.jt_score|floatformat:1}}</span>
          {% elif r.jt_score >= 50 and r.jt_score < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.jt_score|floatformat:1}}</span>
          {% elif r.jt_score == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.jt_score|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.jt_score|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
            â†ªï¸&nbsp;&nbsp;ê¸°ìˆ˜ & ë§ˆë°© ì—°ëŒ€ì ìˆ˜: {{r.jt_score}}</span></span>
        </div>
  
      </td>

      <td align="right" style="vertical-align: middle;">
        <div style="text-align:right; font-size:1.1rem; padding-top: 2.5px;">
          <span class="tooltip" style="font-weight: normal;">
          {% if r.rec_per == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.rec_per|floatformat:0}}</span>
          {% elif r.rec_per >= 90.0 and r.rec_per < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.rec_per|floatformat:1}}</span>
          {% elif r.rec_per >= 80.0 and r.rec_per < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.rec_per|floatformat:1}}</span>
          {% elif r.rec_per >= 70 and r.rec_per < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.rec_per|floatformat:1}}</span>
          {% elif r.rec_per >= 60 and r.rec_per < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.rec_per|floatformat:1}}</span>
          {% elif r.rec_per >= 50 and r.rec_per < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.rec_per|floatformat:1}}</span>
          {% elif r.rec_per == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.rec_per|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.rec_per|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ìµœê·¼ Form ì ìˆ˜: {{r.rec_per|floatformat:1}}</span></span>
        </div>
        <div style="text-align:right; font-size:1.1rem;">
          <span class="tooltip" style="font-weight: normal; padding-top: 1px;">
          {% if r.rec8_trend == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.rec8_trend|floatformat:0}}</span>
          {% elif r.rec8_trend >= 90.0 and r.rec8_trend < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.rec8_trend|floatformat:1}}</span>
          {% elif r.rec8_trend >= 80.0 and r.rec8_trend < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.rec8_trend|floatformat:1}}</span>
          {% elif r.rec8_trend >= 70 and r.rec8_trend < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.rec8_trend|floatformat:1}}</span>
          {% elif r.rec8_trend >= 60 and r.rec8_trend < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.rec8_trend|floatformat:1}}</span>
          {% elif r.rec8_trend >= 50 and r.rec8_trend < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.rec8_trend|floatformat:1}}</span>
          {% elif r.rec8_trend == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.rec8_trend|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.rec8_trend|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ìµœê·¼ 8ê²½ì£¼ íŠ¸ë Œë“œ ì ìˆ˜: {{r.rec8_trend|floatformat:1}}</span></span>
        </div>
      </td>
      
      {# ê²½ì£¼ì „ê°œ furlong ê¸°ë¡ #}
      <td align="center" style="font-size: 1.25rem;">
        {% if r.cs1f %}
        {% if compare_r.i_s1f__min == r.i_s1f %}
        <span style="font-family: Arial; color:var(--color-r1); background-color: var(--color-bg); padding: 2px 4px; border-radius: 7px;">{{r.cs1f}}</span>
        {% elif r.i_s1f|sub:7 < compare_r.i_s1f__min %}
        <span style="font-family: Arial; color:var(--color-r2); padding: 2px 4px;">{{r.cs1f}}</span>
        {% else %}
        <span style="font-family: Arial; color:var(--color-light-gray); padding: 2px 4px;">{{r.cs1f}}</span>
        {% endif %}
        {% endif %}
        
        <div  style="text-align:right; font-size:1.0rem; ">
          <span class="tooltip" style="font-weight: normal;">
          {% if r.s1f_per == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.s1f_per|floatformat:0}}</span>
          {% elif r.s1f_per >= 90.0 and r.s1f_per < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.s1f_per|floatformat:1}}</span>
          {% elif r.s1f_per >= 80.0 and r.s1f_per < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.s1f_per|floatformat:1}}</span>
          {% elif r.s1f_per >= 70 and r.s1f_per < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.s1f_per|floatformat:1}}</span>
          {% elif r.s1f_per >= 60 and r.s1f_per < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.s1f_per|floatformat:1}}</span>
          {% elif r.s1f_per >= 50 and r.s1f_per < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.s1f_per|floatformat:1}}</span>
          {% elif r.s1f_per == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.s1f_per|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.s1f_per|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{r.s1f_per|floatformat:1}}</span></span>
        </div>

      </td>
      <td align="center" style="font-size: 1.25rem;">
        {% if r.cg3f %}
        {% if compare_r.i_g3f__min == r.i_g3f %}
        <span style="font-family: Arial; color:var(--color-r1); background-color: var(--color-bg); padding: 2px 4px; border-radius: 7px;">{{r.cg3f}}</span>
        {% elif r.i_g3f|sub:7 < compare_r.i_g3f__min %}
        <span style="font-family: Arial; color:var(--color-r2); padding: 2px 4px;">{{r.cg3f}}</span>
        {% else %}
        <span style="font-family: Arial; color:var(--color-light-gray); padding: 2px 4px;">{{r.cg3f}}</span>
        {% endif %}
        {% endif %}
        
        <div  style="text-align:right; font-size:1.0rem; ">
          <span class="tooltip" style="font-weight: normal;">
          {% if r.g3f_per == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.g3f_per|floatformat:0}}</span>
          {% elif r.g3f_per >= 90.0 and r.g3f_per < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.g3f_per|floatformat:1}}</span>
          {% elif r.g3f_per >= 80.0 and r.g3f_per < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.g3f_per|floatformat:1}}</span>
          {% elif r.g3f_per >= 70 and r.g3f_per < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.g3f_per|floatformat:1}}</span>
          {% elif r.g3f_per >= 60 and r.g3f_per < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.g3f_per|floatformat:1}}</span>
          {% elif r.g3f_per >= 50 and r.g3f_per < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.g3f_per|floatformat:1}}</span>
          {% elif r.g3f_per == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.g3f_per|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.g3f_per|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ì¢…ë°˜ 600m ì ìˆ˜: {{r.g3f_per|floatformat:1}}</span></span>
        </div>

      </td>

      <td align="center" style="font-size: 1.25rem;">
        {% if r.cg1f %}
        {% if compare_r.i_g1f__min == r.i_g1f %}
        <span style="font-family: Arial; color:var(--color-r1); background-color: var(--color-bg); padding: 2px 4px; border-radius: 7px;">{{r.cg1f}}</span>
        {% elif r.i_g1f|sub:7 < compare_r.i_g1f__min %}
        <span style="font-family: Arial; color:var(--color-r2); padding: 2px 4px;">{{r.cg1f}}</span>
        {% else %}
        <span style="font-family: Arial; color:var(--color-light-gray); padding: 2px 4px;">{{r.cg1f}}</span>
        {% endif %}
        {% endif %}

        <div  style="text-align:right; font-size:1.0rem; ">
          <span class="tooltip" style="font-weight: normal;">
          {% if r.g1f_per == 100 %}
          <span style="font-family: Arial; color: var(--color-r1); font-weight: bold;">{{r.g1f_per|floatformat:0}}</span>
          {% elif r.g1f_per >= 90.0 and r.g1f_per < 100 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.g1f_per|floatformat:1}}</span>
          {% elif r.g1f_per >= 80.0 and r.g1f_per < 90 %}
          <span style="font-family: Arial; color: var(--color-r2);">{{r.g1f_per|floatformat:1}}</span>
          {% elif r.g1f_per >= 70 and r.g1f_per < 80 %}
          <span style="font-family: Arial; color: var(--color-r3);">{{r.g1f_per|floatformat:1}}</span>
          {% elif r.g1f_per >= 60 and r.g1f_per < 70 %}
          <span style="font-family: Arial; color: var(--color-r4);">{{r.g1f_per|floatformat:1}}</span>
          {% elif r.g1f_per >= 50 and r.g1f_per < 60 %}
          <span style="font-family: Arial; color: var(--color-r5);">{{r.g1f_per|floatformat:1}}</span>
          {% elif r.g1f_per == 0 %}
          <span style="font-family: Arial; color: var(--color-r1);">{{r.g1f_per|floatformat:1}}</span>
          {% else %}
          <span style="font-family: Arial; color: var(--color-gray);">{{r.g1f_per|floatformat:1}}</span>
          {% endif %}
          <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
              â†ªï¸&nbsp;&nbsp;ì¢…ë°˜ 200m ì ìˆ˜: {{r.g1f_per|floatformat:1}}</span></span>
        </div>

        
      </td>
      
      {# í”„ë¡œê·¸ë¨ ì˜ˆìƒê¸°ë¡ #}
      <!-- <td align="center" style="border-right: 0.2px solid var(--color-dark);"> -->
      <td align="center" style="border-radius: 10px; border: 0.5px solid gray;">
        
        <div style="font-size: 1.0rem; color:var(--color-light-gray); text-align: right;">
          
          {% if view_type == '1' %}
          <a href="{% url 'race_axis' r.rcity r.rdate r.rno r.jockey %}"
              onclick="window.open(this.href, 'w_race_axis', 'top=100, left=900, width=500, height=720, toolbars=no, scrollbars=yes'); return false;">
            {% if r.rank == 1 %}
            <span class="visible-big" style="text-transform:capitalize; font-style: italic; font-size:0.9rem; padding:1px 4px; border-radius: 7px;">ğŸ“Œ</span>
            {% else %}
            
              {% if r.gap %}
              {% if r.gap == 0 %}
              <span style="font-family: Arial; padding: 2px 4px;">ğŸ’¥</span>
              {% elif r.gap > 0 and r.gap <= 2 %}
              <span style="font-family: Arial; border-radius: 5px; background-color: rgb(125,0,0); padding: 2px 5px; border-radius: 7px; color: var(--color-light);">{{r.gap}}</span>
              {% elif r.gap > 2 and r.gap < 10 %}
              <span style="font-family: Arial; border-radius: 5px; background-color: darkblue; padding: 2px 5px; border-radius: 7px; color: var(--color-light);">{{r.gap}}</span>
              {% else %}
              <span style="font-family: Arial; border-radius: 5px; background-color: var(--color-bg); padding: 2px 4px; border-radius: 7px;">{{r.gap}}</span>
              {% endif %}
              {% else %}
              <span style="font-family: Arial; padding: 2px 4px;">ğŸ’¥</span>
              {% endif %}

            </span>
            {% endif %}
          
          </a>
          {% endif %}
          <!-- <span style="font-family: Arial; font-style: italic; font-size:1.0rem; padding:1px 4px; border-radius: 7px;">{{r.tot_score|floatformat:0}}</span> -->

          {% if r.m_rank %}
            <span class="tooltip" style="font-weight: normal;">
            {% if r.m_rank == 1 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main-light); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r1);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 2 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r2);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 3 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-bg); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-light); background-color: var(--color-r3);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 4 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r4); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r4);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 5 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r5); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r5);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 6 %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-r6); text-align: right; padding:2px 3px; border-radius: 7px; border: 1px solid var(--color-r6);">{{r.m_score|mul:100|floatformat:0}}</span>
            {% elif r.m_rank == 99 %}
            <span style="font-family: Arial; font-size:.9rem; color:var(--color-gray); text-align: right; padding:2px 3px; border-radius: 7px;">ğŸš«</span>
            {% else %}
            <span style="font-family: Arial; font-size:1.0rem; color:var(--color-main); text-align: right; padding:2px 3px; border-radius: 7px;">{{r.m_score|mul:100|floatformat:0}}</span>
            {% endif %}
              <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:25rem">ğŸ“<br>LGBM rank : {{r.m_rank}}<br>LGBM score : {{r.m_score|mul:100|floatformat:1}}<br>{{r.comment_dh}}</span></span>
            
            
          {% endif %}

            
        </div>

        <div style=" font-size: 1.25rem;  ">
          {% if r.rank == 1 %}
          <span style="color:var(--color-r1); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% elif r.rank == 2 %}
          <span style="color:var(--color-r2); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% elif r.rank == 3 %}
          <span style="color:var(--color-r3); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% elif r.rank == 4 %}
          <span style="color:var(--color-r4); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% elif r.rank == 5 %}
          <span style="color:var(--color-r5); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% elif r.rank == 6 %}
          <span style="color:var(--color-r6); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
          {% else %}
            {% if r.complex == r.complex5 %}
              <span style="color:var(--color-r5); font-family: Arial; font-style: italic;">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
            {% else %}
              <span style="font-family: Arial; color: var(--color-light-gray);">{{r.complex|slice:"0:1"}}&nbsp;{{r.complex|slice:"1:6"}}</span>
            {% endif %}
          {% endif %}

          {% if r.dh_score <= 1.0 %}
            {% elif r.dh_score > 1.0 and r.dh_score < 2.9 %}
            {% elif r.dh_score > 3.0 and r.dh_score < 5.9 %}
            <span class="tooltip" style="font-size: 0.9rem;">ğŸ§¨
              <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:20rem">
                ğŸ§¨&nbsp;&nbsp;í¬ì¸íŠ¸: {{r.dh_score}}<br>{{r.comment_dh|linebreaksbr}}</span></span>
            {% elif r.dh_score > 5.9 %}
            <span class="tooltip" style="font-size: 0.9rem;">ğŸ”¥
              <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:20rem">
                ğŸ”¥&nbsp;&nbsp;í¬ì¸íŠ¸: {{r.dh_score}}<br>{{r.comment_dh|linebreaksbr}}</span></span>
            {% endif %}
          
        </div>
        
        
      </td>
      
      {# ìµœê·¼ ê¸°ë¡ #}
      <td align="center">
        <div style=" font-size: 1.2rem;">
          
          {% if compare_r.recent3__min == r.recent3 %}
          <span style="font-family: Arial; color: var(--color-r1); font-style: italic;">{{r.recent3|slice:"0:1"}}&nbsp;{{r.recent3|slice:"1:6"}}&nbsp;&nbsp;</span>
          {% else %}

            {% if r.recent3 < r.complex5 %}
            <span style="font-family: Arial; color: var(--color-r3); font-style: italic;">{{r.recent3|slice:"0:1"}}&nbsp;{{r.recent3|slice:"1:6"}}&nbsp;&nbsp;</span>
            {% else %}
              {% if r.recent3 < r.convert_r and r.recent3 < r.recent5 %}
              <span style="font-family: Arial; color: var(--color-light);">{{r.recent3|slice:"0:1"}}&nbsp;{{r.recent3|slice:"1:6"}}&nbsp;&nbsp;</span>
              {% else %}
              <span style="font-family: Arial; color: var(--color-gray);">{{r.recent3|slice:"0:1"}}&nbsp;{{r.recent3|slice:"1:6"}}&nbsp;&nbsp;</span>
              {% endif %}
            {% endif %}
          {% endif %}
          
        </div>
        <div style="font-size: 1.2rem; text-align: right;"> 
          
          
          {% if compare_r.recent5__min == r.recent5 %}
          <span style="font-family: Arial; color: var(--color-r1); font-style: italic;">{{r.recent5|slice:"0:1"}}&nbsp;{{r.recent5|slice:"1:6"}}</span>
          {% else %}
            {% if r.recent5 < r.complex5 %}
            <span style="font-family: Arial; color: var(--color-r3); font-style: italic;">{{r.recent5|slice:"0:1"}}&nbsp;{{r.recent5|slice:"1:6"}}</span>
            {% else %}
              {% if r.recent5 < r.convert_r and r.recent5 < r.recent3 %}
              <span style="font-family: Arial; color: var(--color-light);">{{r.recent5|slice:"0:1"}}&nbsp;{{r.recent5|slice:"1:6"}}</span>
              {% else %}
              <span style="font-family: Arial; color: var(--color-gray);">{{r.recent5|slice:"0:1"}}&nbsp;{{r.recent5|slice:"1:6"}}</span>
              {% endif %}
            {% endif %}
          {% endif %}
        </div>

      </td>

      {# í™˜ì‚°ê¸°ë¡ / ê²½ì£¼ê¸°ë¡ #}
      <td>
        <div style=" font-size: 1.2rem; text-align: center;">
          {% if compare_r.convert_r__min == r.convert_r %}
          <span style="font-family: Arial; color: var(--color-r1); font-style: italic;">{{r.convert_r|slice:"0:1"}}&nbsp;{{r.convert_r|slice:"1:6"}}</span>
          {% else %}

            {% if r.convert_r < r.complex5 %}
            <span style="font-family: Arial; color:var(--color-r3); font-style: italic;">{{r.convert_r|slice:"0:1"}}&nbsp;{{r.convert_r|slice:"1:6"}}</span>
            {% else %}
              {% if r.convert_r < r.recent5 and r.convert_r < r.recent3 %}
              <span style="font-family: Arial; color: var(--color-light-gray);">{{r.convert_r|slice:"0:1"}}&nbsp;{{r.convert_r|slice:"1:6"}}</span>
              {% else %}
              <span style="font-family: Arial; color: var(--color-gray);">{{r.convert_r|slice:"0:1"}}&nbsp;{{r.convert_r|slice:"1:6"}}</span>
              {% endif %}
            {% endif %}
          {% endif %}
        </div>

        <div style="text-align:left; font-size:0.9rem; text-align: right; padding-top:4px;">
          
          {% for hname, cnt in recovery_cnt %}
            {% if r.horse == hname %}
            <span style="font-family: Arial; color:var(--color-r1); border-radius: 7px; background-color: var(--color-bg); padding:1px 3px; border: 1px solid var(--color-r1);">{{cnt}}</span>
            {% endif %}
          {% endfor %}  

          {% for hname, cnt in audit_cnt %}
            {% if r.horse == hname %}
            <span style="font-family: Arial; color:var(--color-r4); border-radius: 7px; background-color: var(--color-bg); padding:1px 3px; border: 1px solid var(--color-r4);">{{cnt}}</span>
            {% endif %}
          {% endfor %}  

          {% for hname, cnt in start_cnt %}
            {% if r.horse == hname %}
            <span style="font-family: Arial; color:var(--color-r5); border-radius: 7px; background-color: var(--color-bg); padding:1px 3px; border: 1px solid var(--color-r5);">{{cnt}}</span>
            {% endif %}
          {% endfor %}  
        </div>
        
      </td>

      {# ìµœê·¼7ê²½ì£¼ #}
      <td align="center" style="font-family: Arial;">
        
        {% if r.remark|slice:"0:1" == '1' and r.remark|slice:"1:2" == '-' %}
        <div style="font-size: 1.0rem; color:var(--color-r1);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% elif r.remark|slice:"0:1" == '2' and r.remark|slice:"1:2" == '-' %}
        <div style="font-size: 1.0rem; color:var(--color-r2);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% elif r.remark|slice:"0:1" == '3' and r.remark|slice:"1:2" == '-' %}
        <div style="font-size: 1.0rem; color:var(--color-r3);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% elif r.remark|slice:"0:1" == '4' and r.remark|slice:"1:2" == '-' %}
        <div style="font-size: 1.0rem; color:var(--color-r4);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% elif r.remark|slice:"0:1" == '5' and r.remark|slice:"1:2" == '-' %}
        <div style="font-size: 1.0rem; color:var(--color-r5);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% else %}
        <div style="font-size: 1.0rem; color:var(--color-gray);">{{r.remark|slice:"0:9"}}<br>{{r.remark|slice:"9:"}}</div>
        {% endif %}

      </td>


      {# ë©”ëª¨ or ì—°ì‹ #}
      {% if r.alloc3r %}

      <td align="right" style="font-family: Arial; font-size: 1.1rem;">
        
        <div style="font-size: 1.1rem; text-align: right; font-style: normal;">
          {% if r.r_rank == 1 %}
          <span style="color:var(--color-r1); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc1r %} {{r.alloc1r}} {% endif %}</span>
          {% elif r.r_rank == 2 %}
          <span style="color:var(--color-r2); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc1r %} {{r.alloc1r}} {% endif %}</span>
          {% elif r.r_rank == 3 %}
          <span style="color:var(--color-r3); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc1r %} {{r.alloc1r}} {% endif %}</span>
          {% else %}
            {% if r.alloc1r|mul:1 <= 10.0 %}
            <span style="font-family: Arial; color: var(--color-main); border-radius: 7px; border: solid 1px var(--color-r1); padding: 2px 4px;">{% if r.alloc1r %} {{r.alloc1r}} {% endif %}</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{% if r.alloc1r %} {{r.alloc1r}} {% endif %}</span>
            {% endif %}
          {% endif %}
        </div>

        <div style="font-size: 1.1rem; text-align: right; font-style: normal;">
          {% if r.r_rank == 1 %}
          <span style="color:var(--color-r1); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc3r %} {{r.alloc3r}} {% endif %}</span>
          {% elif r.r_rank == 2 %}
          <span style="color:var(--color-r2); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc3r %} {{r.alloc3r}} {% endif %}</span>
          {% elif r.r_rank == 3 %}
          <span style="color:var(--color-r3); font-family: Arial; font-style: italic; font-family: Arial; padding:2px 4px; border-radius: 7px; background-color: var(--color-bg);">{% if r.alloc3r %} {{r.alloc3r}} {% endif %}</span>
          {% else %}
            {% if r.alloc3r|mul:1 <= 2.0 %}
            <span style="font-family: Arial; color: var(--color-main); border-radius: 7px; border: solid 1px var(--color-r1); padding: 2px 4px;">{% if r.alloc3r %} {{r.alloc3r}} {% endif %}</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{% if r.alloc3r %} {{r.alloc3r}} {% endif %}</span>
            {% endif %}
          {% endif %}
        </div>

      </td>
      {% endif %}


    </tr>

    <tr class="fold">
      <td colspan="17">
        {% include 'base/m_result.html' %}
      </td>
    </tr>
    {% endfor %}


  </tbody>
</table>

<script>
  (function () {
    if (window.__tooltipPortalInit) return;
    window.__tooltipPortalInit = true;

    var portal = null;
    var GAP = 12;

    function ensurePortal() {
      if (!portal) {
        portal = document.createElement('div');
        portal.className = 'tooltip-portal';
        document.body.appendChild(portal);
      }
      return portal;
    }

    function place(x, y) {
      var vw = window.innerWidth, vh = window.innerHeight;
      portal.style.left = Math.max(8, Math.min(x, vw - portal.offsetWidth - 8)) + 'px';
      portal.style.top  = Math.max(8, Math.min(y, vh - portal.offsetHeight - 8)) + 'px';
    }

    function onEnter(e) {
      var host = e.target.closest('.tooltip');
      if (!host) return;
      var txt = host.querySelector('.tooltip-text');
      if (!txt) return;
      ensurePortal();
      portal.innerHTML = txt.innerHTML;
      var r = host.getBoundingClientRect();
      place(r.right + GAP, r.top + GAP);
      document.addEventListener('mousemove', onMove, true);
    }

    function onMove(e) {
      if (!portal) return;
      place(e.clientX + GAP, e.clientY + GAP);
    }

    function onLeave(e) {
      var host = e.target.closest('.tooltip');
      if (!host) return;
      if (portal && portal.parentNode) portal.parentNode.removeChild(portal);
      portal = null;
      document.removeEventListener('mousemove', onMove, true);
    }

    document.addEventListener('mouseenter', onEnter, true);
    document.addEventListener('mouseleave', onLeave, true);
  })();
</script>
