{% load mathfilters %}

<style>
  /* í¬íƒˆ ê¸°ë°˜ íˆ´íŒ: ì»¨í…Œì´ë„ˆ overflowì— ì˜ë¦¬ì§€ ì•Šë„ë¡ ìµœìƒë‹¨ì— í‘œì‹œ */
  .tooltip .tooltip-text { display: none !important; }
  .tooltip-portal {
    position: fixed;
    z-index: 99999;
    max-width: 42rem;
    background: rgba(18,18,18,0.96);
    color: var(--color-light-gray);
    padding: 8px 10px;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 8px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    pointer-events: none;
    font-size: 1.1rem;
    line-height: 1.35;
  }

  /* í…Œì´ë¸” í—¤ë” ê³ ì • + ë°”ë””ë§Œ ìŠ¤í¬ë¡¤ */
  .tt9dark-table-wrap {
    max-height: 90vh;
    overflow-y: auto;
    overflow-x: auto;
  }
  .tt9dark-table {
    --tt9-head-row1-height: 3.4rem;
    --tt9-sticky-top: 0px;
    overflow: visible;
  }
  .tt9dark-table thead th {
    position: sticky;
    top: var(--tt9-sticky-top);
    z-index: 2;
  }
  .tt9dark-table thead tr:first-child th {
    top: var(--tt9-sticky-top);
    z-index: 3;
  }
  .tt9dark-table thead tr:nth-child(2) th {
    top: calc(var(--tt9-sticky-top) + var(--tt9-head-row1-height));
  }
</style>

  <div class="tt9dark-table-wrap">
    <table class="tt9dark-table" style="width: 98vw; max-width: 1550px; min-width: 800px; margin: 0 auto;">
      <thead>
        <tr>
          <th colspan="28" style="font-size: 1.3rem;background-color: var(--color-dark); border-radius: 7px">
            {% if jockey != '%' %}<span style="background-color: var(--color-r4); color:var(--color-bg); border-radius: 7px; padding: 2px 4px;">ğŸ‡&nbsp;{{jockey}}</span>{% endif %}
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            {% if trainer != '%' %}<span style="background-color: var(--color-r4); color:var(--color-bg); border-radius: 7px; padding: 2px 4px;">ğŸ›–&nbsp;{{trainer}}</span>{% endif %}
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            {% if host != '%' %}<span style="background-color: var(--color-r4); color:var(--color-bg); border-radius: 7px; padding: 2px 4px;">ğŸ¤ &nbsp;{{host}}</span>{% endif %}
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            {% if jockey_b != '%' %}<span style="background-color: var(--color-r5); color:var(--color-bg); border-radius: 7px; padding: 2px 4px;">ğŸ´&nbsp;{{jockey_b}}</span>{% endif %}
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>

            <span>ğŸ†&nbsp;&nbsp;ê²½ì£¼ê²°ê³¼&nbsp;:&nbsp;</span>
            <span style="font-family: Arial; color: var(--color-light);">{{rcount}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r1);">{{r_rank1}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r2);">{{r_rank2}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r3);">{{r_rank3}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            {% if rcount > 0 %}
            <span style="font-family: Arial; color: var(--color-bg); background-color: var(--color-r4); padding: 2px 4px; border-radius: 7px;">{{r_rank1|add:r_rank2|add:r_rank3|mul:100|div:rcount|floatformat:1}}<sup style="font-size: 0.9rem;">%</sup></span>
            {% endif %}
            <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>


            <span>ğŸ’»&nbsp;&nbsp;í”„ë¡œê·¸ë¨&nbsp;:&nbsp;</span>
            <span style="font-family: Arial; color: var(--color-light);">{{rcount}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r1);">{{rank1}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r2);">{{rank2}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            <span style="font-family: Arial; color: var(--color-r3);">{{rank3}}</span>
            <span style="color: var(--color-gray);">ï¹†</span>
            {% if rcount > 0 %}
            <span style="font-family: Arial; color: var(--color-bg); background-color: var(--color-r4); padding: 2px 4px; border-radius: 7px;">{{rank1|add:rank2|add:rank3|mul:100|div:rcount|floatformat:1}}<sup style="font-size: 0.9rem;">%</sup></span>
            {% endif %}
          </th>
        </tr>
        <tr>

          <th colspan="2" style="font-size: 1.3rem;background-color: var(--color-dark); border-radius: 7px">
            <span>ê²½ì£¼ì •ë³´</span>
          </th>
          
          <th colspan="2" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>Horse</span></th>

          <th colspan="2" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>ë§ˆì²´ì¤‘</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>ë¶€ë‹´ì¤‘ëŸ‰</span></th>
          {% if jockey == '%' or winname == 'weeksStatus' %} 
          <th colspan="1" style="font-size: 1.2rem; background-color: var(--color-dark); border-radius: 7px;"><span>ğŸ‡</span></th>
          {% endif %}
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>J&T</span></th>
          {% if trainer == '%' or winname == 'weeksStatus' %}
          <th colspan="1" style="font-size: 1.2rem; background-color: var(--color-dark); border-radius: 7px;"><span>ğŸ›–</span></th>
          {% endif %}
          {% if host == '%' or winname == 'weeksStatus' %}
          <th colspan="1" style="font-size: 1.2rem; background-color: var(--color-dark); border-radius: 7px;"><span>ğŸ¤ </span></th>
          {% endif %}
          
          <th colspan="1" style="font-size: 1.2rem; text-transform: lowercase; background-color: var(--color-dark); border-radius: 7px;"><span>S_per</span></th>
          <th colspan="1" style="font-size: 1.2rem; text-transform: lowercase; background-color: var(--color-dark); border-radius: 7px;"><span>s1f</span></th>
          <th colspan="1" style="font-size: 1.2rem; text-transform: lowercase; background-color: var(--color-dark); border-radius: 7px;"><span>g3f</span></th>
          <th colspan="1" style="font-size: 1.2rem; text-transform: lowercase; background-color: var(--color-dark); border-radius: 7px;"><span>g1f</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>ë§ˆë²ˆ</span></th>

          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;">Corners</th>

          <th colspan="3" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>ê²½ì£¼ê²°ê³¼</span></th>
          <th colspan="2" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><span>ê²½ì£¼ë¡œ</span></th>
          
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px"><span>ë³µìŠ¹</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px"><span>ì—°ì‹</span></th>

          <th colspan="2" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px; text-transform: lowercase;"><span>thethe9</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px;"><span>R</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px;"><span>P</span></th>
          <th colspan="2" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px; font-size: 0.7rem; vertical-align: middle;"><span>ì¶œì£¼(ì•”)</span></th>
          
          <!-- <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><sup style="font-size:0.9rem;">r</sup><span>S1F</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><sup style="font-size:0.9rem;">r</sup><span>G3F</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-dark); border-radius: 7px;"><sup style="font-size:0.9rem;">r</sup><span>G1F</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px;"><sup style="font-size:0.9rem;">p</sup><span>S1F</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px;"><sup style="font-size:0.9rem;">p</sup><span>G3F</span></th>
          <th colspan="1" style="font-size: 1.3rem; background-color: var(--color-bg); border-radius: 7px;"><sup style="font-size:0.9rem;">p</sup><span>G1F</span></th> -->
          
        </tr>
      </thead>
      <tbody>

        {% for rcity, rdate, r_rno, rday, distance, grade, dividing, horse, jname, tname, hname, h_weight, handycap, i_prehandy, gate, rank, r_rank, corners, r_s1f, r_g3f, r_g1f, s1f_rank, g3f_rank, g2f_rank, g1f_rank, cs1f, cg3f, cg1f,i_cycle, r_pop, alloc1r, alloc3r, complex, r_record, track, jt_per, jt_cnt, jt_1st, jt_2nd, jt_3rd, jockey_old, reason, h_sex, h_age, birthplace, j_per, t_per, rating, r2alloc, r3alloc, r_etc, gap, gap_b, weather, rstate, rmoisture, adv_track, r_judge, rating, h_cnt, h_mare, pop_rank, r_flag, passage_s1f, s1f_per, g3f_per, g1f_per, start_score in status %}
        
        <tr class="view">
          
          {# ê²½ì£¼ë²ˆí˜¸ #}
          <td align="center">
            {% if winname == 'weeksStatus' %}
              {% if r_rank ==  1 %}
              <div style="font-style: italic;">
                <a href="{% url 'race_prediction' rcity rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
                  <span class="tooltip">
                    {% if today <= rdate %}
                    <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial; color: var(--color-r4); border-radius: 7px; background-color: var(--color-bg); padding: 2px 4px;">'{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                    {% else %}
                    <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial;">'{{rdate|slice:"2:4"}}.{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                    {% endif %}

                    <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial; color:var(--color-light);">{{distance}}á´¹</span>

                    {% if 'OPEN' in grade %}
                    <span style="font-size: 1.15rem; font-family: Arial; color:var(--color-r1);">{{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}</span>
                    {% else %}
                    <span style="font-size: 1.15rem; font-family: Arial;">{{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}</span>
                    {% endif %}

                    <span class="tooltip-text" style="font-size: 1.3rem; font-weight:normal; text-align: left; z-index: 9;">
                      <span style="font-size: 1.3rem; font-weight:normal; padding-bottom: 0.5rem;">ğŸ´&nbsp;Race Info.</span>
                      &nbsp;&nbsp;
                      <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial;">{{rdate|slice:"0:4"}}.{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                      
                      <br>
                      &nbsp;&nbsp;&nbsp;&nbsp;
                      <span style="font-size: 1.3rem; font-weight:normal;">{{dividing}}</span>
                    </span>
                  </span>
                </a>
              </div>
              {% endif %}
            {% else %}
            <div style="font-style: italic;">
              <a href="{% url 'race_prediction' rcity rdate r_rno 0 'awardee' %}" onclick="window.open(this.href, 'w_race_prediction', 'width=900, height=1000, top=0, left=0, toolbars=no, scrollbars=yes'); return false;">
                <span class="tooltip">
                  {% if today <= rdate %}
                  <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial; color: var(--color-r4); border-radius: 7px; background-color: var(--color-bg); padding: 2px 4px;">'{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                  {% else %}
                  <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial;">'{{rdate|slice:"2:4"}}.{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                  {% endif %}

                  <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial; color:var(--color-light);">{{distance}}á´¹</span>

                  {% if 'OPEN' in grade %}
                  <span style="font-size: 1.15rem; font-family: Arial; color:var(--color-r1);">{{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}</span>
                  {% else %}
                  <span style="font-size: 1.15rem; font-family: Arial;">{{grade|slice:"0:2"}}{{dividing|slice:"0:1"}}</span>
                  {% endif %}

                  <span class="tooltip-text" style="font-size: 1.3rem; font-weight:normal; text-align: left; z-index: 9;">
                    <span style="font-size: 1.3rem; font-weight:normal; padding-bottom: 0.5rem;">ğŸ´&nbsp;Race Info.</span>
                    &nbsp;&nbsp;
                    <span style="font-size: 1.3rem; font-weight:normal; font-family: Arial;">{{rdate|slice:"0:4"}}.{{rdate|slice:"4:6"}}.{{rdate|slice:"6:8"}}</span>
                    
                    <br>
                    &nbsp;&nbsp;&nbsp;&nbsp;
                    <span style="font-size: 1.3rem; font-weight:normal;">{{dividing}}</span>
                  </span>
                </span>
              </a>
            </div>
            {% endif %}
          </td>

          <td align="right">
            {% if winname == 'weeksStatus' %}
              {% if r_rank ==  1 %}
                <a href="{% url 'race_result' rcity rdate r_rno horse 0 0 0 %}" onclick="window.open(this.href, 'w_result', 'width=900, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
                {% if rcity == 'ì„œìš¸' %}
                  <span style="font-size: 1.2rem; font-family: Arial; padding-right: 0px;">{% if r_rno >= 10 %}{{r_rno}}á´¿{% else %}{{r_rno}}á´¿{% endif %}</span>
                  <span style="font-size: 0.9rem; font-family: Arial; border-radius: 7px; padding: 2px 2px; background-color: var(--color-bg); color:var(--color-r2);">
                    {{rcity|slice:"0:1"}}</span>
                {% else %}
                  <span style="font-size: 1.2rem; font-family: Arial; padding-right: 0px;">{% if r_rno >= 10 %}{{r_rno}}á´¿{% else %}{{r_rno}}á´¿{% endif %}</span>
                  <span style="font-size: 0.9rem; font-family: Arial; border-radius: 7px; padding: 2px 2px; background-color: var(--color-bg); color:var(--color-r5);">
                    {{rcity|slice:"0:1"}}</span>
                {% endif %}
                </a>
              {% endif %}
            {% else %}
              <a href="{% url 'race_result' rcity rdate r_rno horse 0 0 0 %}" onclick="window.open(this.href, 'w_result', 'width=900, height=1000, top=10,left=10 toolbars=no, scrollbars=yes' ); return false;">
              {% if rcity == 'ì„œìš¸' %}
                <span style="font-size: 1.2rem; font-family: Arial; padding-right: 0px;">{% if r_rno >= 10 %}{{r_rno}}á´¿{% else %}{{r_rno}}á´¿{% endif %}</span>
                <span style="font-size: 0.9rem; font-family: Arial; border-radius: 7px; padding: 2px 2px; background-color: var(--color-bg); color:var(--color-r2);">
                  {{rcity|slice:"0:1"}}</span>
              {% else %}
                <span style="font-size: 1.2rem; font-family: Arial; padding-right: 0px;">{% if r_rno >= 10 %}{{r_rno}}á´¿{% else %}{{r_rno}}á´¿{% endif %}</span>
                <span style="font-size: 0.9rem; font-family: Arial; border-radius: 7px; padding: 2px 2px; background-color: var(--color-bg); color:var(--color-r5);">
                  {{rcity|slice:"0:1"}}</span>
              {% endif %}
              </a>
            {% endif %}

            {# ë©”ëª¨ #}
            {% if request.user.username == 'admin' %}

            <a href="{% url 'write_significant' rdate horse %}" 
                            onclick="window.open(this.href, 'write_significant', 'top=' + window.screenTop + ', left=' + window.screen.width + ', width=500, height=550, toolbars=no, scrollbars=yes'); return false;">

              {% include 'base/m_memo.html' with size='1.3rem' color='var(--color-r4)' %}

            </a>
            {% endif %}
          </td>

          {# ë§ˆëª… #}
          <td align="left" style="font-size: 1.25rem;">
            <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:50000 rdate '%' '%' '%' horse '1' '99' '1' '99' '0' '0' '0' %}">
              <div style="font-family: Arial; text-align: left;">
                
              
              {% if r_flag == None or r_flag == '0' %}
                {% if today == rdate and rno == r_rno %}
                <span style="color:var(--color-bg); background-color: var(--color-r4); padding: 2px 4px; border-radius: 7px;">{{horse|slice:"0:6"}}</span>
                {% else %}
                <span style="color:var(--color-light);">{{horse|slice:"0:6"}}</span>
                {% endif %}
              {% else %}
              <span class="tooltip" style="font-weight: normal; color:var(--color-r1);">{{horse|slice:"0:6"}}
                <span class="tooltip-text" style="font: 1.15rem;">ğŸš«&nbsp;ì§‘ê³„ ì œì™¸
                </span>
              </span>
              {% endif %}
              </div>
            </a>

          </td>
          
          {# ê²½ì£¼ë§ˆ ì„±ë³„ ë‚˜ì´ ë“± #}
          <td align="right">

            {% if i_cycle %}
                {% if i_cycle <= 15 %}
                <span style="font-family: Arial; color:var(--color-light); border-radius: 5px; background-color:var(--color-r1); padding:2px 3px; font-size: 1.1rem;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% elif i_cycle >= 68 %}
                <span style="font-family: Arial; color:var(--color-light); border-radius: 5px; background-color:var(--color-r1); padding:2px 3px; font-size:0.9rem;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% else %}
                <span style="font-family: Arial; color:var(--color-bg); border-radius: 5px; background-color:var(--color-light-gray); padding:2px 3px; font-size: 1.1rem;">{{i_cycle|div:7|floatformat:0}}<sup style="font-size:0.7rem;">w</sup></span>
                {% endif %}
              {% endif %}
            
            {# ì¶œìƒì§€ #}
            {% if birthplace == 'í•œ' %}
            <span style="font-size: 1.15rem; color:var(--color-gray); border-radius: 10px; background-color:var(--color-bg); ">{{birthplace}}</span>
            {% elif birthplace == 'ë¯¸' %}
            <span style="font-size: 1.15rem; color:var(--color-r2); border-radius: 10px; background-color:var(--color-bg); ">{{birthplace}}</span>
            {%else%}
              {% if 'í¬' in birthplace %}
              <span style="font-size: 1.15rem; color:var(--color-r4); border-radius: 10px; background-color:var(--color-bg); ">í¬</span>
              {% else %}
              <span style="font-size: 1.15rem; color:var(--color-r4); border-radius: 10px; background-color:var(--color-bg); ">{{birthplace}}</span>
              {% endif %}
            {%endif%}
            
            {# ì„±ë³„ #}
            {% if h_sex == 'ì•”' %}
            <span style="font-size: 1.15rem; color:var(--color-r1); border-radius: 10px; background-color:var(--color-bg); ">{{h_sex}}</span>
            {% elif h_sex == 'ê±°' %}
            <span style="font-size: 1.15rem; color:var(--color-r3); border-radius: 10px; background-color:var(--color-bg); ">{{h_sex}}</span>
            {%else%}
            <span style="font-size: 1.15rem; color:var(--color-light-gray); border-radius: 10px; background-color:var(--color-bg); ">{{h_sex}}</span>
            {%endif%}
            
            {# ë‚˜ì´ #}
            {% if h_age %}
            {% if h_age >= 6.9 %}
            <span style="font-family: Arial; font-size: 1.15rem; color:var(--color-r1); border-radius: 10px; background-color:var(--color-bg); ">{{h_age}}</span>
            {% elif h_age < 3 %}
            <span style="font-family: Arial; font-size: 1.15rem; color:var(--color-r2); border-radius: 10px; background-color:var(--color-bg); ">{{h_age}}</span>
            {%else%}
            <span style="font-family: Arial; font-size: 1.15rem; color:var(--color-gray); border-radius: 10px; background-color:var(--color-bg); ">{{h_age}}</span>
            {%endif%}
            {%endif%}
          </td>
          
          {# ì²´ì¤‘ #}
          <td align="right">
            <span style="font-family: Arial; text-align: right;">
              {% if h_weight|slice:"4:" %}
              {% if h_weight|slice:"4:5" == '+' %}
              <span style="font-size: 1.15rem; font-family: Arial; border-radius: 7px; background-color: var(--color-bg); color:var(--color-r1); padding:2px 4px;">{{h_weight|slice:"4:"}}</span>
              {% else %}
              <span style="font-size: 1.15rem; font-family: Arial; border-radius: 7px; background-color: var(--color-bg); color:var(--color-r5); padding:2px 4px;">{{h_weight|slice:"4:"}}</span>
              {% endif %}
              {% endif %}
            </span>
            {% if h_weight|slice:"0:3" <= '440' %}
            <span style="font-size: 1.2rem; font-family: Arial; color:var(--color-r5);">{{h_weight|slice:"0:3"}}</span>
            {% elif h_weight|slice:"0:3" >= '500' %}
            <span style="font-size: 1.2rem; font-family: Arial; color:var(--color-r2);">{{h_weight|slice:"0:3"}}</span>
            {% else %}
            <span style="font-size: 1.2rem; font-family: Arial; color:var(--color-gray);">{{h_weight|slice:"0:3"}}</span>
            {% endif %}
          </td>
          
          <td align="right">
            {% with h_weight|slice:"0:3"|add:0 as weight_prefix %}
            {% if weight_prefix %}
              {% with handycap|div:weight_prefix|mul:100 as handy_ratio %}
                  {% if handy_ratio >= 11.95 %}
                    {% if h_sex == 'ì•”' or h_age >= 6.0 %}
                    <span style="font-family: Arial; font-size: 1.0rem; font-style: italic; color:var(--color-r1); font-weight: bold;">
                      {{handy_ratio|floatformat:1}}
                    </span>
                    {% else %}
                    <span style="font-family: Arial; font-size: 1.0rem; font-style: italic; color:var(--color-r2);">
                      {{handy_ratio|floatformat:1}}
                    </span>
                    {% endif %}
                  {% else %}
                    <span style="font-family: Arial; font-size: 1.0rem; font-style: italic; color:var(--color-gray);">
                      {{handy_ratio|floatformat:1}}
                    </span>
                  {% endif %}
                {% endwith %}
              {% else %}
                <span style="font-family: Arial; font-size: 1.0rem; font-style: italic; color:var(--color-gray);">
                  0.0
                </span>
              {% endif %}
            {% endwith %}
          </td>

          {# ë¶€ë‹´ì¤‘ëŸ‰ #}
          <td align="right">
            {% if i_prehandy == 0.0 or i_prehandy == handycap %}
            <span style="border-radius: 7px; background-color: var(--color-bg); color:var(--color-r1); padding:2px 4px; font-family: Arial; font-size:1.15rem; color:var(--color-gray);">-</span>
            {% elif i_prehandy > 0.0 %}
            <span style="border-radius: 7px; background-color: var(--color-bg); color:var(--color-r1); padding:2px 4px; font-family: Arial; font-size:1.15rem; color:var(--color-r1);">+{{i_prehandy}}</span>
            {% else %}
            <span style="border-radius: 7px; background-color: var(--color-bg); color:var(--color-r1); padding:2px 4px; font-family: Arial; font-size:1.15rem; color:var(--color-r5);">{{i_prehandy}}</span>
            {% endif %}


            
            {% for j_name, load_in in loadin %}
              {% if j_name == jname %}
                {% if handycap|floatformat:0 <= load_in|mul:1|floatformat:0 %}
                <span style="padding:2px 4px; font-family: Arial; font-style:italic; font-size:1.15rem; color:var(--color-r3); border-radius:7px; background-color:var(--color-bg);">{{handycap}}</span>
                {% elif handycap|floatformat:0 <= load_in|mul:1|add:1|floatformat:0 %}
                <span style="padding:2px 4px; font-family: Arial; font-style:italic; font-size:1.15rem; color:var(--color-light); border-radius:7px; background-color:var(--color-dark-medium);">{{handycap}}</span>
                {% else %}
                <span style="padding:2px 4px; font-family: Arial; font-size:1.2rem; color:var(--color-gray);">{{handycap}}</span>
                {% endif %}
              {% endif %}
            {% endfor %}
          </td>

          {# ê¸°ìˆ˜ #}
          {% if jockey == '%' or winname == 'weeksStatus' %}
          <td align="center">
            <div style="font-size: 1.2rem; text-align: left; ">
      
              {% if jockey_old %} {# ê¸°ìˆ˜ë³€ê²½ #}
              <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jname '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' %}">
                <span class="tooltip" style="font-style: italic; color:var(--color-r2);">{{jname|slice:"0:3"}}
                  <span class="tooltip-text">
                    ğŸ´ ë³€ê²½ì‚¬ìœ  : {{reason}}{% if jockey_old%}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ë³€ê²½ì „ ê¸°ìˆ˜ : {{jockey_old}}{% endif %}
              
                  </span>
                </span>
              </a>
            
              {% else %}
              <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jname '%' '%' '%' '1' '99' '1' '99' '0' '0' '0' %}">

                {% if jname in j_string %}
                  {% if today == rdate and rno == r_rno %}
                  <span style="color:var(--color-bg); background-color: var(--color-r4); border-radius: 7px; padding: 2px 3px;">{{jname|slice:"0:3"}}</span>
                  {% else %}
                  <span style="color:var(--color-r4); background-color: var(--color-bg); border-radius: 7px; padding: 2px 3px;">{{jname|slice:"0:3"}}</span>
                  {% endif %}
                {% else %}
                <span style="color:var(--color-light-gray);">{{jname|slice:"0:3"}}</span>
                {% endif %}

              </a>
              {%endif %}
              
            </div>
          </td>
          {% endif %}

          {# J&T #}
          <td align="right" style="background-color: var(--color-dark); border-radius: 7px;">
            <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate jname tname '%' '%' '1' '99' '1' '99' '0' '0' '0' %}"
              onclick="window.open(this.href, 'jt_analysis', 'width=1250, height=1000, toolbars=no, scrollbars=yes'); return false;">
            {% if jockey_old %}
              {# ê¸°ìˆ˜ê°€ ë³€ê²½ë˜ì—ˆìœ¼ë©´ ê¸°ì¡´ ê¸°ìˆ˜ì˜ ê¸°ë¡ì„ ì‚­ì œ #}
              
                {% if jt_cnt %}
                <div class="tooltip" style="font-size: 1.2rem; text-align: right;">
                  
                  {% if jt_3rd|mul:100|div:jt_cnt == 100 %}
                  <span style="font-family: Arial; color: var(--color-r1); text-decoration:line-through;">100</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 30 and jt_3rd|mul:100|div:jt_cnt < 100 %}
                  <span style="font-family: Arial; color: var(--color-r1); text-decoration:line-through;">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 20 and jt_3rd|mul:100|div:jt_cnt < 30 %} 
                  <span style="font-family: Arial; color: var(--color-r3); text-decoration:line-through;">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% else %}
                  <span style="font-family: Arial; color:var(--color-gray); text-decoration:line-through;">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% endif %}
                  
                  <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
                    <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp;ê¸°ìˆ˜ ë³€ê²½ì „&nbsp;{{jockey_old}}&nbsp;({{j_per}}%)ï¹†&nbsp;{{trainer}}&nbsp;({{t_per}}%)</div>
                    <hr>
                    <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ê²½ì£¼ì¼ ê¸°ì¤€ 1ë…„ê°„ ì¶œì£¼ íšŸìˆ˜ :
              
                      {% if jt_cnt %}
                      <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{jt_cnt}}</span>
                      <span style="font-family: Arial; color:var(--color-r3)">{{jt_1st}}</span>
                      <span style="font-family: Arial; color:var(--color-r4)">{{jt_2nd|sub:jt_1st}}</span>
                      <span style="font-family: Arial; color:var(--color-r5)">{{jt_3rd|sub:jt_2nd}}</span>
                      {% else %}
                      <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                      <span style="font-family: Arial; color:var(--color-r3)">0</span>
                      <span style="font-family: Arial; color:var(--color-r4)">0</span>
                      <span style="font-family: Arial; color:var(--color-r5)">0</span>
                      {% endif %}
                    </div>
                    <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                      2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      {% if jt_cnt > 0 %}
                      <span style="font-family: Arial; color: var(--color-r2);">{{jt_2nd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% else %}
                      <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                      {% endif %}
                    </div>
                    <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                      3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      {% if jt_cnt > 0 %}
                      <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                      {% else %}
                      <span style="font-family: Arial; color: var(--color-light-gray);">0.0</span>
                      {% endif %}
                    </div>
              
                  </span>
                </div>

                {% endif %}

            {% else %}
              {% if jt_cnt %}
                <div class="tooltip" style="font-size: 1.2rem; text-align: right; font-weight: normal;">
                  {% if jt_3rd|mul:100|div:jt_cnt == 100 %}
                  <span style="font-family: Arial; color: var(--color-r1);">100</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 50 and jt_3rd|mul:100|div:jt_cnt < 100 %}
                  <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 40 and jt_3rd|mul:100|div:jt_cnt < 50 %} 
                  <span style="font-family: Arial; color: var(--color-r2);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 30 and jt_3rd|mul:100|div:jt_cnt < 40 %} 
                  <span style="font-family: Arial; color: var(--color-r3);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% elif jt_3rd|mul:100|div:jt_cnt >= 20 and jt_3rd|mul:100|div:jt_cnt < 30 %} 
                  <span style="font-family: Arial; color: var(--color-r5);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% else %}
                  <span style="font-family: Arial; color: var(--color-gray);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}</span>
                  {% endif %}
                  <span class="tooltip-text" style="font-family: Arial; font-size: 1.15rem; z-index:9;">
                  <div style="font-family: Arial; color:var(--color-light); text-align:center;">ğŸ‘¥&nbsp; {{jockey}}&nbsp;({{j_per}}%)ï¹†&nbsp;{{trainer}}&nbsp;({{t_per}}%)</div>
                  <hr>
                  <div style="font-family: Arial; color:var(--color-main); text-align: left; padding-top: 6px;">1ï¸âƒ£&nbsp;ê²½ì£¼ì¼ ê¸°ì¤€ 1ë…„ê°„ ì¶œì£¼ íšŸìˆ˜ : 

                    {% if jt_cnt %}
                    <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{jt_cnt}}</span>
                    <span style="font-family: Arial; color:var(--color-r3)">{{jt_1st}}</span>
                    <span style="font-family: Arial; color:var(--color-r4)">{{jt_2nd|sub:jt_1st}}</span>
                    <span style="font-family: Arial; color:var(--color-r5)">{{jt_3rd|sub:jt_2nd}}</span>
                    {% else %}
                    <span style="font-family: Arial; color:var(--color-r2); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">0</span>
                    <span style="font-family: Arial; color:var(--color-r3)">0</span>
                    <span style="font-family: Arial; color:var(--color-r4)">0</span>
                    <span style="font-family: Arial; color:var(--color-r5)">0</span>
                    {% endif %}
                  </div>
                  <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                    2ï¸âƒ£&nbsp;ë³µìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-r2);">{{jt_2nd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                  </div>
                  <div style="font-family: Arial; color:var(--color-light-gray); text-align: left;">
                    3ï¸âƒ£&nbsp;ì—°ìŠ¹ë¥  : &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    {% if jt_cnt > 0 %}
                    <span style="font-family: Arial; color: var(--color-r1);">{{jt_3rd|mul:100|div:jt_cnt|floatformat:"1"}}<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% else %}
                    <span style="font-family: Arial; color: var(--color-light-gray);">0.0<sup style="color:var(--color-gray); font-size:0.7rem;">%</sup></span>
                    {% endif %}
                  </div>
            
                </span>
                </div>

              {% endif %}
            
            {% endif %}
            </a>
          </td>

          {# ì¡°êµì‚¬ #}
          {% if trainer == '%' or winname == 'weeksStatus' %}
          <td align="center">
            <div style="font-size: 1.2rem; text-align: left; ">
              <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate '%' tname '%' '%' '1' '99' '1' '99' '0' '0' '0' %}">
                {% if tname in t_string %}
                  {% if today == rdate and rno == r_rno %}
                  <span style="color:var(--color-bg); background-color: var(--color-r4); border-radius: 7px; padding: 2px 3px;">{{tname|slice:"0:3"}}</span>
                  {% else %}
                  <span style="color:var(--color-r4); background-color: var(--color-bg); border-radius: 7px; padding: 2px 3px;">{{tname|slice:"0:3"}}</span>
                  {% endif %}
                {% else %}
                <span style="color:var(--color-light-gray);">{{tname|slice:"0:3"}}</span>
                {% endif %}
              </a>
            </div>
          </td>
          {% endif %}


          {# ë§ˆì£¼ #}
          {% if host == '%' or winname == 'weeksStatus' %}
          <td align="center">
            <div style="font-size: 1.2rem; text-align: left; ">
              <a href="{% url 'jt_analysis' '%' rdate|mul:1|sub:10000 rdate '%' '%' hname '%' '1' '99' '1' '99' '0' '0' '0' %}">
                {% if hname in h_string %}
                  {% if today == rdate and rno == r_rno %}
                  <span class="tooltip" style="font-weight: normal; color:var(--color-bg); background-color: var(--color-r4); border-radius: 7px; padding: 1px 2px;">{{hname|slice:"0:3"}}
                    <span class="tooltip-text">{{hname}}</span>
                  </span>
                  {% else %}
                  <span class="tooltip" style="font-weight: normal; color:var(--color-r4); background-color: var(--color-bg); border-radius: 7px; padding: 1px 2px;">{{hname|slice:"0:3"}}
                    <span class="tooltip-text">{{hname}}</span>
                  </span>
                  {% endif %}
                
                {% else %}
                <span class="tooltip" style="color:var(--color-light-gray); font-weight: normal;">{{hname|slice:"0:3"}}
                  <span class="tooltip-text">{{hname}}</span>
                </span>
                {% endif %}
              </a>
            </div>
          </td>
          {% endif %}

          {# start_score #}
          <td style="text-align: center; font-family: Arial, Helvetica, sans-serif;">
            <span class="tooltip" style="font-weight: normal; font-size: 1.1rem;">
            {% if start_score == 100 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 1.0rem;">âš¡ï¸&nbsp;&nbsp;</span>
            {% elif start_score >= 90.0 and start_score < 100 %}
            <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{start_score|floatformat:1}}</span>
            {% elif start_score >= 80.0 and start_score < 90 %}
            <span style="font-family: Arial; color: var(--color-r2); border-bottom: 1px solid var(--color-r2); border-radius: 4px;">{{start_score|floatformat:1}}</span>
            {% elif start_score >= 70 and start_score < 80 %}
            <span style="font-family: Arial; color: var(--color-r3);">{{start_score|floatformat:1}}</span>
            {% elif start_score >= 60 and start_score < 70 %}
            <span style="font-family: Arial; color: var(--color-r4);">{{start_score|floatformat:1}}</span>
            {% elif start_score >= 50 and start_score < 60 %}
            <span style="font-family: Arial; color: var(--color-r5);">{{start_score|floatformat:1}}</span>
            {% elif start_score == 0 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 0.8rem;">ğŸ”´&nbsp;&nbsp;</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{{start_score|floatformat:1}}</span>
            {% endif %}
            <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
                â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{start_score|floatformat:1}}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{{corners}}</span>
              
              </span>
          </td>
          {# s1f_per #}
          <td style="text-align: center; font-family: Arial, Helvetica, sans-serif;">
            <span class="tooltip" style="font-weight: normal; font-size: 1.1rem;">
            {% if s1f_per == 100 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 1.0rem;">âš¡ï¸&nbsp;&nbsp;</span>
            {% elif s1f_per >= 90.0 and s1f_per < 100 %}
            <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{s1f_per|floatformat:1}}</span>
            {% elif s1f_per >= 80.0 and s1f_per < 90 %}
            <span style="font-family: Arial; color: var(--color-r2); border-bottom: 1px solid var(--color-r2); border-radius: 4px;">{{s1f_per|floatformat:1}}</span>
            {% elif s1f_per >= 70 and s1f_per < 80 %}
            <span style="font-family: Arial; color: var(--color-r3);">{{s1f_per|floatformat:1}}</span>
            {% elif s1f_per >= 60 and s1f_per < 70 %}
            <span style="font-family: Arial; color: var(--color-r4);">{{s1f_per|floatformat:1}}</span>
            {% elif s1f_per >= 50 and s1f_per < 60 %}
            <span style="font-family: Arial; color: var(--color-r5);">{{s1f_per|floatformat:1}}</span>
            {% elif s1f_per == 0 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 0.8rem;">ğŸ”´&nbsp;&nbsp;</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{{s1f_per|floatformat:1}}</span>
            {% endif %}
            <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
                â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{s1f_per|floatformat:1}}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{{r.corners}}</span>
              
              </span>
          </td>
          {# g3f_per #}
          <td style="text-align: center; font-family: Arial, Helvetica, sans-serif;">
            <span class="tooltip" style="font-weight: normal; font-size: 1.1rem;">
            {% if g3f_per == 100 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 1.0rem;">âš¡ï¸&nbsp;&nbsp;</span>
            {% elif g3f_per >= 90.0 and g3f_per < 100 %}
            <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g3f_per|floatformat:1}}</span>
            {% elif g3f_per >= 80.0 and g3f_per < 90 %}
            <span style="font-family: Arial; color: var(--color-r2); border-bottom: 1px solid var(--color-r2); border-radius: 4px;">{{g3f_per|floatformat:1}}</span>
            {% elif g3f_per >= 70 and g3f_per < 80 %}
            <span style="font-family: Arial; color: var(--color-r3);">{{g3f_per|floatformat:1}}</span>
            {% elif g3f_per >= 60 and g3f_per < 70 %}
            <span style="font-family: Arial; color: var(--color-r4);">{{g3f_per|floatformat:1}}</span>
            {% elif g3f_per >= 50 and g3f_per < 60 %}
            <span style="font-family: Arial; color: var(--color-r5);">{{g3f_per|floatformat:1}}</span>
            {% elif g3f_per == 0 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 0.8rem;">ğŸ”´&nbsp;&nbsp;</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{{g3f_per|floatformat:1}}</span>
            {% endif %}
            <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
                â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{g3f_per|floatformat:1}}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{{r.corners}}</span>
              
              </span>
          </td>
          {# g1f_per #}
          <td style="text-align: center; font-family: Arial, Helvetica, sans-serif;">
            <span class="tooltip" style="font-weight: normal; font-size: 1.1rem;">
            {% if g1f_per == 100 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 1.0rem;">âš¡ï¸&nbsp;&nbsp;</span>
            {% elif g1f_per >= 90.0 and g1f_per < 100 %}
            <span style="font-family: Arial; color: var(--color-r1); border-bottom: 1px solid var(--color-r1); border-radius: 4px;">{{g1f_per|floatformat:1}}</span>
            {% elif g1f_per >= 80.0 and g1f_per < 90 %}
            <span style="font-family: Arial; color: var(--color-r2); border-bottom: 1px solid var(--color-r2); border-radius: 4px;">{{g1f_per|floatformat:1}}</span>
            {% elif g1f_per >= 70 and g1f_per < 80 %}
            <span style="font-family: Arial; color: var(--color-r3);">{{g1f_per|floatformat:1}}</span>
            {% elif g1f_per >= 60 and g1f_per < 70 %}
            <span style="font-family: Arial; color: var(--color-r4);">{{g1f_per|floatformat:1}}</span>
            {% elif g1f_per >= 50 and g1f_per < 60 %}
            <span style="font-family: Arial; color: var(--color-r5);">{{g1f_per|floatformat:1}}</span>
            {% elif g1f_per == 0 %}
            <span style="font-family: Arial; color: var(--color-r1); font-size: 0.8rem;">ğŸ”´&nbsp;&nbsp;</span>
            {% else %}
            <span style="font-family: Arial; color: var(--color-gray);">{{g1f_per|floatformat:1}}</span>
            {% endif %}
            <span class="tooltip-text" style="font-size: 1.1rem; font-family: Arial; color:var(--color-light-gray); text-align: left; z-index:999; width:15rem">
                â†ªï¸&nbsp;&nbsp;ì´ˆë°˜ 200m ì ìˆ˜: {{g1f_per|floatformat:1}}<br>
                &nbsp;&nbsp;&nbsp;&nbsp;{{r.corners}}</span>
              
              </span>
          </td>

          {# gate #}
          <td align="center">
            <div style="font-family: Arial; font-size: 1.2rem; background-color: var(--color-bg); color: var(--color-light); border-radius: 7px; padding: 2px 4px;">
              {% if r_rank == 1 %}
              <span style="font-family: Arial; color: var(--color-r1)">{{gate}}</span>
              {% elif r_rank == 2 %}
              <span style="font-family: Arial; color: var(--color-r2)">{{gate}}</span>
              {% elif r_rank == 3 %}
              <span style="font-family: Arial; color: var(--color-r3)">{{gate}}</span>
              {% elif r_rank == 4 %}
              <span style="font-family: Arial; color: var(--color-r4)">{{gate}}</span>
              {% elif r_rank == 5 %}
              <span style="font-family: Arial; color: var(--color-r5)">{{gate}}</span>
              {% else %}
              <span style="font-family: Arial; color: var(--color-light-gray)">{{gate}}</span>
              {% endif %}
            </div>
          </td>

          {# corners #}
          <td>
            <div style="text-align: center; font-family: Arial;">
          
              <span class="tooltip" style="font-family: Arial, Helvetica, sans-serif;">
                {% if corners %}
                  {% if corners|slice:"0:1" == '1' and corners|slice:"1:2" == '-' %}
                  <span style="font-size: 1.15rem; color:var(--color-r1);">{{corners}}</span>
                  {% elif corners|slice:"0:1" == '2' and corners|slice:"1:2" == '-' %}
                  <span style="font-size: 1.15rem; color:var(--color-r2);">{{corners}}</span>
                  {% elif corners|slice:"0:1" == '3' and corners|slice:"1:2" == '-' %}
                  <span style="font-size: 1.15rem; color:var(--color-r3);">{{corners}}</span>
                  {% else %}
                  <span style="font-size: 1.15rem; color:var(--color-gray);">{{corners}}</span>
                  {% endif %}
                {% endif %}
                <span class="tooltip-text" style="font-family: Arial, Helvetica, sans-serif; font-size: 1.3rem;">s1f ì „ê°œë„<br>{{passage_s1f}}</span>
              </span>
          
            </div>
          </td>
          
          {# ê²½ì£¼ìˆœìœ„ #}
          <td align="center">
            {% if r_rank %}
              {% if r_rank == 1 %}
              <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r1); color: var(--color-light); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
                {{r_rank}}
              </span>
              {% elif r_rank == 2 %}
              <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r2); color: var(--color-bg); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
                {{r_rank}}
              </span>
              {% elif r_rank == 3 %}
              <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r3); color: var(--color-bg); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
                {{r_rank}}
              </span>
              {% elif r_rank == 4 %}
              <span style="font-family: Arial; font-size: 1.3rem; border: 1px solid var(--color-r4); color: var(--color-r4); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 4px;">
                {{r_rank}}
              </span>
              {% elif r_rank == 5 %}
              <span style="font-family: Arial; font-size: 1.3rem; border: 1px solid var(--color-r5); color: var(--color-r5); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 4px;">
                {{r_rank}}
              </span>
              {% elif r_rank > 90 %}
              <span style="font-family: Arial; font-size: 1.15rem;">
                <span class="tooltip" style="font-size: 0.9rem;">ğŸš«<span class="tooltip-text" style="font-size: 1.15rem;">ì‚¬ìœ  : {{reason}}</span></span>
              </span>
              {% else %}
              <span style="font-family: Arial; font-size: 1.2rem; background-color: var(--color-bg); color: var(--color-light-gray); border-radius: 10px; border:1px solid var(--color-gray); padding: 2px 4px;">
                {{r_rank}}
              </span>
              {% endif %}
            {% endif %}
            
          </td>

          {# record #}
          <td align="center">
            {% if r_record %}
              {% if r_rank == 1 %}
              <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r1);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              {% elif r_rank == 2 %}
              <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r2);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              {% elif r_rank == 3 %}
              <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r3);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              {% elif r_rank == 4 %}
              <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r4);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              {% elif r_rank == 5 %}
              <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r5);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              
              {% else %}
              <span style="font-family: Arial; font-size: 1.2rem; color: var(--color-light-gray);">
              {{r_record|slice:"0:1"}}&nbsp;{{r_record|slice:"1:"}}
              </span>
              {% endif %}
            {% endif %}

          </td>

          <td align="center">
            {% if gap|length >= 2 %}
            <span style="font-size: 0.8rem; color:var(--color-r2)">{% if gap %}{{gap}}{% endif %}</span>
            {% else %}
            <span style="font-size: 1.1rem; color:var(--color-r2)">{% if gap %}{{gap}}{% endif %}</span>
            {% endif %}
            {% if gap_b|length >= 2 %}
            <span style="font-size: 0.8rem; color:var(--color-r4)">{% if gap_b %}{{gap_b}}{% endif %}</span>
            {% else %}
            <span style="font-size: 1.1rem; color:var(--color-r4)">{% if gap_b %}{{gap_b}}{% endif %}</span>
            {% endif %}
          </td>

          {# ê²½ì£¼ë¡œ #}
          <td align="right">
            {% if adv_track > 0 %}
            <span style="font-size: 1.15rem; font-family: Arial; color: var(--color-r5);">+{{adv_track|floatformat:0}}</span>
            {% else %}
            <span style="font-size: 1.15rem; font-family: Arial; color: var(--color-r1);">{{adv_track|floatformat:0}}</span>
            {% endif %}

            {% if track == 'â‘ ' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r1); padding: 2px 6px; color:var(--color-light); border: 1px solid var(--color-light);">1</span>
            {% elif track == 'â‘¡' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r1); padding: 2px 5px; color:var(--color-light);">2</span>
            {% elif track == 'â‘¢' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r1); padding: 2px 5px; color:var(--color-bg);">3</span>
            {% elif track == 'â‘£' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r2); padding: 2px 5px; color:var(--color-bg);">4</span>
            {% elif track == 'â‘¤' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r3); padding: 2px 5px; color:var(--color-bg);">5</span>
            {% elif track == 'â‘¥' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r3); padding: 2px 5px; color:var(--color-dark-medium);">6</span>
            {% elif track == 'â‘¦' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r4); padding: 2px 5px; color:var(--color-bg);">7</span>
            {% elif track == 'â‘§' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-r5); padding: 2px 5px; color:var(--color-bg);">8</span>
            {% elif track == 'â‘¨' %}
            <span style="font-style: normal; font-size: 1.05rem; border-radius: 50%; background-color: var(--color-bg); padding: 2px 5px; color:var(--color-light);">9</span>
            {% else %}
            <span>{% if track %}{{track}}{% else %}{% endif %}</span>
            {% endif %}
          </td>

          <td>
            {% if weather %}
            <span style="font-size: 1.15rem;">
              {% if weather|slice:"0:1" == 'ë§‘' %}â˜€ï¸
              {% elif weather|slice:"0:1" == 'í' %}â˜ï¸
              {% elif weather|slice:"0:1" == 'ë¹„' %}â˜”ï¸
              {% elif weather|slice:"0:1" == 'ëˆˆ' %}â˜ƒï¸
              {% else %}ï¹†
              {% endif %}
            </span>
            {% endif %}

            {% if rstate %}
            {% if rstate == 'ë¶ˆëŸ‰' or rstate == 'í¬í™”' %}
            <span style="text-align:left; font-family: Arial; font-size: 1.1rem; color:tomato;">{{rstate|slice:"0:1"}}&nbsp;{{rmoisture}}</span>
            {% else %}
            <span style="text-align:left; font-family: Arial; font-size: 1.1rem; color:var(--color-light-gray)">{% if handycap %}{{rstate|slice:"0:1"}}&nbsp;{{rmoisture}}{% endif %}</span>
            {% endif %}
            {% endif %}

            
          </td>
          
          
          {# ë³µìŠ¹ì‹ #}
          <td align="right">
            <span style=" font-size: 1.2rem; font-weight: 350;">
            {% if r2alloc %}
              {% if r_rank <= 2 %}
              <span style="font-family: Arial; color:var(--color-r1); background-color:var(--color-bg); border-radius:7px; padding: 2px 4px; text-align: right;">{{r2alloc}}</span>
              {% else %}
              <span style="font-family: Arial; color:var(--color-gray);  padding: 2px 4px; text-align: right;">{{r2alloc}}</span>
              {% endif %}
            {% endif %}
            </span>
            
          </td>

          {# ì—°ì‹ #}
          <td align="right">
            <span class="tooltip" style=" font-size: 1.2rem; font-weight: 350;">
            {% if alloc3r %}
              {% if r_rank == 1 %}
              <span style="font-family: Arial; background-color:var(--color-bg); padding: 2px 4px; border-radius: 10px; color :var(--color-r1); text-align: right;">{{alloc3r}}</span>
              {% elif r_rank == 2 %}
              <span style="font-family: Arial; background-color:var(--color-bg); padding: 2px 4px; border-radius: 10px; color :var(--color-r2); text-align: right;">{{alloc3r}}</span>
              {% elif r_rank == 3 %}
              <span style="font-family: Arial; background-color:var(--color-bg); padding: 2px 4px; border-radius: 10px; color :var(--color-r3); text-align: right;">{{alloc3r}}</span>
              {% else %}
              <span style="font-family: Arial; color:var(--color-gray);  padding: 2px 4px; text-align: right;">{{alloc3r}}</span>
              {% endif %}
            {% endif %}
            <span class="tooltip-text">
              <table>
                <thead>
                  <tr>
                    <th style="font-family: Arial,; font-size: 1.2rem;">ìŠ¹ì‹</th>
                    <th style="font-family: Arial,; font-size: 1.2rem;">ë°°ë‹¹ìœ¨</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td style="font-family: Arial,; font-size: 1.2rem;">ë³µìŠ¹</td>
                    <td style="font-family: Arial,; font-size: 1.2rem; text-align: right;">{{r2alloc}}</td>
                  </tr>
                  <tr>
                    <td style="font-family: Arial,; font-size: 1.2rem;">ì‚¼ë³µìŠ¹</td>
                    <td style="font-family: Arial,; font-size: 1.2rem; text-align: right;">{{r3alloc}}</td>
                  </tr>
              
                </tbody>
              </table>
            </span>

            
          </td>
          
          
          {# thethe9 ì˜ˆìƒìˆœìœ„ #}
          <td align="center">

            {% if r_pop == 1 %}
            <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r1); color: var(--color-light); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
              {{r_pop}}
            </span>
            {% elif r_pop == 2 %}
            <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r2); color: var(--color-bg); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
              {{r_pop}}
            </span>
            {% elif r_pop == 3 %}
            <span style="font-family: Arial; font-size: 1.3rem; background-color: var(--color-r3); color: var(--color-bg); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 5px;">
              {{r_pop}}
            </span>
            {% elif r_pop == 4 %}
            <span style="font-family: Arial; font-size: 1.3rem; border: 1px solid var(--color-r4); color: var(--color-r4); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 4px;">
              {{r_pop}}
            </span>
            {% elif r_pop == 5 %}
            <span style="font-family: Arial; font-size: 1.3rem; border: 1px solid var(--color-r5); color: var(--color-r5); border-radius: 10px; border:1px solid var(--color-light); padding: 2px 4px;">
              {{r_pop}}
            </span>
            {% elif r_pop == 96 %}
            <span class="tooltip" style="font-style: normal; font-family: Arial; font-size:1.0rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">
              ğŸ˜±<span class="tooltip-text">ğŸ˜±&nbsp;&nbsp;ì‹¤ê²©</span>
            </span>
            {% elif r_pop == 97 %}
            <span class="tooltip" style="font-style: normal; font-family: Arial; font-size:1.0rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">
              ğŸ¤¬<span class="tooltip-text">ğŸ¤¬&nbsp;&nbsp;ì£¼í–‰ì¤‘ì§€</span>
            </span>
            {% elif r_pop == 98 %}
            <span class="tooltip" style="font-style: normal; font-family: Arial; font-size:1.0rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">
              ğŸš«<span class="tooltip-text">ğŸš«&nbsp;&nbsp;ì¶œì£¼ì·¨ì†Œ</span>
            </span>
            {% elif r_pop == 99 %}
            <span class="tooltip" style="font-style: normal; font-family: Arial; font-size:1.0rem; color:var(--color-gray); text-align: right; padding:2px 4px; border-radius: 7px;">
              ğŸ£<span class="tooltip-text">ğŸ£&nbsp;&nbsp;ì‹ ë§ˆê¸‰</span>
            </span>
            {% else %}
          
            <span style="font-family: Arial; font-size: 1.2rem; background-color: var(--color-bg); color: var(--color-light-gray); border-radius: 10px; border:1px solid var(--color-gray); padding: 2px 4px;">
              {{r_pop}}
            </span>
            {% endif %}
          </td>
          
          {# complex #}
          <td align="center">

            {% if rank == 1 %}
            <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r1);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            {% elif rank == 2 %}
            <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r2);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            {% elif rank == 3 %}
            <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r3);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            {% elif rank == 4 %}
            <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r4);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            {% elif rank == 5 %}
            <span style="font-family: Arial; font-size: 1.2rem; color:var(--color-r5);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            
            {% else %}
            <span style="font-family: Arial; font-size: 1.2rem; color: var(--color-gray);">
              {{complex|slice:"0:1"}}&nbsp;{{complex|slice:"1:"}}
            </span>
            {% endif %}
          </td>

          {# ë ˆì´íŒ… #}
          <td align="right">
            <span style="font-size: 1.15rem; font-family: Arial;">{{rating}}</span>
          </td>
          
          {# ê²½ì£¼í¸ì„± ê°•ë„ #}
          <td align="right">
            {% if r_judge %}
              {% if r_judge|mul:"1" >= 5  %} 
              <span class="tooltip" style="font-size: 1.15rem; font-family: Arial; color:var(--color-light); background-color: var(--color-r1); border-radius: 50%; padding: 2px 4px; font-weight: normal;">ìƒ<span class="tooltip-text" style="font-size: 1.15rem;">ğŸš¦<br>{{r_judge}}</span></span>
              {% elif r_judge|mul:"1" >= -5 and r_judge|mul:"1" <= 5 %} 
              <span class="tooltip" style="font-size: 1.15rem; font-family: Arial; color:var(--color-r3); background-color: var(--color-bg); border-radius: 50%; padding: 2px 4px; font-weight: normal;">ì¤‘<span class="tooltip-text" style="font-size: 1.15rem;">ğŸš¦<br>{{r_judge}}</span></span>
              {% else %} 
              <span class="tooltip" style="font-size: 1.15rem; font-family: Arial; color:var(--color-gray); background-color: var(--color-bg); border-radius: 50%; padding: 2px 4px; font-weight: normal;">í•˜<span class="tooltip-text" style="font-size: 1.15rem;">ğŸš¦<br>{{r_judge}}</span></span>
              {% endif %}
            {% endif %}
          </td>
          <td align="center">
            {% if h_cnt %}
              <span style="font-size: 1.15rem; font-family: Arial; color:var(--color-light-gray);">{{h_cnt}}
                {% if h_sex == "ì•”" %}
                <span style="font-size: 1.15rem; font-family: Arial; color:var(--color-bg); background-color: var(--color-r3); border-radius: 7px; padding: 2px 4px;">{{h_mare}}</span>
                {% else %}
                <span style="font-size: 1.15rem; font-family: Arial; color:var(--color-r5); background-color: var(--color-bg); border-radius: 7px; padding: 2px 4px;">{{h_mare}}</span>
                {% endif %}
              </span>
            {% endif %}
          </td>

        </tr>

        <!-- <tr class="fold">
          <td colspan="17">


          </td>
        </tr> -->

        {% endfor %}
      </tbody>
    </table>
  </div>

<script>
  (function () {
    if (window.__tooltipPortalInit) return;
    window.__tooltipPortalInit = true;

    var portal = null;
    var GAP = 12;

    function ensurePortal() {
      if (!portal) {
        portal = document.createElement('div');
        portal.className = 'tooltip-portal';
        document.body.appendChild(portal);
      }
      return portal;
    }

    function place(x, y) {
      var vw = window.innerWidth, vh = window.innerHeight;
      portal.style.left = Math.max(8, Math.min(x, vw - portal.offsetWidth - 8)) + 'px';
      portal.style.top  = Math.max(8, Math.min(y, vh - portal.offsetHeight - 8)) + 'px';
    }

    function onEnter(e) {
      var host = e.target.closest('.tooltip');
      if (!host) return;
      var txt = host.querySelector('.tooltip-text');
      if (!txt) return;
      ensurePortal();
      portal.innerHTML = txt.innerHTML;
      var r = host.getBoundingClientRect();
      place(r.right + GAP, r.top + GAP);
      document.addEventListener('mousemove', onMove, true);
    }

    function onMove(e) {
      if (!portal) return;
      place(e.clientX + GAP, e.clientY + GAP);
    }

    function onLeave(e) {
      var host = e.target.closest('.tooltip');
      if (!host) return;
      if (portal && portal.parentNode) portal.parentNode.removeChild(portal);
      portal = null;
      document.removeEventListener('mousemove', onMove, true);
    }

    document.addEventListener('mouseenter', onEnter, true);
    document.addEventListener('mouseleave', onLeave, true);
  })();
</script>
